import{c as a,o as r,a as t,_ as fe,u as pe,C as ve,b as me,r as i,d as G,D as ge,P as ye,e as xe,f as n,g as d,j as u,t as c,w as z,i as D,I as he,F as J,h as _e,S as Q,y as W,A as ee,H as be,B as b,N as f,X as we,p as j,m as F}from"./main-DT8B7HGo.js";import{d as B}from"./dayjs.min-iy57P9mS.js";import{r as ke}from"./ArrowLeftIcon-BDGH8L5A.js";import{r as Ce}from"./PhoneIcon-YvZEPEa5.js";import{r as U}from"./CheckIcon-D4wuqP2P.js";import"./_commonjsHelpers-Cpj98o6Y.js";function te(O,v){return r(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 8.25H9m6 3H9m3 6-3-3h1.5a3 3 0 1 0 0-6M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function $e(O,v){return r(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function Me(O,v){return r(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}const je={class:"conversation-container"},Be={class:"conversation-header"},Oe={class:"flex items-center gap-3 px-4 py-3"},Se={key:0,class:"flex items-center gap-3 flex-1 min-w-0"},Te={class:"relative"},ze=["src","alt"],De={class:"min-w-0 flex-1"},Fe={class:"font-semibold text-gray-900 truncate"},Ue={class:"flex items-center gap-1"},Ve=["href"],Ae={class:"relative"},Ie={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-xl shadow-lg border z-50"},He={key:0,class:"px-4 pb-3"},Le=["src","alt"],Ne={class:"flex-1 min-w-0"},Ye={class:"font-medium text-gray-900 truncate text-sm"},Ze={class:"text-primary-600 font-bold text-sm"},Ee={key:0,class:"flex justify-center py-8"},Re={class:"flex justify-center mb-4"},Ke={class:"px-3 py-1 bg-gray-200 rounded-full text-xs text-gray-600"},Pe={key:0,class:"mb-2"},Xe={class:"flex items-center gap-2 mb-1"},qe={class:"text-2xl font-bold"},Ge={key:0,class:"flex gap-2 mt-3"},Je=["onClick"],Qe=["onClick"],We={class:"whitespace-pre-wrap break-words"},et={key:0,class:"flex items-center"},tt={key:0,class:"text-center py-8 text-gray-500"},st={class:"conversation-input"},ot={class:"flex-1 relative"},rt=["disabled","onKeydown"],at=["disabled"],lt={key:1,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},nt={class:"relative bg-white w-full sm:max-w-sm sm:rounded-xl rounded-t-2xl p-6 pb-safe"},it={key:0,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg mb-4"},dt=["src"],ut={class:"min-w-0 flex-1"},ct={class:"font-medium text-sm truncate"},ft={class:"text-primary-600 font-bold"},pt={class:"relative mb-4"},vt={class:"flex gap-3"},mt=["disabled"],gt={__name:"Conversation",setup(O){const v=pe(),S=ve(),se=me(),V=i(!0),w=i(!1),l=i(null),m=i([]),g=i(""),p=i(!1),k=i(!1),y=i(""),C=i(null),T=i(null),x=G(()=>{var o;return(o=se.user)==null?void 0:o.id}),_=G(()=>l.value?l.value.buyer_id===x.value?l.value.seller:l.value.buyer:null),oe=o=>B(o).format("h:mm A"),re=o=>{if(!o)return"";const e=B(o);return e.isSame(B(),"day")?"Today":e.isSame(B().subtract(1,"day"),"day")?"Yesterday":e.format("MMM D, YYYY")},ae=o=>{const e=o.target;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"},le=()=>{T.value&&(T.value.style.height="auto")},$=()=>{we(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)})},ne=async()=>{try{const o=await b.get(`/conversations/${v.params.uuid}`);l.value=o.data.data.conversation,m.value=o.data.data.messages.data||[],$()}catch{f.error("Failed to load conversation"),S.push("/messages")}finally{V.value=!1}},A=async()=>{if(!g.value.trim()||w.value)return;w.value=!0;const o=g.value;g.value="",le();try{const e=await b.post(`/conversations/${v.params.uuid}/messages`,{message:o,type:"text"});m.value.push(e.data.data),$()}catch{g.value=o,f.error("Failed to send message")}finally{w.value=!1}},ie=async()=>{if(y.value)try{const o=await b.post(`/conversations/${v.params.uuid}/messages`,{message:`I'd like to offer ₹${y.value}`,type:"offer",offer_amount:y.value});m.value.push(o.data.data),k.value=!1,y.value="",$(),f.success("Offer sent!")}catch{f.error("Failed to send offer")}},I=async(o,e)=>{try{await b.post(`/messages/${o}/offer-response`,{action:e});const h=m.value.find(M=>M.id===o);h&&(h.offer_status=e==="accept"?"accepted":"rejected"),f.success(`Offer ${e}ed`)}catch{f.error("Failed to respond to offer")}},de=async()=>{p.value=!1;try{await b.post(`/conversations/${v.params.uuid}/block`),f.success("User blocked"),S.push("/messages")}catch{f.error("Failed to block user")}},ue=async()=>{p.value=!1;try{await b.delete(`/conversations/${v.params.uuid}`),f.success("Conversation deleted"),S.push("/messages")}catch{f.error("Failed to delete conversation")}},H=()=>{$()};return ge(()=>{ne(),window.addEventListener("resize",H)}),ye(()=>{window.removeEventListener("resize",H)}),(o,e)=>{var M,L,N,Y,Z,E,R,K,P,X;const h=xe("router-link");return r(),a("div",je,[t("header",Be,[t("div",Oe,[t("button",{onClick:e[0]||(e[0]=s=>o.$router.push("/messages")),class:"p-2 -ml-2 hover:bg-gray-100 rounded-full"},[d(u(ke),{class:"w-5 h-5 text-gray-600"})]),l.value?(r(),a("div",Se,[t("div",Te,[t("img",{src:((M=_.value)==null?void 0:M.avatar_url)||"/images/default-avatar.png",alt:(L=_.value)==null?void 0:L.name,class:"w-10 h-10 rounded-full object-cover bg-gray-200"},null,8,ze),e[10]||(e[10]=t("span",{class:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"},null,-1))]),t("div",De,[t("h1",Fe,c((N=_.value)==null?void 0:N.name),1),e[11]||(e[11]=t("p",{class:"text-xs text-green-600"},"Online",-1))])])):n("",!0),t("div",Ue,[(Y=_.value)!=null&&Y.phone?(r(),a("a",{key:0,href:`tel:${_.value.phone}`,class:"p-2 hover:bg-gray-100 rounded-full"},[d(u(Ce),{class:"w-5 h-5 text-gray-600"})],8,Ve)):n("",!0),t("div",Ae,[t("button",{onClick:e[1]||(e[1]=s=>p.value=!p.value),class:"p-2 hover:bg-gray-100 rounded-full"},[d(u($e),{class:"w-5 h-5 text-gray-600"})]),p.value?(r(),a("div",Ie,[d(h,{to:`/listing/${(E=(Z=l.value)==null?void 0:Z.listing)==null?void 0:E.slug}`,class:"block px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-t-xl",onClick:e[2]||(e[2]=s=>p.value=!1)},{default:z(()=>[...e[12]||(e[12]=[D(" View Listing ",-1)])]),_:1},8,["to"]),d(h,{to:`/user/${(R=_.value)==null?void 0:R.id}`,class:"block px-4 py-3 text-gray-700 hover:bg-gray-50",onClick:e[3]||(e[3]=s=>p.value=!1)},{default:z(()=>[...e[13]||(e[13]=[D(" View Profile ",-1)])]),_:1},8,["to"]),t("button",{onClick:de,class:"w-full px-4 py-3 text-left text-red-600 hover:bg-red-50"}," Block User "),t("button",{onClick:ue,class:"w-full px-4 py-3 text-left text-red-600 hover:bg-red-50 rounded-b-xl"}," Delete Chat ")])):n("",!0)])])]),(K=l.value)!=null&&K.listing?(r(),a("div",He,[d(h,{to:`/listing/${l.value.listing.slug}`,class:"flex items-center gap-3 p-2 bg-gray-50 rounded-xl hover:bg-gray-100 transition"},{default:z(()=>[t("img",{src:l.value.listing.primary_image_url,alt:l.value.listing.title,class:"w-12 h-12 rounded-lg object-cover bg-gray-200"},null,8,Le),t("div",Ne,[t("p",Ye,c(l.value.listing.title),1),t("p",Ze,c(l.value.listing.formatted_price||"₹"+l.value.listing.price),1)]),d(u(he),{class:"w-5 h-5 text-gray-400 flex-shrink-0"})]),_:1},8,["to"])])):n("",!0)]),p.value?(r(),a("div",{key:0,class:"fixed inset-0 z-40",onClick:e[4]||(e[4]=s=>p.value=!1)})):n("",!0),t("div",{ref_key:"messagesContainer",ref:C,class:"messages-area"},[V.value?(r(),a("div",Ee,[...e[14]||(e[14]=[t("div",{class:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"},null,-1)])])):(r(),a(J,{key:1},[t("div",Re,[t("span",Ke,c(re((P=m.value[0])==null?void 0:P.created_at)),1)]),(r(!0),a(J,null,_e(m.value,s=>{var q;return r(),a("div",{key:s.id,class:j(["flex mb-3",s.sender_id===x.value?"justify-end":"justify-start"])},[t("div",{class:j(["max-w-[80%] rounded-2xl px-4 py-2 shadow-sm",s.sender_id===x.value?"bg-primary-600 text-white rounded-br-sm":"bg-white text-gray-900 rounded-bl-sm"])},[s.type==="offer"?(r(),a("div",Pe,[t("div",Xe,[d(u(te),{class:"w-4 h-4"}),e[15]||(e[15]=t("span",{class:"text-sm opacity-80"},"Offer",-1))]),t("p",qe,"₹"+c((q=s.offer_amount)==null?void 0:q.toLocaleString()),1),s.offer_status==="pending"&&s.sender_id!==x.value?(r(),a("div",Ge,[t("button",{onClick:ce=>I(s.id,"accept"),class:"flex-1 px-3 py-2 bg-green-500 text-white rounded-lg text-sm font-medium"}," Accept ",8,Je),t("button",{onClick:ce=>I(s.id,"reject"),class:"flex-1 px-3 py-2 bg-white/20 text-white rounded-lg text-sm font-medium"}," Decline ",8,Qe)])):s.offer_status!=="pending"?(r(),a("p",{key:1,class:j(["text-sm mt-2 font-medium",s.sender_id===x.value?s.offer_status==="accepted"?"text-green-200":"text-red-200":s.offer_status==="accepted"?"text-green-600":"text-red-600"])},c(s.offer_status==="accepted"?"Accepted":"Declined"),3)):n("",!0)])):n("",!0),t("p",We,c(s.body),1),t("p",{class:j(["text-[10px] mt-1 flex items-center gap-1",s.sender_id===x.value?"text-primary-200 justify-end":"text-gray-400"])},[D(c(oe(s.created_at))+" ",1),s.sender_id===x.value?(r(),a("span",et,[s.is_read?(r(),F(u(U),{key:0,class:"w-3 h-3"})):n("",!0),s.is_read?(r(),F(u(U),{key:1,class:"w-3 h-3 -ml-1"})):(r(),F(u(U),{key:2,class:"w-3 h-3"}))])):n("",!0)],2)],2)],2)}),128)),m.value.length===0?(r(),a("div",tt,[...e[16]||(e[16]=[t("p",null,"No messages yet. Say hello!",-1)])])):n("",!0)],64))],512),t("div",st,[t("form",{onSubmit:Q(A,["prevent"]),class:"flex items-end gap-2"},[t("button",{type:"button",onClick:e[5]||(e[5]=s=>k.value=!0),class:"p-3 text-primary-600 hover:bg-primary-50 rounded-full flex-shrink-0",title:"Make an offer"},[d(u(te),{class:"w-6 h-6"})]),t("div",ot,[W(t("textarea",{ref_key:"messageInput",ref:T,"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),placeholder:"Type a message...",class:"w-full px-4 py-3 bg-gray-100 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-primary-500",rows:"1",disabled:w.value,onInput:ae,onKeydown:be(Q(A,["exact","prevent"]),["enter"]),style:{"max-height":"120px"}},null,40,rt),[[ee,g.value]])]),t("button",{type:"submit",disabled:!g.value.trim()||w.value,class:"p-3 bg-primary-600 text-white rounded-full flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-primary-700 transition"},[d(u(Me),{class:"w-5 h-5"})],8,at)],32)]),k.value?(r(),a("div",lt,[t("div",{class:"absolute inset-0 bg-black/50",onClick:e[7]||(e[7]=s=>k.value=!1)}),t("div",nt,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold mb-4"},"Make an Offer",-1)),(X=l.value)!=null&&X.listing?(r(),a("div",it,[t("img",{src:l.value.listing.primary_image_url,class:"w-12 h-12 rounded-lg object-cover"},null,8,dt),t("div",ut,[t("p",ct,c(l.value.listing.title),1),t("p",ft,c(l.value.listing.formatted_price||"₹"+l.value.listing.price),1)])])):n("",!0),t("div",pt,[e[17]||(e[17]=t("span",{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg"},"₹",-1)),W(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>y.value=s),type:"number",min:"1",class:"w-full pl-10 pr-4 py-3 bg-gray-100 rounded-xl text-lg font-semibold focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter your offer"},null,512),[[ee,y.value]])]),t("div",vt,[t("button",{onClick:e[9]||(e[9]=s=>k.value=!1),class:"flex-1 py-3 border border-gray-300 rounded-xl font-medium"}," Cancel "),t("button",{onClick:ie,class:"flex-1 py-3 bg-primary-600 text-white rounded-xl font-medium disabled:opacity-50",disabled:!y.value}," Send Offer ",8,mt)])])])):n("",!0)])}}},kt=fe(gt,[["__scopeId","data-v-5229fb34"]]);export{kt as default};
