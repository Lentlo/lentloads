import{y as pt,d as u,H as K,e as ct,a1 as vt,z as gt,f as yt,c as r,o as n,a as e,g as w,t as p,h as c,j,k as d,K as x,A as xt,N as U,L as k,D as F,F as R,i as T,n as mt,C as f,O as i,w as bt,q as A,E as ft,m as _t}from"./main-CeWmT0Lm.js";import{d as wt}from"./dayjs.min-BiuRtYLQ.js";import{_ as kt}from"./LocationPicker-CtKu99MU.js";import{r as W}from"./CheckIcon-8WQ_YXPb.js";import{r as J}from"./TrashIcon-CU2S9UsQ.js";import{r as ht}from"./StarIcon-CPeBG8q-.js";import{r as Ct}from"./BoltIcon-_4TpEJ4-.js";import{r as $t}from"./SparklesIcon-w46enqeD.js";import{r as Lt}from"./EyeIcon-CsYFc6Tu.js";import{r as St}from"./PencilIcon-DxoA8sSu.js";import{r as jt}from"./ArrowTopRightOnSquareIcon-BTq6RsEY.js";import"./leaflet-DE3tt1IZ.js";const Ut={class:"p-6"},Vt={class:"flex items-center justify-between mb-6"},Ft={key:0,class:"flex items-center gap-2"},At={class:"text-sm text-gray-600"},Pt={class:"card p-4 mb-6"},Dt={class:"flex flex-wrap gap-4"},Nt={class:"flex-1 min-w-[200px]"},Mt={class:"relative"},Et=["value"],Rt={class:"card overflow-hidden"},Tt={class:"w-full"},Bt={class:"bg-gray-50"},zt={class:"px-4 py-3 text-left"},It=["checked"],Yt={class:"divide-y"},Ot={key:0},Ht={key:1},qt={class:"px-4 py-3"},Gt=["checked","onChange"],Kt={class:"px-4 py-3"},Wt={class:"flex items-center gap-3"},Jt=["src","alt"],Qt={class:"font-medium text-gray-900 truncate max-w-[200px]"},Xt={class:"text-xs text-gray-500"},Zt={class:"px-4 py-3"},te={class:"px-4 py-3 text-gray-600"},ee={class:"px-4 py-3 font-medium text-gray-900"},oe={class:"px-4 py-3"},se=["onUpdate:modelValue","onChange"],le={class:"px-4 py-3"},ae={class:"flex gap-1"},ne=["onClick"],ie=["onClick"],re=["onClick"],de={class:"px-4 py-3 text-xs text-gray-500"},ue={class:"flex flex-col gap-1"},pe={class:"px-4 py-3"},ce={class:"flex items-center gap-1"},ve=["onClick"],ge=["href"],ye=["onClick"],xe=["onClick"],me=["onClick"],be={key:0,class:"p-4 border-t flex items-center justify-between"},fe={class:"text-sm text-gray-500"},_e={class:"flex gap-2"},we=["disabled"],ke=["disabled"],he={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ce={class:"relative bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},$e={class:"space-y-4"},Le={class:"grid grid-cols-2 gap-4"},Se={class:"grid grid-cols-2 gap-4"},je=["value"],Ue={class:"flex gap-2 pt-4"},Ve={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Fe={class:"relative bg-white rounded-xl p-6 w-full max-w-md"},Ae={class:"space-y-4"},Pe={class:"flex gap-2"},De=["disabled"],Ke={__name:"Listings",setup(Ne){const B=pt(),P=u(!0),h=u([]),D=u(""),b=u(1),V=u(1),N=u(20),M=u(0),a=u([]),_=u(null),l=K({title:"",description:"",price:0,price_type:"fixed",category_id:null,condition:"",city:"",state:"",locality:"",postal_code:"",latitude:null,longitude:null}),C=u(null),L=u(""),S=u(""),$=K({status:"",category:""}),z=u([]),I=u([]),Y=ct(()=>h.value.length>0&&h.value.every(s=>a.value.includes(s.id))),Q=s=>wt(s).format("MMM D, YYYY"),X=s=>({active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",rejected:"bg-red-100 text-red-800 border-red-200",sold:"bg-blue-100 text-blue-800 border-blue-200",expired:"bg-gray-100 text-gray-800 border-gray-200"})[s]||"bg-gray-100 text-gray-800",y=async()=>{P.value=!0;try{const s=await f.get("/admin/listings",{params:{page:b.value,search:D.value,status:$.status,category_id:$.category}});h.value=s.data.data,b.value=s.data.meta.current_page,V.value=s.data.meta.last_page,N.value=s.data.meta.per_page,M.value=s.data.meta.total}finally{P.value=!1}},O=vt(()=>{b.value=1,y()},300),H=s=>{s>=1&&s<=V.value&&(b.value=s,y())},Z=s=>{const t=a.value.indexOf(s);t>-1?a.value.splice(t,1):a.value.push(s)},tt=()=>{Y.value?a.value=[]:a.value=h.value.map(s=>s.id)},et=s=>{_.value=s,l.title=s.title,l.description=s.description,l.price=s.price,l.price_type=s.price_type,l.category_id=s.category_id,l.condition=s.condition||"",l.city=s.city||"",l.state=s.state||"",l.locality=s.locality||"",l.postal_code=s.postal_code||"",l.latitude=s.latitude?parseFloat(s.latitude):null,l.longitude=s.longitude?parseFloat(s.longitude):null},ot=async()=>{var s,t,v;try{const m={title:l.title,description:l.description,price:l.price,price_type:l.price_type,category_id:l.category_id,condition:l.condition||null,city:l.city||null,state:l.state||null,locality:l.locality||null,postal_code:l.postal_code||null,latitude:l.latitude,longitude:l.longitude};await f.put(`/admin/listings/${_.value.id}`,m),i.success("Listing updated"),_.value=null,y()}catch(m){console.error("Save listing error:",((s=m.response)==null?void 0:s.data)||m),i.error(((v=(t=m.response)==null?void 0:t.data)==null?void 0:v.message)||"Failed to update listing")}},st=async s=>{try{await f.put(`/admin/listings/${s.id}`,{status:s.status}),i.success("Status updated")}catch{i.error("Failed to update status"),y()}},E=async(s,t)=>{try{const v=!s[t];await f.post(`/admin/listings/${s.id}/toggle-feature`,{[t]:v}),s[t]=v,i.success(`${t.replace("is_","").replace("_"," ")} ${v?"enabled":"disabled"}`)}catch{i.error("Failed to update badge")}},lt=async s=>{try{await f.post(`/admin/listings/${s.id}/approve`),i.success("Listing approved"),y()}catch{i.error("Failed to approve listing")}},at=s=>{C.value=s,L.value="",S.value=""},nt=async()=>{try{await f.post(`/admin/listings/${C.value.id}/reject`,{reason:L.value+(S.value?": "+S.value:"")}),i.success("Listing rejected"),C.value=null,y()}catch{i.error("Failed to reject listing")}},it=async s=>{if(confirm(`Delete "${s.title}"? This cannot be undone.`))try{await f.delete(`/admin/listings/${s.id}`),i.success("Listing deleted"),y()}catch{i.error("Failed to delete listing")}},rt=async()=>{if(confirm(`Approve ${a.value.length} listings?`))try{const s=await f.post("/admin/listings/bulk-approve",{ids:a.value});i.success(s.data.message),a.value=[],y()}catch{i.error("Failed to bulk approve")}},dt=async()=>{if(confirm(`Delete ${a.value.length} listings? This cannot be undone.`))try{const s=await f.post("/admin/listings/bulk-delete",{ids:a.value});i.success(s.data.message),a.value=[],y()}catch{i.error("Failed to bulk delete")}},ut=async()=>{try{const s=await f.get("/categories"),t=[];s.data.data.forEach(v=>{t.push(v),v.children&&v.children.forEach(m=>{t.push({...m,name:`  â”” ${m.name}`})})}),I.value=t}catch{console.error("Failed to fetch categories")}};return gt(async()=>{await B.fetchCategories(),z.value=B.categories,await ut(),y()}),(s,t)=>{var m;const v=yt("router-link");return n(),r("div",Ut,[e("div",Vt,[t[27]||(t[27]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Manage Listings",-1)),a.value.length?(n(),r("div",Ft,[e("span",At,p(a.value.length)+" selected",1),e("button",{onClick:rt,class:"btn-primary btn-sm"},[c(d(W),{class:"w-4 h-4 mr-1"}),t[25]||(t[25]=j(" Approve All ",-1))]),e("button",{onClick:dt,class:"btn-danger btn-sm"},[c(d(J),{class:"w-4 h-4 mr-1"}),t[26]||(t[26]=j(" Delete All ",-1))]),e("button",{onClick:t[0]||(t[0]=o=>a.value=[]),class:"btn-secondary btn-sm"}," Clear ")])):w("",!0)]),e("div",Pt,[e("div",Dt,[e("div",Nt,[e("div",Mt,[c(d(xt),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),x(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>D.value=o),type:"text",placeholder:"Search listings...",class:"input pl-10",onInput:t[2]||(t[2]=(...o)=>d(O)&&d(O)(...o))},null,544),[[U,D.value]])])]),x(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>$.status=o),onChange:y,class:"input w-auto"},[...t[28]||(t[28]=[F('<option value="">All Status</option><option value="pending">Pending</option><option value="active">Active</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',6)])],544),[[k,$.status]]),x(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>$.category=o),onChange:y,class:"input w-auto"},[t[29]||(t[29]=e("option",{value:""},"All Categories",-1)),(n(!0),r(R,null,T(z.value,o=>(n(),r("option",{key:o.id,value:o.id},p(o.name),9,Et))),128))],544),[[k,$.category]])])]),e("div",Rt,[e("table",Tt,[e("thead",Bt,[e("tr",null,[e("th",zt,[e("input",{type:"checkbox",checked:Y.value,onChange:tt,class:"rounded border-gray-300"},null,40,It)]),t[30]||(t[30]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Listing",-1)),t[31]||(t[31]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Seller",-1)),t[32]||(t[32]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Category",-1)),t[33]||(t[33]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Price",-1)),t[34]||(t[34]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Status",-1)),t[35]||(t[35]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Badges",-1)),t[36]||(t[36]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Stats",-1)),t[37]||(t[37]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions",-1))])]),e("tbody",Yt,[P.value?(n(),r("tr",Ot,[...t[38]||(t[38]=[e("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," Loading... ",-1)])])):h.value.length?w("",!0):(n(),r("tr",Ht,[...t[39]||(t[39]=[e("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," No listings found ",-1)])])),(n(!0),r(R,null,T(h.value,o=>{var q,G;return n(),r("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",qt,[e("input",{type:"checkbox",checked:a.value.includes(o.id),onChange:g=>Z(o.id),class:"rounded border-gray-300"},null,40,Gt)]),e("td",Kt,[e("div",Wt,[e("img",{src:o.primary_image_url,alt:o.title,class:"w-12 h-12 rounded object-cover"},null,8,Jt),e("div",null,[e("p",Qt,p(o.title),1),e("p",Xt,"ID: "+p(o.id)+" | "+p(Q(o.created_at)),1)])])]),e("td",Zt,[c(v,{to:`/admin/users?search=${(q=o.user)==null?void 0:q.email}`,class:"text-primary-600 hover:underline"},{default:bt(()=>{var g;return[j(p((g=o.user)==null?void 0:g.name),1)]}),_:2},1032,["to"])]),e("td",te,p((G=o.category)==null?void 0:G.name),1),e("td",ee,p(o.formatted_price),1),e("td",oe,[x(e("select",{"onUpdate:modelValue":g=>o.status=g,onChange:g=>st(o),class:A(["text-xs border rounded px-2 py-1",X(o.status)])},[...t[40]||(t[40]=[F('<option value="active">Active</option><option value="pending">Pending</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',5)])],42,se),[[k,o.status]])]),e("td",le,[e("div",ae,[e("button",{onClick:g=>E(o,"is_featured"),class:A([o.is_featured?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Featured"},[c(d(ht),{class:"w-3 h-3"})],10,ne),e("button",{onClick:g=>E(o,"is_urgent"),class:A([o.is_urgent?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Urgent"},[c(d(Ct),{class:"w-3 h-3"})],10,ie),e("button",{onClick:g=>E(o,"is_highlighted"),class:A([o.is_highlighted?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Highlighted"},[c(d($t),{class:"w-3 h-3"})],10,re)])]),e("td",de,[e("div",ue,[e("span",null,[c(d(Lt),{class:"w-3 h-3 inline"}),j(" "+p(o.views_count||0),1)]),e("span",null,[c(d(ft),{class:"w-3 h-3 inline"}),j(" "+p(o.favorites_count||0),1)])])]),e("td",pe,[e("div",ce,[e("button",{onClick:g=>et(o),class:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit"},[c(d(St),{class:"w-5 h-5"})],8,ve),e("a",{href:`/listing/${o.slug}`,target:"_blank",class:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"View"},[c(d(jt),{class:"w-5 h-5"})],8,ge),o.status==="pending"?(n(),r("button",{key:0,onClick:g=>lt(o),class:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Approve"},[c(d(W),{class:"w-5 h-5"})],8,ye)):w("",!0),o.status==="pending"?(n(),r("button",{key:1,onClick:g=>at(o),class:"p-1 text-orange-600 hover:bg-orange-50 rounded",title:"Reject"},[c(d(_t),{class:"w-5 h-5"})],8,xe)):w("",!0),e("button",{onClick:g=>it(o),class:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete"},[c(d(J),{class:"w-5 h-5"})],8,me)])])])}),128))])]),V.value>1?(n(),r("div",be,[e("p",fe," Showing "+p((b.value-1)*N.value+1)+" to "+p(Math.min(b.value*N.value,M.value))+" of "+p(M.value)+" listings ",1),e("div",_e,[e("button",{onClick:t[5]||(t[5]=o=>H(b.value-1)),disabled:b.value===1,class:"btn-secondary btn-sm"}," Previous ",8,we),e("button",{onClick:t[6]||(t[6]=o=>H(b.value+1)),disabled:b.value===V.value,class:"btn-secondary btn-sm"}," Next ",8,ke)])])):w("",!0)]),_.value?(n(),r("div",he,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[7]||(t[7]=o=>_.value=null)}),e("div",Ce,[t[50]||(t[50]=e("h3",{class:"text-lg font-semibold mb-4"},"Edit Listing",-1)),e("div",$e,[e("div",null,[t[41]||(t[41]=e("label",{class:"label"},"Title",-1)),x(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>l.title=o),class:"input"},null,512),[[U,l.title]])]),e("div",null,[t[42]||(t[42]=e("label",{class:"label"},"Description",-1)),x(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=o=>l.description=o),rows:"4",class:"input"},null,512),[[U,l.description]])]),e("div",Le,[e("div",null,[t[43]||(t[43]=e("label",{class:"label"},"Price",-1)),x(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>l.price=o),type:"number",class:"input"},null,512),[[U,l.price]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"label"},"Price Type",-1)),x(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>l.price_type=o),class:"input"},[...t[44]||(t[44]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"negotiable"},"Negotiable",-1),e("option",{value:"free"},"Free",-1),e("option",{value:"contact"},"Contact for Price",-1)])],512),[[k,l.price_type]])])]),e("div",Se,[e("div",null,[t[46]||(t[46]=e("label",{class:"label"},"Category",-1)),x(e("select",{"onUpdate:modelValue":t[12]||(t[12]=o=>l.category_id=o),class:"input"},[(n(!0),r(R,null,T(I.value,o=>(n(),r("option",{key:o.id,value:o.id},p(o.name),9,je))),128))],512),[[k,l.category_id]])]),e("div",null,[t[48]||(t[48]=e("label",{class:"label"},"Condition",-1)),x(e("select",{"onUpdate:modelValue":t[13]||(t[13]=o=>l.condition=o),class:"input"},[...t[47]||(t[47]=[F('<option value="">Not specified</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[k,l.condition]])])]),e("div",null,[t[49]||(t[49]=e("label",{class:"label"},"Location",-1)),(n(),mt(kt,{key:(m=_.value)==null?void 0:m.id,latitude:l.latitude,"onUpdate:latitude":t[14]||(t[14]=o=>l.latitude=o),longitude:l.longitude,"onUpdate:longitude":t[15]||(t[15]=o=>l.longitude=o),locality:l.locality,"onUpdate:locality":t[16]||(t[16]=o=>l.locality=o),city:l.city,"onUpdate:city":t[17]||(t[17]=o=>l.city=o),state:l.state,"onUpdate:state":t[18]||(t[18]=o=>l.state=o),postalCode:l.postal_code,"onUpdate:postalCode":t[19]||(t[19]=o=>l.postal_code=o),initialLatitude:l.latitude,initialLongitude:l.longitude,initialCity:l.city,initialState:l.state,initialLocality:l.locality,initialPostalCode:l.postal_code},null,8,["latitude","longitude","locality","city","state","postalCode","initialLatitude","initialLongitude","initialCity","initialState","initialLocality","initialPostalCode"]))]),e("div",Ue,[e("button",{onClick:t[20]||(t[20]=o=>_.value=null),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:ot,class:"btn-primary flex-1"}," Save Changes ")])])])])):w("",!0),C.value?(n(),r("div",Ve,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[21]||(t[21]=o=>C.value=null)}),e("div",Fe,[t[54]||(t[54]=e("h3",{class:"text-lg font-semibold mb-4"},"Reject Listing",-1)),e("div",Ae,[e("div",null,[t[52]||(t[52]=e("label",{class:"label"},"Reason for rejection",-1)),x(e("select",{"onUpdate:modelValue":t[22]||(t[22]=o=>L.value=o),class:"input"},[...t[51]||(t[51]=[F('<option value="">Select a reason</option><option value="prohibited_item">Prohibited item</option><option value="misleading_info">Misleading information</option><option value="duplicate">Duplicate listing</option><option value="inappropriate_content">Inappropriate content</option><option value="wrong_category">Wrong category</option><option value="other">Other</option>',7)])],512),[[k,L.value]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"label"},"Additional notes (optional)",-1)),x(e("textarea",{"onUpdate:modelValue":t[23]||(t[23]=o=>S.value=o),rows:"3",class:"input",placeholder:"Explain the issue..."},null,512),[[U,S.value]])]),e("div",Pe,[e("button",{onClick:t[24]||(t[24]=o=>C.value=null),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:nt,disabled:!L.value,class:"btn-danger flex-1"}," Reject ",8,De)])])])])):w("",!0)])}}};export{Ke as default};
