import{x as ut,r as p,K,d as pt,D as ct,e as vt,c as i,o as r,a as e,f,t as c,g as d,i as L,j as u,y,z as gt,A as S,M as _,E as V,F as E,h as R,B as b,N as n,w as yt,p as F,R as xt,l as mt}from"./main-D2b3aB5_.js";import{d as bt}from"./dayjs.min-iy57P9mS.js";import{d as ft,r as _t}from"./debounce-YPUV875w.js";import{_ as wt}from"./LocationPicker-B5H8V0LT.js";import{r as W}from"./CheckIcon-BABDP88a.js";import{r as q}from"./TrashIcon-CmxTh2sF.js";import{r as ht}from"./StarIcon-Hx9EDvEV.js";import{r as kt}from"./BoltIcon-BCH0_Q3e.js";import{r as Ct}from"./SparklesIcon-v0bkj0OH.js";import{r as $t}from"./EyeIcon-BiNbPT5O.js";import{r as jt}from"./PencilIcon-Dv8mRzZQ.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./leaflet-Bln94WRs.js";const Lt={class:"p-6"},St={class:"flex items-center justify-between mb-6"},Ut={key:0,class:"flex items-center gap-2"},Vt={class:"text-sm text-gray-600"},Ft={class:"card p-4 mb-6"},At={class:"flex flex-wrap gap-4"},Dt={class:"flex-1 min-w-[200px]"},Nt={class:"relative"},Pt=["value"],Mt={class:"card overflow-hidden"},Et={class:"w-full"},Rt={class:"bg-gray-50"},Tt={class:"px-4 py-3 text-left"},Bt=["checked"],zt={class:"divide-y"},It={key:0},Yt={key:1},Ot={class:"px-4 py-3"},Gt=["checked","onChange"],Ht={class:"px-4 py-3"},Kt={class:"flex items-center gap-3"},Wt=["src","alt"],qt={class:"font-medium text-gray-900 truncate max-w-[200px]"},Jt={class:"text-xs text-gray-500"},Qt={class:"px-4 py-3"},Xt={class:"px-4 py-3 text-gray-600"},Zt={class:"px-4 py-3 font-medium text-gray-900"},te={class:"px-4 py-3"},ee=["onUpdate:modelValue","onChange"],se={class:"px-4 py-3"},oe={class:"flex gap-1"},le=["onClick"],ae=["onClick"],ne=["onClick"],ie={class:"px-4 py-3 text-xs text-gray-500"},re={class:"flex flex-col gap-1"},de={class:"px-4 py-3"},ue={class:"flex items-center gap-1"},pe=["onClick"],ce=["href"],ve=["onClick"],ge=["onClick"],ye=["onClick"],xe={key:0,class:"p-4 border-t flex items-center justify-between"},me={class:"text-sm text-gray-500"},be={class:"flex gap-2"},fe=["disabled"],_e=["disabled"],we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},he={class:"relative bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},ke={class:"space-y-4"},Ce={class:"grid grid-cols-2 gap-4"},$e={class:"grid grid-cols-2 gap-4"},je=["value"],Le={class:"flex gap-2 pt-4"},Se={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ue={class:"relative bg-white rounded-xl p-6 w-full max-w-md"},Ve={class:"space-y-4"},Fe={class:"flex gap-2"},Ae=["disabled"],Ke={__name:"Listings",setup(De){const T=ut(),A=p(!0),w=p([]),D=p(""),x=p(1),U=p(1),N=p(20),P=p(0),a=p([]),h=p(null),l=K({title:"",description:"",price:0,price_type:"fixed",category_id:null,condition:"",city:"",state:"",locality:"",postal_code:"",latitude:null,longitude:null}),k=p(null),$=p(""),j=p(""),C=K({status:"",category:""}),B=p([]),z=p([]),I=pt(()=>w.value.length>0&&w.value.every(o=>a.value.includes(o.id))),J=o=>bt(o).format("MMM D, YYYY"),Q=o=>({active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",rejected:"bg-red-100 text-red-800 border-red-200",sold:"bg-blue-100 text-blue-800 border-blue-200",expired:"bg-gray-100 text-gray-800 border-gray-200"})[o]||"bg-gray-100 text-gray-800",g=async()=>{A.value=!0;try{const o=await b.get("/admin/listings",{params:{page:x.value,search:D.value,status:C.status,category_id:C.category}});w.value=o.data.data,x.value=o.data.meta.current_page,U.value=o.data.meta.last_page,N.value=o.data.meta.per_page,P.value=o.data.meta.total}finally{A.value=!1}},Y=ft(()=>{x.value=1,g()},300),O=o=>{o>=1&&o<=U.value&&(x.value=o,g())},X=o=>{const t=a.value.indexOf(o);t>-1?a.value.splice(t,1):a.value.push(o)},Z=()=>{I.value?a.value=[]:a.value=w.value.map(o=>o.id)},tt=o=>{h.value=o,l.title=o.title,l.description=o.description,l.price=o.price,l.price_type=o.price_type,l.category_id=o.category_id,l.condition=o.condition||"",l.city=o.city||"",l.state=o.state||"",l.locality=o.locality||"",l.postal_code=o.postal_code||"",l.latitude=o.latitude?parseFloat(o.latitude):null,l.longitude=o.longitude?parseFloat(o.longitude):null},et=async()=>{try{await b.put(`/admin/listings/${h.value.id}`,l),n.success("Listing updated"),h.value=null,g()}catch{n.error("Failed to update listing")}},st=async o=>{try{await b.put(`/admin/listings/${o.id}`,{status:o.status}),n.success("Status updated")}catch{n.error("Failed to update status"),g()}},M=async(o,t)=>{try{const m=!o[t];await b.post(`/admin/listings/${o.id}/toggle-feature`,{[t]:m}),o[t]=m,n.success(`${t.replace("is_","").replace("_"," ")} ${m?"enabled":"disabled"}`)}catch{n.error("Failed to update badge")}},ot=async o=>{try{await b.post(`/admin/listings/${o.id}/approve`),n.success("Listing approved"),g()}catch{n.error("Failed to approve listing")}},lt=o=>{k.value=o,$.value="",j.value=""},at=async()=>{try{await b.post(`/admin/listings/${k.value.id}/reject`,{reason:$.value+(j.value?": "+j.value:"")}),n.success("Listing rejected"),k.value=null,g()}catch{n.error("Failed to reject listing")}},nt=async o=>{if(confirm(`Delete "${o.title}"? This cannot be undone.`))try{await b.delete(`/admin/listings/${o.id}`),n.success("Listing deleted"),g()}catch{n.error("Failed to delete listing")}},it=async()=>{if(confirm(`Approve ${a.value.length} listings?`))try{const o=await b.post("/admin/listings/bulk-approve",{ids:a.value});n.success(o.data.message),a.value=[],g()}catch{n.error("Failed to bulk approve")}},rt=async()=>{if(confirm(`Delete ${a.value.length} listings? This cannot be undone.`))try{const o=await b.post("/admin/listings/bulk-delete",{ids:a.value});n.success(o.data.message),a.value=[],g()}catch{n.error("Failed to bulk delete")}},dt=async()=>{try{const o=await b.get("/categories"),t=[];o.data.data.forEach(m=>{t.push(m),m.children&&m.children.forEach(s=>{t.push({...s,name:`  â”” ${s.name}`})})}),z.value=t}catch{console.error("Failed to fetch categories")}};return ct(async()=>{await T.fetchCategories(),B.value=T.categories,await dt(),g()}),(o,t)=>{const m=vt("router-link");return r(),i("div",Lt,[e("div",St,[t[27]||(t[27]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Manage Listings",-1)),a.value.length?(r(),i("div",Ut,[e("span",Vt,c(a.value.length)+" selected",1),e("button",{onClick:it,class:"btn-primary btn-sm"},[d(u(W),{class:"w-4 h-4 mr-1"}),t[25]||(t[25]=L(" Approve All ",-1))]),e("button",{onClick:rt,class:"btn-danger btn-sm"},[d(u(q),{class:"w-4 h-4 mr-1"}),t[26]||(t[26]=L(" Delete All ",-1))]),e("button",{onClick:t[0]||(t[0]=s=>a.value=[]),class:"btn-secondary btn-sm"}," Clear ")])):f("",!0)]),e("div",Ft,[e("div",At,[e("div",Dt,[e("div",Nt,[d(u(gt),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>D.value=s),type:"text",placeholder:"Search listings...",class:"input pl-10",onInput:t[2]||(t[2]=(...s)=>u(Y)&&u(Y)(...s))},null,544),[[S,D.value]])])]),y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>C.status=s),onChange:g,class:"input w-auto"},[...t[28]||(t[28]=[V('<option value="">All Status</option><option value="pending">Pending</option><option value="active">Active</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',6)])],544),[[_,C.status]]),y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>C.category=s),onChange:g,class:"input w-auto"},[t[29]||(t[29]=e("option",{value:""},"All Categories",-1)),(r(!0),i(E,null,R(B.value,s=>(r(),i("option",{key:s.id,value:s.id},c(s.name),9,Pt))),128))],544),[[_,C.category]])])]),e("div",Mt,[e("table",Et,[e("thead",Rt,[e("tr",null,[e("th",Tt,[e("input",{type:"checkbox",checked:I.value,onChange:Z,class:"rounded border-gray-300"},null,40,Bt)]),t[30]||(t[30]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Listing",-1)),t[31]||(t[31]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Seller",-1)),t[32]||(t[32]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Category",-1)),t[33]||(t[33]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Price",-1)),t[34]||(t[34]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Status",-1)),t[35]||(t[35]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Badges",-1)),t[36]||(t[36]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Stats",-1)),t[37]||(t[37]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions",-1))])]),e("tbody",zt,[A.value?(r(),i("tr",It,[...t[38]||(t[38]=[e("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," Loading... ",-1)])])):w.value.length?f("",!0):(r(),i("tr",Yt,[...t[39]||(t[39]=[e("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," No listings found ",-1)])])),(r(!0),i(E,null,R(w.value,s=>{var G,H;return r(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Ot,[e("input",{type:"checkbox",checked:a.value.includes(s.id),onChange:v=>X(s.id),class:"rounded border-gray-300"},null,40,Gt)]),e("td",Ht,[e("div",Kt,[e("img",{src:s.primary_image_url,alt:s.title,class:"w-12 h-12 rounded object-cover"},null,8,Wt),e("div",null,[e("p",qt,c(s.title),1),e("p",Jt,"ID: "+c(s.id)+" | "+c(J(s.created_at)),1)])])]),e("td",Qt,[d(m,{to:`/admin/users?search=${(G=s.user)==null?void 0:G.email}`,class:"text-primary-600 hover:underline"},{default:yt(()=>{var v;return[L(c((v=s.user)==null?void 0:v.name),1)]}),_:2},1032,["to"])]),e("td",Xt,c((H=s.category)==null?void 0:H.name),1),e("td",Zt,c(s.formatted_price),1),e("td",te,[y(e("select",{"onUpdate:modelValue":v=>s.status=v,onChange:v=>st(s),class:F(["text-xs border rounded px-2 py-1",Q(s.status)])},[...t[40]||(t[40]=[V('<option value="active">Active</option><option value="pending">Pending</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',5)])],42,ee),[[_,s.status]])]),e("td",se,[e("div",oe,[e("button",{onClick:v=>M(s,"is_featured"),class:F([s.is_featured?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Featured"},[d(u(ht),{class:"w-3 h-3"})],10,le),e("button",{onClick:v=>M(s,"is_urgent"),class:F([s.is_urgent?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Urgent"},[d(u(kt),{class:"w-3 h-3"})],10,ae),e("button",{onClick:v=>M(s,"is_highlighted"),class:F([s.is_highlighted?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Highlighted"},[d(u(Ct),{class:"w-3 h-3"})],10,ne)])]),e("td",ie,[e("div",re,[e("span",null,[d(u($t),{class:"w-3 h-3 inline"}),L(" "+c(s.views_count||0),1)]),e("span",null,[d(u(xt),{class:"w-3 h-3 inline"}),L(" "+c(s.favorites_count||0),1)])])]),e("td",de,[e("div",ue,[e("button",{onClick:v=>tt(s),class:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit"},[d(u(jt),{class:"w-5 h-5"})],8,pe),e("a",{href:`/listing/${s.slug}`,target:"_blank",class:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"View"},[d(u(_t),{class:"w-5 h-5"})],8,ce),s.status==="pending"?(r(),i("button",{key:0,onClick:v=>ot(s),class:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Approve"},[d(u(W),{class:"w-5 h-5"})],8,ve)):f("",!0),s.status==="pending"?(r(),i("button",{key:1,onClick:v=>lt(s),class:"p-1 text-orange-600 hover:bg-orange-50 rounded",title:"Reject"},[d(u(mt),{class:"w-5 h-5"})],8,ge)):f("",!0),e("button",{onClick:v=>nt(s),class:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete"},[d(u(q),{class:"w-5 h-5"})],8,ye)])])])}),128))])]),U.value>1?(r(),i("div",xe,[e("p",me," Showing "+c((x.value-1)*N.value+1)+" to "+c(Math.min(x.value*N.value,P.value))+" of "+c(P.value)+" listings ",1),e("div",be,[e("button",{onClick:t[5]||(t[5]=s=>O(x.value-1)),disabled:x.value===1,class:"btn-secondary btn-sm"}," Previous ",8,fe),e("button",{onClick:t[6]||(t[6]=s=>O(x.value+1)),disabled:x.value===U.value,class:"btn-secondary btn-sm"}," Next ",8,_e)])])):f("",!0)]),h.value?(r(),i("div",we,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[7]||(t[7]=s=>h.value=null)}),e("div",he,[t[50]||(t[50]=e("h3",{class:"text-lg font-semibold mb-4"},"Edit Listing",-1)),e("div",ke,[e("div",null,[t[41]||(t[41]=e("label",{class:"label"},"Title",-1)),y(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.title=s),class:"input"},null,512),[[S,l.title]])]),e("div",null,[t[42]||(t[42]=e("label",{class:"label"},"Description",-1)),y(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=s=>l.description=s),rows:"4",class:"input"},null,512),[[S,l.description]])]),e("div",Ce,[e("div",null,[t[43]||(t[43]=e("label",{class:"label"},"Price",-1)),y(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>l.price=s),type:"number",class:"input"},null,512),[[S,l.price]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"label"},"Price Type",-1)),y(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>l.price_type=s),class:"input"},[...t[44]||(t[44]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"negotiable"},"Negotiable",-1),e("option",{value:"free"},"Free",-1),e("option",{value:"contact"},"Contact for Price",-1)])],512),[[_,l.price_type]])])]),e("div",$e,[e("div",null,[t[46]||(t[46]=e("label",{class:"label"},"Category",-1)),y(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>l.category_id=s),class:"input"},[(r(!0),i(E,null,R(z.value,s=>(r(),i("option",{key:s.id,value:s.id},c(s.name),9,je))),128))],512),[[_,l.category_id]])]),e("div",null,[t[48]||(t[48]=e("label",{class:"label"},"Condition",-1)),y(e("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>l.condition=s),class:"input"},[...t[47]||(t[47]=[V('<option value="">Not specified</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[_,l.condition]])])]),e("div",null,[t[49]||(t[49]=e("label",{class:"label"},"Location",-1)),d(wt,{latitude:l.latitude,"onUpdate:latitude":t[14]||(t[14]=s=>l.latitude=s),longitude:l.longitude,"onUpdate:longitude":t[15]||(t[15]=s=>l.longitude=s),locality:l.locality,"onUpdate:locality":t[16]||(t[16]=s=>l.locality=s),city:l.city,"onUpdate:city":t[17]||(t[17]=s=>l.city=s),state:l.state,"onUpdate:state":t[18]||(t[18]=s=>l.state=s),postalCode:l.postal_code,"onUpdate:postalCode":t[19]||(t[19]=s=>l.postal_code=s),initialLatitude:l.latitude,initialLongitude:l.longitude},null,8,["latitude","longitude","locality","city","state","postalCode","initialLatitude","initialLongitude"])]),e("div",Le,[e("button",{onClick:t[20]||(t[20]=s=>h.value=null),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:et,class:"btn-primary flex-1"}," Save Changes ")])])])])):f("",!0),k.value?(r(),i("div",Se,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[21]||(t[21]=s=>k.value=null)}),e("div",Ue,[t[54]||(t[54]=e("h3",{class:"text-lg font-semibold mb-4"},"Reject Listing",-1)),e("div",Ve,[e("div",null,[t[52]||(t[52]=e("label",{class:"label"},"Reason for rejection",-1)),y(e("select",{"onUpdate:modelValue":t[22]||(t[22]=s=>$.value=s),class:"input"},[...t[51]||(t[51]=[V('<option value="">Select a reason</option><option value="prohibited_item">Prohibited item</option><option value="misleading_info">Misleading information</option><option value="duplicate">Duplicate listing</option><option value="inappropriate_content">Inappropriate content</option><option value="wrong_category">Wrong category</option><option value="other">Other</option>',7)])],512),[[_,$.value]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"label"},"Additional notes (optional)",-1)),y(e("textarea",{"onUpdate:modelValue":t[23]||(t[23]=s=>j.value=s),rows:"3",class:"input",placeholder:"Explain the issue..."},null,512),[[S,j.value]])]),e("div",Fe,[e("button",{onClick:t[24]||(t[24]=s=>k.value=null),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:at,disabled:!$.value,class:"btn-danger flex-1"}," Reject ",8,Ae)])])])])):f("",!0)])}}};export{Ke as default};
