var h=Object.defineProperty;var c=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var p=(t,s,i)=>s in t?h(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,l=(t,s)=>{for(var i in s||(s={}))m.call(s,i)&&p(t,i,s[i]);if(c)for(var i of c(s))y.call(s,i)&&p(t,i,s[i]);return t};var a=(t,s,i)=>new Promise((e,o)=>{var u=r=>{try{g(i.next(r))}catch(d){o(d)}},f=r=>{try{g(i.throw(r))}catch(d){o(d)}},g=r=>r.done?e(r.value):Promise.resolve(r.value).then(u,f);g((i=i.apply(t,s)).next())});import{j as L}from"./vue-vendor-JbibKI1S.js";import{b as n}from"./main-capacitor-DexhVPa1.js";const b=L("listings",{state:()=>({listings:[],currentListing:null,myListings:[],favorites:[],filters:{q:"",category:null,city:null,min_price:null,max_price:null,condition:null,sort:"nearest",latitude:null,longitude:null},pagination:{current_page:1,last_page:1,per_page:20,total:0},loading:!1}),getters:{hasMore:t=>t.pagination.current_page<t.pagination.last_page},actions:{fetchListings(){return a(this,arguments,function*(t={},s=!1){this.loading=!0;try{const i=yield n.get("/listings",{params:l(l({},this.filters),t)});return s?this.listings=[...this.listings,...i.data.data]:this.listings=i.data.data,this.pagination=i.data.meta,i.data}finally{this.loading=!1}})},fetchListing(t){return a(this,null,function*(){this.loading=!0;try{const s=yield n.get(`/listings/${t}`);return this.currentListing=s.data.data.listing,s.data.data}finally{this.loading=!1}})},createListing(t){return a(this,null,function*(){const s=new FormData;return Object.keys(t).forEach(e=>{e==="images"?t.images.forEach(o=>{s.append("images[]",o)}):e==="attributes"&&t.attributes?s.append("attributes",JSON.stringify(t.attributes)):t[e]!==null&&t[e]!==void 0&&s.append(e,t[e])}),(yield n.post("/listings",s,{headers:{"Content-Type":"multipart/form-data"}})).data})},updateListing(t,s){return a(this,null,function*(){return(yield n.put(`/listings/${t}`,s)).data})},deleteListing(t){return a(this,null,function*(){yield n.delete(`/listings/${t}`),this.myListings=this.myListings.filter(s=>s.id!==t)})},markAsSold(t){return a(this,null,function*(){const s=yield n.post(`/listings/${t}/sold`),i=this.myListings.findIndex(e=>e.id===t);return i!==-1&&(this.myListings[i]=s.data.data),s.data})},renewListing(t){return a(this,null,function*(){return(yield n.post(`/listings/${t}/renew`)).data})},fetchMyListings(){return a(this,arguments,function*(t={}){this.loading=!0;try{const s=yield n.get("/my-listings",{params:t});return this.myListings=s.data.data,this.pagination=s.data.meta,s.data}finally{this.loading=!1}})},fetchFavorites(){return a(this,null,function*(){this.loading=!0;try{const t=yield n.get("/favorites");return this.favorites=t.data.data,this.pagination=t.data.meta,t.data}finally{this.loading=!1}})},toggleFavorite(t){return a(this,null,function*(){return(yield n.post(`/favorites/toggle/${t}`)).data.data})},addImages(t,s){return a(this,null,function*(){const i=new FormData;return s.forEach(e=>{i.append("images[]",e)}),yield n.post(`/listings/${t}/images`,i,{headers:{"Content-Type":"multipart/form-data"}})})},deleteImage(t,s){return a(this,null,function*(){return yield n.delete(`/listings/${t}/images/${s}`)})},setFilters(t){this.filters=l(l({},this.filters),t)},resetFilters(){const{latitude:t,longitude:s}=this.filters;this.filters={q:"",category:null,city:null,min_price:null,max_price:null,condition:null,sort:t&&s?"nearest":"newest",latitude:t,longitude:s}},clearListing(){this.currentListing=null},setUserLocation(t,s){this.filters.latitude=t,this.filters.longitude=s,t&&s&&this.filters.sort==="newest"&&(this.filters.sort="nearest")}}});export{b as u};
