import{c as o,o as l,a as e,r as b,d as D,D as G,P as le,L as H,f as n,t as d,i as _,_ as ae,C as J,g as f,j as h,l as oe,F as z,h as A,p as T,y as N,A as W,Q as ie,m as V,B as K,N as U,u as re,b as ne,e as de,E as ue,I as ce,R as me,w as Z,s as ve}from"./main-DT8B7HGo.js";import{u as pe}from"./listings-BZKQrY8d.js";import{_ as ge}from"./ListingCard-COa5Z0jy.js";import{L as j}from"./leaflet-Bln94WRs.js";import{_ as fe}from"./LoadingSpinner-BL5STjIN.js";import{r as he}from"./ChatBubbleLeftIcon-C88OWF73.js";import{R as ye}from"./ReportModal-BHcoTxQZ.js";import{d as xe}from"./dayjs.min-iy57P9mS.js";import{r as _e}from"./MapPinIcon-oeVfKid2.js";import{r as be}from"./ClockIcon-Bw8_75LN.js";import{r as we}from"./EyeIcon-BG2WFC4A.js";import{r as ke}from"./StarIcon-Dfm6UtTC.js";import{r as $e}from"./CheckBadgeIcon-B3tpaWZ2.js";import{r as Q}from"./PhoneIcon-YvZEPEa5.js";import{r as Ce}from"./FlagIcon-CUCCV56N.js";import"./relativeTime-D5nU98bY.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./SparklesIcon-BlNEuoGk.js";import"./BoltIcon-B81Yt4ox.js";function je(y,i){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function Me(y,i){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}const Se={class:"location-display"},Ie={class:"mt-3 space-y-2"},Ve={class:"flex items-start gap-2"},De={class:"text-gray-900 font-medium"},Le={key:0,class:"text-sm text-gray-500"},Be=["href"],Ne={__name:"LocationDisplay",props:{latitude:{type:Number,default:null},longitude:{type:Number,default:null},locality:{type:String,default:""},city:{type:String,default:""},state:{type:String,default:""},postalCode:{type:String,default:""}},setup(y){delete j.Icon.Default.prototype._getIconUrl,j.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const i=y,w=b(null);let c=null,k=null;const $=D(()=>i.latitude&&i.longitude),t=D(()=>{const r=[];return i.locality&&r.push(i.locality),i.city&&r.push(i.city),i.state&&r.push(i.state),r.join(", ")||"Location not specified"}),C=D(()=>$.value?`https://www.google.com/maps/dir/?api=1&destination=${i.latitude},${i.longitude}`:"#");G(()=>{m()}),le(()=>{c&&(c.remove(),c=null)});const m=()=>{if(!w.value)return;const r=i.latitude||20.5937,v=i.longitude||78.9629,I=$.value?14:5;c=j.map(w.value,{scrollWheelZoom:!1,dragging:!j.Browser.mobile,tap:!1}).setView([r,v],I),j.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(c),$.value&&(j.circle([i.latitude,i.longitude],{color:"#0d9488",fillColor:"#0d9488",fillOpacity:.2,radius:500}).addTo(c),k=j.marker([i.latitude,i.longitude]).addTo(c))};return H(()=>[i.latitude,i.longitude],([r,v])=>{c&&r&&v&&(c.setView([r,v],14),k&&c.removeLayer(k),j.circle([r,v],{color:"#0d9488",fillColor:"#0d9488",fillOpacity:.2,radius:500}).addTo(c),k=j.marker([r,v]).addTo(c))}),(r,v)=>(l(),o("div",Se,[e("div",{ref_key:"mapContainer",ref:w,class:"h-48 rounded-lg border border-gray-200 z-0"},null,512),e("div",Ie,[e("div",Ve,[v[0]||(v[0]=e("svg",{class:"w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),e("div",null,[e("p",De,d(t.value),1),y.postalCode?(l(),o("p",Le,"PIN: "+d(y.postalCode),1)):n("",!0)])]),$.value?(l(),o("a",{key:0,href:C.value,target:"_blank",class:"inline-flex items-center gap-2 text-sm text-primary-600 hover:text-primary-700"},[...v[1]||(v[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})],-1),_(" Get Directions ",-1)])],8,Be)):n("",!0)])]))}},Ue={class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},ze={class:"relative bg-white w-full sm:max-w-md sm:rounded-xl rounded-t-xl animate-slide-up max-h-[90vh] overflow-y-auto"},Ae={class:"flex items-center justify-between p-4 border-b"},Te={key:0,class:"p-4 bg-gray-50 border-b"},Re={class:"flex gap-3"},Oe=["src","alt"],Ye={class:"flex-1 min-w-0"},Fe={class:"font-medium text-gray-900 truncate"},Pe={class:"text-lg font-bold text-primary-600"},Ee={class:"p-4 border-b"},We={class:"flex flex-wrap gap-2"},Ze=["onClick"],Qe={class:"p-4"},Ge={class:"mt-3"},He={class:"flex items-center gap-2 text-sm"},Je={key:0,class:"mt-2 flex items-center gap-2"},Ke=["max"],Xe={class:"flex gap-3 p-4 border-t bg-gray-50 sm:rounded-b-xl safe-area-bottom"},qe=["disabled"],et={__name:"ChatModal",props:{listing:{type:Object,required:!0}},emits:["close","sent"],setup(y,{emit:i}){const w=y,c=D(()=>{var x,a,p;return((a=(x=w.listing)==null?void 0:x.user)==null?void 0:a.id)||((p=w.listing)==null?void 0:p.user_id)}),k=i,$=J(),t=b(""),C=b(!1),m=b(null),r=b(!1),v=["Is this still available?","Can you share more photos?","What is the condition?","Is the price negotiable?","Can I see it today?"],I=async()=>{var x,a;if(t.value.trim()){r.value=!0;try{const p={listing_id:w.listing.id,receiver_id:c.value,message:t.value.trim()};C.value&&m.value&&(p.offer_amount=m.value);const u=await K.post("/conversations",p);U.success("Message sent!"),k("sent",u.data.data),k("close");const B=u.data.data.conversation;$.push(`/messages/${B.uuid}`)}catch(p){if(((x=p.response)==null?void 0:x.status)===409){U.info("You already have a conversation about this listing");const u=((a=p.response.data.data)==null?void 0:a.uuid)||p.response.data.uuid;$.push(`/messages/${u}`),k("close")}else U.error("Failed to send message")}finally{r.value=!1}}};return(x,a)=>{var p;return l(),o("div",Ue,[e("div",{class:"absolute inset-0 bg-black/50",onClick:a[0]||(a[0]=u=>x.$emit("close"))}),e("div",ze,[e("div",Ae,[a[6]||(a[6]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Contact Seller",-1)),e("button",{onClick:a[1]||(a[1]=u=>x.$emit("close")),class:"p-1 hover:bg-gray-100 rounded"},[f(h(oe),{class:"w-5 h-5 text-gray-500"})])]),y.listing?(l(),o("div",Te,[e("div",Re,[e("img",{src:y.listing.primary_image_url,alt:y.listing.title,class:"w-16 h-16 rounded-lg object-cover"},null,8,Oe),e("div",Ye,[e("h4",Fe,d(y.listing.title),1),e("p",Pe,d(y.listing.formatted_price),1)])])])):n("",!0),e("div",Ee,[a[7]||(a[7]=e("p",{class:"text-sm text-gray-500 mb-3"},"Quick messages:",-1)),e("div",We,[(l(),o(z,null,A(v,u=>e("button",{key:u,onClick:B=>t.value=u,class:T(["px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition",t.value===u?"bg-primary-100 text-primary-700":""])},d(u),11,Ze)),64))])]),e("div",Qe,[N(e("textarea",{"onUpdate:modelValue":a[2]||(a[2]=u=>t.value=u),rows:"3",class:"input resize-none",placeholder:"Write your message..."},null,512),[[W,t.value]]),e("div",Ge,[e("label",He,[N(e("input",{type:"checkbox","onUpdate:modelValue":a[3]||(a[3]=u=>C.value=u),class:"rounded text-primary-600"},null,512),[[ie,C.value]]),a[8]||(a[8]=_(" Include an offer ",-1))]),C.value?(l(),o("div",Je,[a[9]||(a[9]=e("span",{class:"text-gray-500"},"â‚¹",-1)),N(e("input",{"onUpdate:modelValue":a[4]||(a[4]=u=>m.value=u),type:"number",class:"input flex-1",placeholder:"Your offer amount",max:(p=y.listing)==null?void 0:p.price},null,8,Ke),[[W,m.value,void 0,{number:!0}]])])):n("",!0)])]),e("div",Xe,[e("button",{onClick:a[5]||(a[5]=u=>x.$emit("close")),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:I,disabled:!t.value.trim()||r.value,class:"btn-primary flex-1"},[r.value?(l(),V(fe,{key:1,class:"w-5 h-5 mr-2"})):(l(),V(h(he),{key:0,class:"w-5 h-5 mr-2"})),_(" "+d(r.value?"Sending...":"Send Message"),1)],8,qe)])])])}}},tt=ae(et,[["__scopeId","data-v-90892009"]]),st={class:"min-h-screen bg-gray-50 py-6"},lt={class:"container-app"},at={key:0,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ot={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},it={class:"lg:col-span-2 space-y-6"},rt={class:"card overflow-hidden"},nt={class:"relative aspect-[4/3] bg-gray-100"},dt=["src","alt"],ut={key:0,class:"flex gap-2 p-4 overflow-x-auto"},ct=["onClick"],mt=["src"],vt={class:"card p-6"},pt={class:"flex items-start justify-between mb-4"},gt={class:"text-2xl font-bold text-primary-600"},ft={class:"text-xl font-semibold text-gray-900 mt-1"},ht={class:"flex items-center gap-2"},yt={class:"flex flex-wrap gap-4 text-sm text-gray-500 mb-6"},xt={class:"flex items-center"},_t={class:"flex items-center"},bt={class:"flex items-center"},wt={class:"border-t pt-6"},kt={class:"text-gray-600 whitespace-pre-line"},$t={key:0,class:"border-t pt-6 mt-6"},Ct={class:"grid grid-cols-2 gap-4"},jt={key:0},Mt={class:"ml-2 font-medium capitalize"},St={key:1},It={class:"ml-2 font-medium"},Vt={key:2},Dt={class:"ml-2 font-medium"},Lt={key:3},Bt={class:"ml-2 font-medium"},Nt={class:"card p-6"},Ut={class:"space-y-6"},zt={class:"card p-6"},At={class:"flex items-center gap-4 mb-4"},Tt=["src","alt"],Rt={class:"flex items-center text-sm text-gray-500"},Ot={class:"text-sm text-gray-500"},Yt={key:0,class:"flex items-center text-green-600 text-sm mb-4"},Ft={class:"space-y-3"},Pt=["href"],Et={key:2,class:"mt-12"},Wt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ms={__name:"ListingDetail",setup(y){const i=re(),w=J(),c=ne(),k=pe(),$=b(!0),t=b(null),C=b([]),m=b(0),r=b(!1),v=b(!1),I=b(!1),x=b(!1),a=D(()=>{var g,s,M,L;return(s=(g=t.value)==null?void 0:g.images)!=null&&s.length?(L=t.value.images[m.value])==null?void 0:L.url:(M=t.value)==null?void 0:M.primary_image_url}),p=D(()=>{var g,s,M;return((g=c.user)==null?void 0:g.id)===((M=(s=t.value)==null?void 0:s.user)==null?void 0:M.id)}),u=g=>xe(g).format("MMM D, YYYY"),B=()=>{m.value>0?m.value--:m.value=t.value.images.length-1},X=()=>{m.value<t.value.images.length-1?m.value++:m.value=0},q=async()=>{if(!c.isAuthenticated){w.push("/login");return}const g=await k.toggleFavorite(t.value.id);r.value=g.is_favorited},ee=()=>{if(!c.isAuthenticated){w.push("/login");return}v.value=!0},te=()=>{navigator.share&&navigator.share({title:t.value.title,text:`Check out this listing: ${t.value.title}`,url:window.location.href})},se=async()=>{if(!c.isAuthenticated){w.push("/login");return}try{await K.post(`/listings/${t.value.id}/track-contact`,{type:"phone"})}catch{}x.value=!0},R=async()=>{var g;try{const s=await k.fetchListing(i.params.slug);t.value=s.listing,C.value=s.similar,r.value=s.listing.is_favorited}catch(s){((g=s.response)==null?void 0:g.status)===404&&w.push("/404")}finally{$.value=!1}};return G(()=>{R()}),H(()=>i.params.slug,(g,s)=>{g!==s&&($.value=!0,m.value=0,x.value=!1,R())}),(g,s)=>{var L,O,Y,F,P;const M=de("router-link");return l(),o("div",st,[e("div",lt,[$.value?(l(),o("div",at,[...s[3]||(s[3]=[ue('<div class="lg:col-span-2"><div class="card p-4"><div class="skeleton h-96 mb-4"></div><div class="skeleton h-8 w-1/3 mb-2"></div><div class="skeleton h-6 w-full mb-4"></div><div class="skeleton h-24 w-full"></div></div></div><div class="card p-4"><div class="skeleton h-16 w-full mb-4"></div><div class="skeleton h-12 w-full mb-2"></div><div class="skeleton h-12 w-full"></div></div>',2)])])):t.value?(l(),o("div",ot,[e("div",it,[e("div",rt,[e("div",nt,[e("img",{src:a.value,alt:t.value.title,class:"w-full h-full object-contain"},null,8,dt),((L=t.value.images)==null?void 0:L.length)>1?(l(),o("button",{key:0,onClick:B,class:"absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center hover:bg-white"},[f(h(je),{class:"w-6 h-6"})])):n("",!0),((O=t.value.images)==null?void 0:O.length)>1?(l(),o("button",{key:1,onClick:X,class:"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center hover:bg-white"},[f(h(ce),{class:"w-6 h-6"})])):n("",!0)]),((Y=t.value.images)==null?void 0:Y.length)>1?(l(),o("div",ut,[(l(!0),o(z,null,A(t.value.images,(S,E)=>(l(),o("button",{key:S.id,onClick:Zt=>m.value=E,class:T(["w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden border-2",m.value===E?"border-primary-500":"border-transparent"])},[e("img",{src:S.thumbnail_url,class:"w-full h-full object-cover"},null,8,mt)],10,ct))),128))])):n("",!0)]),e("div",vt,[e("div",pt,[e("div",null,[e("p",gt,d(t.value.formatted_price),1),e("h1",ft,d(t.value.title),1)]),e("div",ht,[e("button",{onClick:q,class:"p-2 rounded-full hover:bg-gray-100"},[f(h(me),{class:T(["w-6 h-6",r.value?"text-red-500 fill-current":"text-gray-400"])},null,8,["class"])]),e("button",{onClick:te,class:"p-2 rounded-full hover:bg-gray-100"},[f(h(Me),{class:"w-6 h-6 text-gray-400"})])])]),e("div",yt,[e("span",xt,[f(h(_e),{class:"w-4 h-4 mr-1"}),_(" "+d(t.value.location),1)]),e("span",_t,[f(h(be),{class:"w-4 h-4 mr-1"}),_(" "+d(u(t.value.published_at)),1)]),e("span",bt,[f(h(we),{class:"w-4 h-4 mr-1"}),_(" "+d(t.value.views_count)+" views ",1)])]),e("div",wt,[s[4]||(s[4]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Description",-1)),e("p",kt,d(t.value.description),1)]),t.value.attributes?(l(),o("div",$t,[s[9]||(s[9]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Details",-1)),e("div",Ct,[t.value.condition?(l(),o("div",jt,[s[5]||(s[5]=e("span",{class:"text-gray-500"},"Condition:",-1)),e("span",Mt,d(t.value.condition.replace("_"," ")),1)])):n("",!0),t.value.brand?(l(),o("div",St,[s[6]||(s[6]=e("span",{class:"text-gray-500"},"Brand:",-1)),e("span",It,d(t.value.brand),1)])):n("",!0),t.value.model?(l(),o("div",Vt,[s[7]||(s[7]=e("span",{class:"text-gray-500"},"Model:",-1)),e("span",Dt,d(t.value.model),1)])):n("",!0),t.value.year?(l(),o("div",Lt,[s[8]||(s[8]=e("span",{class:"text-gray-500"},"Year:",-1)),e("span",Bt,d(t.value.year),1)])):n("",!0)])])):n("",!0)]),e("div",Nt,[s[10]||(s[10]=e("h3",{class:"font-semibold text-gray-900 mb-4"},"Location",-1)),f(Ne,{latitude:t.value.latitude,longitude:t.value.longitude,locality:t.value.locality,city:t.value.city,state:t.value.state,"postal-code":t.value.postal_code},null,8,["latitude","longitude","locality","city","state","postal-code"])])]),e("div",Ut,[e("div",zt,[e("div",At,[e("img",{src:t.value.user.avatar_url,alt:t.value.user.name,class:"w-14 h-14 rounded-full object-cover"},null,8,Tt),e("div",null,[f(M,{to:`/user/${t.value.user.id}`,class:"font-semibold text-gray-900 hover:text-primary-600"},{default:Z(()=>[_(d(t.value.user.name),1)]),_:1},8,["to"]),e("div",Rt,[f(h(ke),{class:"w-4 h-4 text-yellow-400 mr-1"}),_(" "+d(t.value.user.rating||"0.0")+" ("+d(t.value.user.total_reviews)+" reviews) ",1)]),e("p",Ot,d(t.value.user.city),1)])]),t.value.user.is_verified_seller?(l(),o("div",Yt,[f(h($e),{class:"w-5 h-5 mr-1"}),s[11]||(s[11]=_(" Verified Seller ",-1))])):n("",!0),e("div",Ft,[p.value?n("",!0):(l(),o("button",{key:0,onClick:ee,class:"btn-primary w-full"},[f(h(ve),{class:"w-5 h-5 mr-2"}),s[12]||(s[12]=_(" Chat with Seller ",-1))])),t.value.user.phone&&!p.value&&!x.value?(l(),o("button",{key:1,onClick:se,class:"btn-outline w-full"},[f(h(Q),{class:"w-5 h-5 mr-2"}),s[13]||(s[13]=_(" Show Phone Number ",-1))])):n("",!0),t.value.user.phone&&!p.value&&x.value?(l(),o("a",{key:2,href:`tel:${t.value.user.phone}`,class:"btn-outline w-full text-green-600 border-green-600"},[f(h(Q),{class:"w-5 h-5 mr-2"}),_(" "+d(t.value.user.phone),1)],8,Pt)):n("",!0),p.value?(l(),V(M,{key:3,to:`/listing/${t.value.id}/edit`,class:"btn-primary w-full"},{default:Z(()=>[...s[14]||(s[14]=[_(" Edit Listing ",-1)])]),_:1},8,["to"])):n("",!0)])]),s[16]||(s[16]=e("div",{class:"card p-6 bg-yellow-50 border-yellow-200"},[e("h3",{class:"font-semibold text-yellow-800 mb-2"},"Safety Tips"),e("ul",{class:"text-sm text-yellow-700 space-y-1"},[e("li",null,"Meet in a safe public place"),e("li",null,"Check the item before you pay"),e("li",null,"Pay only after collecting the item"),e("li",null,"Never share financial information")])],-1)),e("button",{onClick:s[0]||(s[0]=S=>I.value=!0),class:"text-sm text-gray-500 hover:text-red-600 flex items-center"},[f(h(Ce),{class:"w-4 h-4 mr-1"}),s[15]||(s[15]=_(" Report this ad ",-1))])])])):n("",!0),(F=C.value)!=null&&F.length?(l(),o("div",Et,[s[17]||(s[17]=e("h2",{class:"text-xl font-bold text-gray-900 mb-6"},"Similar Ads",-1)),e("div",Wt,[(l(!0),o(z,null,A(C.value,S=>(l(),V(ge,{key:S.id,listing:S},null,8,["listing"]))),128))])])):n("",!0)]),v.value?(l(),V(tt,{key:0,listing:t.value,onClose:s[1]||(s[1]=S=>v.value=!1)},null,8,["listing"])):n("",!0),I.value?(l(),V(ye,{key:1,type:"listing",id:(P=t.value)==null?void 0:P.id,onClose:s[2]||(s[2]=S=>I.value=!1)},null,8,["id"])):n("",!0)])}}};export{ms as default};
