import{x as ue,r as u,K,d as pe,D as ce,e as ve,c as i,o as r,a as t,f,t as p,g as c,i as V,j as d,y as v,z as ge,A as h,M as _,E as A,F as E,h as R,B as b,N as n,w as xe,p as F,S as ye,l as me}from"./main-QOXgzBjM.js";import{d as be}from"./dayjs.min-iy57P9mS.js";import{d as fe,r as he}from"./debounce-D-EySxim.js";import{r as W}from"./CheckIcon-sPSebsCK.js";import{a as q,r as _e}from"./TrashIcon-BULEr89-.js";import{r as we}from"./StarIcon-DQOnUAEt.js";import{r as ke}from"./BoltIcon-CZ-Je01x.js";import{r as Ce}from"./SparklesIcon-Cd-n_rvt.js";import{r as $e}from"./EyeIcon-9WlAgF1x.js";import"./_commonjsHelpers-Cpj98o6Y.js";const je={class:"p-6"},Se={class:"flex items-center justify-between mb-6"},Ve={key:0,class:"flex items-center gap-2"},Le={class:"text-sm text-gray-600"},Ae={class:"card p-4 mb-6"},Fe={class:"flex flex-wrap gap-4"},Ue={class:"flex-1 min-w-[200px]"},De={class:"relative"},Ne=["value"],Pe={class:"card overflow-hidden"},Me={class:"w-full"},Ee={class:"bg-gray-50"},Re={class:"px-4 py-3 text-left"},Te=["checked"],Be={class:"divide-y"},ze={key:0},Ie={key:1},Ye={class:"px-4 py-3"},Oe=["checked","onChange"],Ge={class:"px-4 py-3"},He={class:"flex items-center gap-3"},Ke=["src","alt"],We={class:"font-medium text-gray-900 truncate max-w-[200px]"},qe={class:"text-xs text-gray-500"},Je={class:"px-4 py-3"},Qe={class:"px-4 py-3 text-gray-600"},Xe={class:"px-4 py-3 font-medium text-gray-900"},Ze={class:"px-4 py-3"},et=["onUpdate:modelValue","onChange"],tt={class:"px-4 py-3"},st={class:"flex gap-1"},ot=["onClick"],lt=["onClick"],at=["onClick"],nt={class:"px-4 py-3 text-xs text-gray-500"},it={class:"flex flex-col gap-1"},rt={class:"px-4 py-3"},dt={class:"flex items-center gap-1"},ut=["onClick"],pt=["href"],ct=["onClick"],vt=["onClick"],gt=["onClick"],xt={key:0,class:"p-4 border-t flex items-center justify-between"},yt={class:"text-sm text-gray-500"},mt={class:"flex gap-2"},bt=["disabled"],ft=["disabled"],ht={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},_t={class:"relative bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},wt={class:"space-y-4"},kt={class:"grid grid-cols-2 gap-4"},Ct={class:"grid grid-cols-2 gap-4"},$t=["value"],jt={class:"grid grid-cols-2 gap-4"},St={class:"flex gap-2 pt-4"},Vt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Lt={class:"relative bg-white rounded-xl p-6 w-full max-w-md"},At={class:"space-y-4"},Ft={class:"flex gap-2"},Ut=["disabled"],Ot={__name:"Listings",setup(Dt){const T=ue(),U=u(!0),w=u([]),D=u(""),y=u(1),L=u(1),N=u(20),P=u(0),a=u([]),k=u(null),l=K({title:"",description:"",price:0,price_type:"fixed",category_id:null,condition:"",city:"",state:""}),C=u(null),j=u(""),S=u(""),$=K({status:"",category:""}),B=u([]),z=u([]),I=pe(()=>w.value.length>0&&w.value.every(o=>a.value.includes(o.id))),J=o=>be(o).format("MMM D, YYYY"),Q=o=>({active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",rejected:"bg-red-100 text-red-800 border-red-200",sold:"bg-blue-100 text-blue-800 border-blue-200",expired:"bg-gray-100 text-gray-800 border-gray-200"})[o]||"bg-gray-100 text-gray-800",x=async()=>{U.value=!0;try{const o=await b.get("/admin/listings",{params:{page:y.value,search:D.value,status:$.status,category_id:$.category}});w.value=o.data.data,y.value=o.data.meta.current_page,L.value=o.data.meta.last_page,N.value=o.data.meta.per_page,P.value=o.data.meta.total}finally{U.value=!1}},Y=fe(()=>{y.value=1,x()},300),O=o=>{o>=1&&o<=L.value&&(y.value=o,x())},X=o=>{const e=a.value.indexOf(o);e>-1?a.value.splice(e,1):a.value.push(o)},Z=()=>{I.value?a.value=[]:a.value=w.value.map(o=>o.id)},ee=o=>{k.value=o,l.title=o.title,l.description=o.description,l.price=o.price,l.price_type=o.price_type,l.category_id=o.category_id,l.condition=o.condition||"",l.city=o.city,l.state=o.state||""},te=async()=>{try{await b.put(`/admin/listings/${k.value.id}`,l),n.success("Listing updated"),k.value=null,x()}catch{n.error("Failed to update listing")}},se=async o=>{try{await b.put(`/admin/listings/${o.id}`,{status:o.status}),n.success("Status updated")}catch{n.error("Failed to update status"),x()}},M=async(o,e)=>{try{const m=!o[e];await b.post(`/admin/listings/${o.id}/toggle-feature`,{[e]:m}),o[e]=m,n.success(`${e.replace("is_","").replace("_"," ")} ${m?"enabled":"disabled"}`)}catch{n.error("Failed to update badge")}},oe=async o=>{try{await b.post(`/admin/listings/${o.id}/approve`),n.success("Listing approved"),x()}catch{n.error("Failed to approve listing")}},le=o=>{C.value=o,j.value="",S.value=""},ae=async()=>{try{await b.post(`/admin/listings/${C.value.id}/reject`,{reason:j.value+(S.value?": "+S.value:"")}),n.success("Listing rejected"),C.value=null,x()}catch{n.error("Failed to reject listing")}},ne=async o=>{if(confirm(`Delete "${o.title}"? This cannot be undone.`))try{await b.delete(`/admin/listings/${o.id}`),n.success("Listing deleted"),x()}catch{n.error("Failed to delete listing")}},ie=async()=>{if(confirm(`Approve ${a.value.length} listings?`))try{const o=await b.post("/admin/listings/bulk-approve",{ids:a.value});n.success(o.data.message),a.value=[],x()}catch{n.error("Failed to bulk approve")}},re=async()=>{if(confirm(`Delete ${a.value.length} listings? This cannot be undone.`))try{const o=await b.post("/admin/listings/bulk-delete",{ids:a.value});n.success(o.data.message),a.value=[],x()}catch{n.error("Failed to bulk delete")}},de=async()=>{try{const o=await b.get("/categories"),e=[];o.data.data.forEach(m=>{e.push(m),m.children&&m.children.forEach(s=>{e.push({...s,name:`  â”” ${s.name}`})})}),z.value=e}catch{console.error("Failed to fetch categories")}};return ce(async()=>{await T.fetchCategories(),B.value=T.categories,await de(),x()}),(o,e)=>{const m=ve("router-link");return r(),i("div",je,[t("div",Se,[e[23]||(e[23]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Manage Listings",-1)),a.value.length?(r(),i("div",Ve,[t("span",Le,p(a.value.length)+" selected",1),t("button",{onClick:ie,class:"btn-primary btn-sm"},[c(d(W),{class:"w-4 h-4 mr-1"}),e[21]||(e[21]=V(" Approve All ",-1))]),t("button",{onClick:re,class:"btn-danger btn-sm"},[c(d(q),{class:"w-4 h-4 mr-1"}),e[22]||(e[22]=V(" Delete All ",-1))]),t("button",{onClick:e[0]||(e[0]=s=>a.value=[]),class:"btn-secondary btn-sm"}," Clear ")])):f("",!0)]),t("div",Ae,[t("div",Fe,[t("div",Ue,[t("div",De,[c(d(ge),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>D.value=s),type:"text",placeholder:"Search listings...",class:"input pl-10",onInput:e[2]||(e[2]=(...s)=>d(Y)&&d(Y)(...s))},null,544),[[h,D.value]])])]),v(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>$.status=s),onChange:x,class:"input w-auto"},[...e[24]||(e[24]=[A('<option value="">All Status</option><option value="pending">Pending</option><option value="active">Active</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',6)])],544),[[_,$.status]]),v(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>$.category=s),onChange:x,class:"input w-auto"},[e[25]||(e[25]=t("option",{value:""},"All Categories",-1)),(r(!0),i(E,null,R(B.value,s=>(r(),i("option",{key:s.id,value:s.id},p(s.name),9,Ne))),128))],544),[[_,$.category]])])]),t("div",Pe,[t("table",Me,[t("thead",Ee,[t("tr",null,[t("th",Re,[t("input",{type:"checkbox",checked:I.value,onChange:Z,class:"rounded border-gray-300"},null,40,Te)]),e[26]||(e[26]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Listing",-1)),e[27]||(e[27]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Seller",-1)),e[28]||(e[28]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Category",-1)),e[29]||(e[29]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Price",-1)),e[30]||(e[30]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Status",-1)),e[31]||(e[31]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Badges",-1)),e[32]||(e[32]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Stats",-1)),e[33]||(e[33]=t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions",-1))])]),t("tbody",Be,[U.value?(r(),i("tr",ze,[...e[34]||(e[34]=[t("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," Loading... ",-1)])])):w.value.length?f("",!0):(r(),i("tr",Ie,[...e[35]||(e[35]=[t("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," No listings found ",-1)])])),(r(!0),i(E,null,R(w.value,s=>{var G,H;return r(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",Ye,[t("input",{type:"checkbox",checked:a.value.includes(s.id),onChange:g=>X(s.id),class:"rounded border-gray-300"},null,40,Oe)]),t("td",Ge,[t("div",He,[t("img",{src:s.primary_image_url,alt:s.title,class:"w-12 h-12 rounded object-cover"},null,8,Ke),t("div",null,[t("p",We,p(s.title),1),t("p",qe,"ID: "+p(s.id)+" | "+p(J(s.created_at)),1)])])]),t("td",Je,[c(m,{to:`/admin/users?search=${(G=s.user)==null?void 0:G.email}`,class:"text-primary-600 hover:underline"},{default:xe(()=>{var g;return[V(p((g=s.user)==null?void 0:g.name),1)]}),_:2},1032,["to"])]),t("td",Qe,p((H=s.category)==null?void 0:H.name),1),t("td",Xe,p(s.formatted_price),1),t("td",Ze,[v(t("select",{"onUpdate:modelValue":g=>s.status=g,onChange:g=>se(s),class:F(["text-xs border rounded px-2 py-1",Q(s.status)])},[...e[36]||(e[36]=[A('<option value="active">Active</option><option value="pending">Pending</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',5)])],42,et),[[_,s.status]])]),t("td",tt,[t("div",st,[t("button",{onClick:g=>M(s,"is_featured"),class:F([s.is_featured?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Featured"},[c(d(we),{class:"w-3 h-3"})],10,ot),t("button",{onClick:g=>M(s,"is_urgent"),class:F([s.is_urgent?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Urgent"},[c(d(ke),{class:"w-3 h-3"})],10,lt),t("button",{onClick:g=>M(s,"is_highlighted"),class:F([s.is_highlighted?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Highlighted"},[c(d(Ce),{class:"w-3 h-3"})],10,at)])]),t("td",nt,[t("div",it,[t("span",null,[c(d($e),{class:"w-3 h-3 inline"}),V(" "+p(s.views_count||0),1)]),t("span",null,[c(d(ye),{class:"w-3 h-3 inline"}),V(" "+p(s.favorites_count||0),1)])])]),t("td",rt,[t("div",dt,[t("button",{onClick:g=>ee(s),class:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit"},[c(d(_e),{class:"w-5 h-5"})],8,ut),t("a",{href:`/listing/${s.slug}`,target:"_blank",class:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"View"},[c(d(he),{class:"w-5 h-5"})],8,pt),s.status==="pending"?(r(),i("button",{key:0,onClick:g=>oe(s),class:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Approve"},[c(d(W),{class:"w-5 h-5"})],8,ct)):f("",!0),s.status==="pending"?(r(),i("button",{key:1,onClick:g=>le(s),class:"p-1 text-orange-600 hover:bg-orange-50 rounded",title:"Reject"},[c(d(me),{class:"w-5 h-5"})],8,vt)):f("",!0),t("button",{onClick:g=>ne(s),class:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete"},[c(d(q),{class:"w-5 h-5"})],8,gt)])])])}),128))])]),L.value>1?(r(),i("div",xt,[t("p",yt," Showing "+p((y.value-1)*N.value+1)+" to "+p(Math.min(y.value*N.value,P.value))+" of "+p(P.value)+" listings ",1),t("div",mt,[t("button",{onClick:e[5]||(e[5]=s=>O(y.value-1)),disabled:y.value===1,class:"btn-secondary btn-sm"}," Previous ",8,bt),t("button",{onClick:e[6]||(e[6]=s=>O(y.value+1)),disabled:y.value===L.value,class:"btn-secondary btn-sm"}," Next ",8,ft)])])):f("",!0)]),k.value?(r(),i("div",ht,[t("div",{class:"absolute inset-0 bg-black/50",onClick:e[7]||(e[7]=s=>k.value=null)}),t("div",_t,[e[47]||(e[47]=t("h3",{class:"text-lg font-semibold mb-4"},"Edit Listing",-1)),t("div",wt,[t("div",null,[e[37]||(e[37]=t("label",{class:"label"},"Title",-1)),v(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.title=s),class:"input"},null,512),[[h,l.title]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"label"},"Description",-1)),v(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.description=s),rows:"4",class:"input"},null,512),[[h,l.description]])]),t("div",kt,[t("div",null,[e[39]||(e[39]=t("label",{class:"label"},"Price",-1)),v(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.price=s),type:"number",class:"input"},null,512),[[h,l.price]])]),t("div",null,[e[41]||(e[41]=t("label",{class:"label"},"Price Type",-1)),v(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.price_type=s),class:"input"},[...e[40]||(e[40]=[t("option",{value:"fixed"},"Fixed",-1),t("option",{value:"negotiable"},"Negotiable",-1),t("option",{value:"free"},"Free",-1),t("option",{value:"contact"},"Contact for Price",-1)])],512),[[_,l.price_type]])])]),t("div",Ct,[t("div",null,[e[42]||(e[42]=t("label",{class:"label"},"Category",-1)),v(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>l.category_id=s),class:"input"},[(r(!0),i(E,null,R(z.value,s=>(r(),i("option",{key:s.id,value:s.id},p(s.name),9,$t))),128))],512),[[_,l.category_id]])]),t("div",null,[e[44]||(e[44]=t("label",{class:"label"},"Condition",-1)),v(t("select",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.condition=s),class:"input"},[...e[43]||(e[43]=[A('<option value="">Not specified</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[_,l.condition]])])]),t("div",jt,[t("div",null,[e[45]||(e[45]=t("label",{class:"label"},"City",-1)),v(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>l.city=s),class:"input"},null,512),[[h,l.city]])]),t("div",null,[e[46]||(e[46]=t("label",{class:"label"},"State",-1)),v(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>l.state=s),class:"input"},null,512),[[h,l.state]])])]),t("div",St,[t("button",{onClick:e[16]||(e[16]=s=>k.value=null),class:"btn-secondary flex-1"}," Cancel "),t("button",{onClick:te,class:"btn-primary flex-1"}," Save Changes ")])])])])):f("",!0),C.value?(r(),i("div",Vt,[t("div",{class:"absolute inset-0 bg-black/50",onClick:e[17]||(e[17]=s=>C.value=null)}),t("div",Lt,[e[51]||(e[51]=t("h3",{class:"text-lg font-semibold mb-4"},"Reject Listing",-1)),t("div",At,[t("div",null,[e[49]||(e[49]=t("label",{class:"label"},"Reason for rejection",-1)),v(t("select",{"onUpdate:modelValue":e[18]||(e[18]=s=>j.value=s),class:"input"},[...e[48]||(e[48]=[A('<option value="">Select a reason</option><option value="prohibited_item">Prohibited item</option><option value="misleading_info">Misleading information</option><option value="duplicate">Duplicate listing</option><option value="inappropriate_content">Inappropriate content</option><option value="wrong_category">Wrong category</option><option value="other">Other</option>',7)])],512),[[_,j.value]])]),t("div",null,[e[50]||(e[50]=t("label",{class:"label"},"Additional notes (optional)",-1)),v(t("textarea",{"onUpdate:modelValue":e[19]||(e[19]=s=>S.value=s),rows:"3",class:"input",placeholder:"Explain the issue..."},null,512),[[h,S.value]])]),t("div",Ft,[t("button",{onClick:e[20]||(e[20]=s=>C.value=null),class:"btn-secondary flex-1"}," Cancel "),t("button",{onClick:ae,disabled:!j.value,class:"btn-danger flex-1"}," Reject ",8,Ut)])])])])):f("",!0)])}}};export{Ot as default};
