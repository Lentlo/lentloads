import{r as f,K as P,d as A,D as N,O as z,L as B,c,o as p,a,f as C,t as I,i as D,y as x,A as v}from"./main-s6bW8Jl1.js";import{L as g}from"./leaflet-Bln94WRs.js";const T={class:"location-picker"},E={class:"relative"},O={key:0,class:"absolute inset-0 bg-white/70 flex items-center justify-center rounded-lg"},G={class:"flex items-center gap-2 text-gray-600"},H=["disabled"],K={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},R={key:1,class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},q={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg space-y-3"},$={class:"grid grid-cols-2 gap-3"},Y={class:"grid grid-cols-2 gap-3"},J={__name:"LocationPicker",props:{initialLatitude:{type:Number,default:null},initialLongitude:{type:Number,default:null},initialCity:{type:String,default:""},initialState:{type:String,default:""},initialLocality:{type:String,default:""},initialPostalCode:{type:String,default:""}},emits:["update:location"],setup(M,{emit:S}){delete g.Icon.Default.prototype._getIconUrl,g.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const l=M,U=S,b=f(null),k=f(!1),h=f("Loading map..."),d=f(!1);let s=null,m=null;const e=P({latitude:l.initialLatitude,longitude:l.initialLongitude,locality:l.initialLocality,city:l.initialCity,state:l.initialState,postal_code:l.initialPostalCode,address:""}),V=A(()=>e.latitude&&e.longitude);N(()=>{j()}),z(()=>{s&&(s.remove(),s=null)});const j=()=>{if(!b.value)return;const o=l.initialLatitude||20.5937,t=l.initialLongitude||78.9629,i=l.initialLatitude?15:5;s=g.map(b.value).setView([o,t],i),g.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(s),l.initialLatitude&&l.initialLongitude&&y(l.initialLatitude,l.initialLongitude),s.on("click",r=>{const{lat:n,lng:w}=r.latlng;y(n,w),L(n,w)})},y=(o,t)=>{m&&s.removeLayer(m),m=g.marker([o,t],{draggable:!0}).addTo(s),m.on("dragend",i=>{const r=i.target.getLatLng();L(r.lat,r.lng)}),e.latitude=o,e.longitude=t},L=async(o,t)=>{k.value=!0,h.value="Getting address...";try{const i=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${o}&lon=${t}&format=json&addressdetails=1`,{headers:{"Accept-Language":"en"}});if(!i.ok)throw new Error("Geocoding failed");const r=await i.json(),n=r.address||{};e.latitude=o,e.longitude=t,e.locality=n.suburb||n.neighbourhood||n.village||n.town||"",e.city=n.city||n.town||n.village||n.county||"",e.state=n.state||"",e.postal_code=n.postcode||"",e.address=r.display_name||"",u()}catch(i){console.error("Reverse geocoding error:",i),e.latitude=o,e.longitude=t,u()}finally{k.value=!1}},_=()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}d.value=!0,navigator.geolocation.getCurrentPosition(o=>{const{latitude:t,longitude:i}=o.coords;s.setView([t,i],16),y(t,i),L(t,i),d.value=!1},o=>{d.value=!1;let t="Unable to get your location";switch(o.code){case o.PERMISSION_DENIED:t="Location permission denied. Please enable location access in your browser settings.";break;case o.POSITION_UNAVAILABLE:t="Location information unavailable. Please try again.";break;case o.TIMEOUT:t="Location request timed out. Please try again.";break}alert(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},u=()=>{U("update:location",{latitude:e.latitude,longitude:e.longitude,locality:e.locality,city:e.city,state:e.state,postal_code:e.postal_code,address:e.address})};return B(()=>[l.initialLatitude,l.initialLongitude],([o,t])=>{o&&t&&s&&(s.setView([o,t],15),y(o,t))}),(o,t)=>(p(),c("div",T,[a("div",E,[a("div",{ref_key:"mapContainer",ref:b,class:"h-64 rounded-lg border border-gray-300 z-0"},null,512),k.value?(p(),c("div",O,[a("div",G,[t[4]||(t[4]=a("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),a("span",null,I(h.value),1)])])):C("",!0)]),a("button",{type:"button",onClick:_,disabled:d.value,class:"mt-3 w-full flex items-center justify-center gap-2 px-4 py-2 bg-primary-50 hover:bg-primary-100 text-primary-700 rounded-lg transition"},[d.value?(p(),c("svg",R,[...t[6]||(t[6]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(p(),c("svg",K,[...t[5]||(t[5]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])])),D(" "+I(d.value?"Getting location...":"Use My Current Location"),1)],8,H),t[12]||(t[12]=a("p",{class:"text-xs text-gray-500 mt-2 text-center"}," Click on the map to pin your location, or use GPS ",-1)),V.value?(p(),c("div",q,[a("div",$,[a("div",null,[t[7]||(t[7]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Locality / Area",-1)),x(a("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>e.locality=i),type:"text",class:"input text-sm",placeholder:"e.g., Koramangala",onInput:u},null,544),[[v,e.locality]])]),a("div",null,[t[8]||(t[8]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"City *",-1)),x(a("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>e.city=i),type:"text",required:"",class:"input text-sm",placeholder:"e.g., Bangalore",onInput:u},null,544),[[v,e.city]])])]),a("div",Y,[a("div",null,[t[9]||(t[9]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"State",-1)),x(a("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>e.state=i),type:"text",class:"input text-sm",placeholder:"e.g., Karnataka",onInput:u},null,544),[[v,e.state]])]),a("div",null,[t[10]||(t[10]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"PIN Code",-1)),x(a("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>e.postal_code=i),type:"text",class:"input text-sm",placeholder:"e.g., 560034",maxlength:"6",onInput:u},null,544),[[v,e.postal_code]])])]),t[11]||(t[11]=a("p",{class:"text-xs text-gray-400"}," You can edit the auto-filled details if needed ",-1))])):C("",!0)]))}};export{J as _};
