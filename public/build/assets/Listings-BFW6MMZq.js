import{x as ut,r as p,L as W,d as pt,Z as ct,E as vt,e as gt,c as i,o as r,a as e,f,t as c,g as d,i as j,j as u,z as x,A as yt,B as S,N as _,G as V,F as E,h as R,C as b,O as n,w as xt,p as F,S as mt,l as bt}from"./main-CClDmdhq.js";import{d as ft}from"./dayjs.min-BXF3l5MP.js";import{_ as _t}from"./LocationPicker-BfP6uVlY.js";import{r as Z}from"./CheckIcon-DrSiP2PE.js";import{r as q}from"./TrashIcon-CfCT8yis.js";import{r as wt}from"./StarIcon-DephjnuV.js";import{r as ht}from"./BoltIcon-vf1j8cIl.js";import{r as kt}from"./SparklesIcon-DwB5_doa.js";import{r as Ct}from"./EyeIcon-DAIwKsgP.js";import{r as $t}from"./PencilIcon-SDuNSh43.js";import{r as Lt}from"./ArrowTopRightOnSquareIcon-BbRxRal7.js";import"./leaflet-9x6Gr4HL.js";const jt={class:"p-6"},St={class:"flex items-center justify-between mb-6"},Ut={key:0,class:"flex items-center gap-2"},Vt={class:"text-sm text-gray-600"},Ft={class:"card p-4 mb-6"},At={class:"flex flex-wrap gap-4"},Nt={class:"flex-1 min-w-[200px]"},Pt={class:"relative"},Dt=["value"],Mt={class:"card overflow-hidden"},Et={class:"w-full"},Rt={class:"bg-gray-50"},Tt={class:"px-4 py-3 text-left"},Bt=["checked"],zt={class:"divide-y"},It={key:0},Yt={key:1},Ot={class:"px-4 py-3"},Gt=["checked","onChange"],Ht={class:"px-4 py-3"},Wt={class:"flex items-center gap-3"},Zt=["src","alt"],qt={class:"font-medium text-gray-900 truncate max-w-[200px]"},Jt={class:"text-xs text-gray-500"},Kt={class:"px-4 py-3"},Qt={class:"px-4 py-3 text-gray-600"},Xt={class:"px-4 py-3 font-medium text-gray-900"},te={class:"px-4 py-3"},ee=["onUpdate:modelValue","onChange"],oe={class:"px-4 py-3"},se={class:"flex gap-1"},le=["onClick"],ae=["onClick"],ne=["onClick"],ie={class:"px-4 py-3 text-xs text-gray-500"},re={class:"flex flex-col gap-1"},de={class:"px-4 py-3"},ue={class:"flex items-center gap-1"},pe=["onClick"],ce=["href"],ve=["onClick"],ge=["onClick"],ye=["onClick"],xe={key:0,class:"p-4 border-t flex items-center justify-between"},me={class:"text-sm text-gray-500"},be={class:"flex gap-2"},fe=["disabled"],_e=["disabled"],we={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},he={class:"relative bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"},ke={class:"space-y-4"},Ce={class:"grid grid-cols-2 gap-4"},$e={class:"grid grid-cols-2 gap-4"},Le=["value"],je={class:"flex gap-2 pt-4"},Se={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ue={class:"relative bg-white rounded-xl p-6 w-full max-w-md"},Ve={class:"space-y-4"},Fe={class:"flex gap-2"},Ae=["disabled"],He={__name:"Listings",setup(Ne){const T=ut(),A=p(!0),w=p([]),N=p(""),m=p(1),U=p(1),P=p(20),D=p(0),a=p([]),h=p(null),l=W({title:"",description:"",price:0,price_type:"fixed",category_id:null,condition:"",city:"",state:"",locality:"",postal_code:"",latitude:null,longitude:null}),k=p(null),$=p(""),L=p(""),C=W({status:"",category:""}),B=p([]),z=p([]),I=pt(()=>w.value.length>0&&w.value.every(s=>a.value.includes(s.id))),J=s=>ft(s).format("MMM D, YYYY"),K=s=>({active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",rejected:"bg-red-100 text-red-800 border-red-200",sold:"bg-blue-100 text-blue-800 border-blue-200",expired:"bg-gray-100 text-gray-800 border-gray-200"})[s]||"bg-gray-100 text-gray-800",y=async()=>{A.value=!0;try{const s=await b.get("/admin/listings",{params:{page:m.value,search:N.value,status:C.status,category_id:C.category}});w.value=s.data.data,m.value=s.data.meta.current_page,U.value=s.data.meta.last_page,P.value=s.data.meta.per_page,D.value=s.data.meta.total}finally{A.value=!1}},Y=ct(()=>{m.value=1,y()},300),O=s=>{s>=1&&s<=U.value&&(m.value=s,y())},Q=s=>{const t=a.value.indexOf(s);t>-1?a.value.splice(t,1):a.value.push(s)},X=()=>{I.value?a.value=[]:a.value=w.value.map(s=>s.id)},tt=s=>{h.value=s,l.title=s.title,l.description=s.description,l.price=s.price,l.price_type=s.price_type,l.category_id=s.category_id,l.condition=s.condition||"",l.city=s.city||"",l.state=s.state||"",l.locality=s.locality||"",l.postal_code=s.postal_code||"",l.latitude=s.latitude?parseFloat(s.latitude):null,l.longitude=s.longitude?parseFloat(s.longitude):null},et=async()=>{var s,t,v;try{const o={title:l.title,description:l.description,price:l.price,price_type:l.price_type,category_id:l.category_id,condition:l.condition||null,city:l.city||null,state:l.state||null,locality:l.locality||null,postal_code:l.postal_code||null,latitude:l.latitude,longitude:l.longitude};await b.put(`/admin/listings/${h.value.id}`,o),n.success("Listing updated"),h.value=null,y()}catch(o){console.error("Save listing error:",((s=o.response)==null?void 0:s.data)||o),n.error(((v=(t=o.response)==null?void 0:t.data)==null?void 0:v.message)||"Failed to update listing")}},ot=async s=>{try{await b.put(`/admin/listings/${s.id}`,{status:s.status}),n.success("Status updated")}catch{n.error("Failed to update status"),y()}},M=async(s,t)=>{try{const v=!s[t];await b.post(`/admin/listings/${s.id}/toggle-feature`,{[t]:v}),s[t]=v,n.success(`${t.replace("is_","").replace("_"," ")} ${v?"enabled":"disabled"}`)}catch{n.error("Failed to update badge")}},st=async s=>{try{await b.post(`/admin/listings/${s.id}/approve`),n.success("Listing approved"),y()}catch{n.error("Failed to approve listing")}},lt=s=>{k.value=s,$.value="",L.value=""},at=async()=>{try{await b.post(`/admin/listings/${k.value.id}/reject`,{reason:$.value+(L.value?": "+L.value:"")}),n.success("Listing rejected"),k.value=null,y()}catch{n.error("Failed to reject listing")}},nt=async s=>{if(confirm(`Delete "${s.title}"? This cannot be undone.`))try{await b.delete(`/admin/listings/${s.id}`),n.success("Listing deleted"),y()}catch{n.error("Failed to delete listing")}},it=async()=>{if(confirm(`Approve ${a.value.length} listings?`))try{const s=await b.post("/admin/listings/bulk-approve",{ids:a.value});n.success(s.data.message),a.value=[],y()}catch{n.error("Failed to bulk approve")}},rt=async()=>{if(confirm(`Delete ${a.value.length} listings? This cannot be undone.`))try{const s=await b.post("/admin/listings/bulk-delete",{ids:a.value});n.success(s.data.message),a.value=[],y()}catch{n.error("Failed to bulk delete")}},dt=async()=>{try{const s=await b.get("/categories"),t=[];s.data.data.forEach(v=>{t.push(v),v.children&&v.children.forEach(o=>{t.push({...o,name:`  â”” ${o.name}`})})}),z.value=t}catch{console.error("Failed to fetch categories")}};return vt(async()=>{await T.fetchCategories(),B.value=T.categories,await dt(),y()}),(s,t)=>{const v=gt("router-link");return r(),i("div",jt,[e("div",St,[t[27]||(t[27]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Manage Listings",-1)),a.value.length?(r(),i("div",Ut,[e("span",Vt,c(a.value.length)+" selected",1),e("button",{onClick:it,class:"btn-primary btn-sm"},[d(u(Z),{class:"w-4 h-4 mr-1"}),t[25]||(t[25]=j(" Approve All ",-1))]),e("button",{onClick:rt,class:"btn-danger btn-sm"},[d(u(q),{class:"w-4 h-4 mr-1"}),t[26]||(t[26]=j(" Delete All ",-1))]),e("button",{onClick:t[0]||(t[0]=o=>a.value=[]),class:"btn-secondary btn-sm"}," Clear ")])):f("",!0)]),e("div",Ft,[e("div",At,[e("div",Nt,[e("div",Pt,[d(u(yt),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),x(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>N.value=o),type:"text",placeholder:"Search listings...",class:"input pl-10",onInput:t[2]||(t[2]=(...o)=>u(Y)&&u(Y)(...o))},null,544),[[S,N.value]])])]),x(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>C.status=o),onChange:y,class:"input w-auto"},[...t[28]||(t[28]=[V('<option value="">All Status</option><option value="pending">Pending</option><option value="active">Active</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',6)])],544),[[_,C.status]]),x(e("select",{"onUpdate:modelValue":t[4]||(t[4]=o=>C.category=o),onChange:y,class:"input w-auto"},[t[29]||(t[29]=e("option",{value:""},"All Categories",-1)),(r(!0),i(E,null,R(B.value,o=>(r(),i("option",{key:o.id,value:o.id},c(o.name),9,Dt))),128))],544),[[_,C.category]])])]),e("div",Mt,[e("table",Et,[e("thead",Rt,[e("tr",null,[e("th",Tt,[e("input",{type:"checkbox",checked:I.value,onChange:X,class:"rounded border-gray-300"},null,40,Bt)]),t[30]||(t[30]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Listing",-1)),t[31]||(t[31]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Seller",-1)),t[32]||(t[32]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Category",-1)),t[33]||(t[33]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Price",-1)),t[34]||(t[34]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Status",-1)),t[35]||(t[35]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Badges",-1)),t[36]||(t[36]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Stats",-1)),t[37]||(t[37]=e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions",-1))])]),e("tbody",zt,[A.value?(r(),i("tr",It,[...t[38]||(t[38]=[e("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," Loading... ",-1)])])):w.value.length?f("",!0):(r(),i("tr",Yt,[...t[39]||(t[39]=[e("td",{colspan:"9",class:"px-4 py-8 text-center text-gray-500"}," No listings found ",-1)])])),(r(!0),i(E,null,R(w.value,o=>{var G,H;return r(),i("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",Ot,[e("input",{type:"checkbox",checked:a.value.includes(o.id),onChange:g=>Q(o.id),class:"rounded border-gray-300"},null,40,Gt)]),e("td",Ht,[e("div",Wt,[e("img",{src:o.primary_image_url,alt:o.title,class:"w-12 h-12 rounded object-cover"},null,8,Zt),e("div",null,[e("p",qt,c(o.title),1),e("p",Jt,"ID: "+c(o.id)+" | "+c(J(o.created_at)),1)])])]),e("td",Kt,[d(v,{to:`/admin/users?search=${(G=o.user)==null?void 0:G.email}`,class:"text-primary-600 hover:underline"},{default:xt(()=>{var g;return[j(c((g=o.user)==null?void 0:g.name),1)]}),_:2},1032,["to"])]),e("td",Qt,c((H=o.category)==null?void 0:H.name),1),e("td",Xt,c(o.formatted_price),1),e("td",te,[x(e("select",{"onUpdate:modelValue":g=>o.status=g,onChange:g=>ot(o),class:F(["text-xs border rounded px-2 py-1",K(o.status)])},[...t[40]||(t[40]=[V('<option value="active">Active</option><option value="pending">Pending</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',5)])],42,ee),[[_,o.status]])]),e("td",oe,[e("div",se,[e("button",{onClick:g=>M(o,"is_featured"),class:F([o.is_featured?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Featured"},[d(u(wt),{class:"w-3 h-3"})],10,le),e("button",{onClick:g=>M(o,"is_urgent"),class:F([o.is_urgent?"bg-red-100 text-red-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Urgent"},[d(u(ht),{class:"w-3 h-3"})],10,ae),e("button",{onClick:g=>M(o,"is_highlighted"),class:F([o.is_highlighted?"bg-purple-100 text-purple-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium"]),title:"Highlighted"},[d(u(kt),{class:"w-3 h-3"})],10,ne)])]),e("td",ie,[e("div",re,[e("span",null,[d(u(Ct),{class:"w-3 h-3 inline"}),j(" "+c(o.views_count||0),1)]),e("span",null,[d(u(mt),{class:"w-3 h-3 inline"}),j(" "+c(o.favorites_count||0),1)])])]),e("td",de,[e("div",ue,[e("button",{onClick:g=>tt(o),class:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit"},[d(u($t),{class:"w-5 h-5"})],8,pe),e("a",{href:`/listing/${o.slug}`,target:"_blank",class:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"View"},[d(u(Lt),{class:"w-5 h-5"})],8,ce),o.status==="pending"?(r(),i("button",{key:0,onClick:g=>st(o),class:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Approve"},[d(u(Z),{class:"w-5 h-5"})],8,ve)):f("",!0),o.status==="pending"?(r(),i("button",{key:1,onClick:g=>lt(o),class:"p-1 text-orange-600 hover:bg-orange-50 rounded",title:"Reject"},[d(u(bt),{class:"w-5 h-5"})],8,ge)):f("",!0),e("button",{onClick:g=>nt(o),class:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete"},[d(u(q),{class:"w-5 h-5"})],8,ye)])])])}),128))])]),U.value>1?(r(),i("div",xe,[e("p",me," Showing "+c((m.value-1)*P.value+1)+" to "+c(Math.min(m.value*P.value,D.value))+" of "+c(D.value)+" listings ",1),e("div",be,[e("button",{onClick:t[5]||(t[5]=o=>O(m.value-1)),disabled:m.value===1,class:"btn-secondary btn-sm"}," Previous ",8,fe),e("button",{onClick:t[6]||(t[6]=o=>O(m.value+1)),disabled:m.value===U.value,class:"btn-secondary btn-sm"}," Next ",8,_e)])])):f("",!0)]),h.value?(r(),i("div",we,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[7]||(t[7]=o=>h.value=null)}),e("div",he,[t[50]||(t[50]=e("h3",{class:"text-lg font-semibold mb-4"},"Edit Listing",-1)),e("div",ke,[e("div",null,[t[41]||(t[41]=e("label",{class:"label"},"Title",-1)),x(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>l.title=o),class:"input"},null,512),[[S,l.title]])]),e("div",null,[t[42]||(t[42]=e("label",{class:"label"},"Description",-1)),x(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=o=>l.description=o),rows:"4",class:"input"},null,512),[[S,l.description]])]),e("div",Ce,[e("div",null,[t[43]||(t[43]=e("label",{class:"label"},"Price",-1)),x(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>l.price=o),type:"number",class:"input"},null,512),[[S,l.price]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"label"},"Price Type",-1)),x(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>l.price_type=o),class:"input"},[...t[44]||(t[44]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"negotiable"},"Negotiable",-1),e("option",{value:"free"},"Free",-1),e("option",{value:"contact"},"Contact for Price",-1)])],512),[[_,l.price_type]])])]),e("div",$e,[e("div",null,[t[46]||(t[46]=e("label",{class:"label"},"Category",-1)),x(e("select",{"onUpdate:modelValue":t[12]||(t[12]=o=>l.category_id=o),class:"input"},[(r(!0),i(E,null,R(z.value,o=>(r(),i("option",{key:o.id,value:o.id},c(o.name),9,Le))),128))],512),[[_,l.category_id]])]),e("div",null,[t[48]||(t[48]=e("label",{class:"label"},"Condition",-1)),x(e("select",{"onUpdate:modelValue":t[13]||(t[13]=o=>l.condition=o),class:"input"},[...t[47]||(t[47]=[V('<option value="">Not specified</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[_,l.condition]])])]),e("div",null,[t[49]||(t[49]=e("label",{class:"label"},"Location",-1)),d(_t,{latitude:l.latitude,"onUpdate:latitude":t[14]||(t[14]=o=>l.latitude=o),longitude:l.longitude,"onUpdate:longitude":t[15]||(t[15]=o=>l.longitude=o),locality:l.locality,"onUpdate:locality":t[16]||(t[16]=o=>l.locality=o),city:l.city,"onUpdate:city":t[17]||(t[17]=o=>l.city=o),state:l.state,"onUpdate:state":t[18]||(t[18]=o=>l.state=o),postalCode:l.postal_code,"onUpdate:postalCode":t[19]||(t[19]=o=>l.postal_code=o),initialLatitude:l.latitude,initialLongitude:l.longitude},null,8,["latitude","longitude","locality","city","state","postalCode","initialLatitude","initialLongitude"])]),e("div",je,[e("button",{onClick:t[20]||(t[20]=o=>h.value=null),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:et,class:"btn-primary flex-1"}," Save Changes ")])])])])):f("",!0),k.value?(r(),i("div",Se,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[21]||(t[21]=o=>k.value=null)}),e("div",Ue,[t[54]||(t[54]=e("h3",{class:"text-lg font-semibold mb-4"},"Reject Listing",-1)),e("div",Ve,[e("div",null,[t[52]||(t[52]=e("label",{class:"label"},"Reason for rejection",-1)),x(e("select",{"onUpdate:modelValue":t[22]||(t[22]=o=>$.value=o),class:"input"},[...t[51]||(t[51]=[V('<option value="">Select a reason</option><option value="prohibited_item">Prohibited item</option><option value="misleading_info">Misleading information</option><option value="duplicate">Duplicate listing</option><option value="inappropriate_content">Inappropriate content</option><option value="wrong_category">Wrong category</option><option value="other">Other</option>',7)])],512),[[_,$.value]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"label"},"Additional notes (optional)",-1)),x(e("textarea",{"onUpdate:modelValue":t[23]||(t[23]=o=>L.value=o),rows:"3",class:"input",placeholder:"Explain the issue..."},null,512),[[S,L.value]])]),e("div",Fe,[e("button",{onClick:t[24]||(t[24]=o=>k.value=null),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:at,disabled:!$.value,class:"btn-danger flex-1"}," Reject ",8,Ae)])])])])):f("",!0)])}}};export{He as default};
