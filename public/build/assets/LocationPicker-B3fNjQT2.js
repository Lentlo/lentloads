import{r as x,K as D,d as N,D as z,P as B,L as G,c as g,o as m,a,f as I,t as P,i as T,y as b,A as k}from"./main-CNm8sZUs.js";import{L as y}from"./leaflet-Bln94WRs.js";const E={class:"location-picker"},O={class:"relative"},H={key:0,class:"absolute inset-0 bg-white/70 flex items-center justify-center rounded-lg"},K={class:"flex items-center gap-2 text-gray-600"},R=["disabled"],Z={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},q={key:1,class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},$={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg space-y-3"},W={class:"grid grid-cols-2 gap-3"},Y={class:"grid grid-cols-2 gap-3"},Q={__name:"LocationPicker",props:{initialLatitude:{type:Number,default:null},initialLongitude:{type:Number,default:null},initialCity:{type:String,default:""},initialState:{type:String,default:""},initialLocality:{type:String,default:""},initialPostalCode:{type:String,default:""}},emits:["update:location"],setup(S,{emit:V}){delete y.Icon.Default.prototype._getIconUrl,y.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const l=S,j=V,L=x(null),r=x(!1),h=x("Loading map..."),u=x(!1);let n=null,f=null;const e=D({latitude:l.initialLatitude,longitude:l.initialLongitude,locality:l.initialLocality,city:l.initialCity,state:l.initialState,postal_code:l.initialPostalCode,address:""}),M=N(()=>e.latitude&&e.longitude||e.city||e.state||e.locality);z(()=>{U(),_()}),B(()=>{n&&(n.remove(),n=null)});const U=()=>{if(!L.value)return;const o=l.initialLatitude||20.5937,t=l.initialLongitude||78.9629,i=l.initialLatitude?15:5;n=y.map(L.value,{scrollWheelZoom:!1,touchZoom:!0,zoomControl:!0}).setView([o,t],i),y.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(n),l.initialLatitude&&l.initialLongitude&&p(l.initialLatitude,l.initialLongitude),n.on("click",d=>{const{lat:s,lng:C}=d.latlng;p(s,C),v(s,C)})},p=(o,t)=>{f&&n.removeLayer(f),f=y.marker([o,t],{draggable:!0}).addTo(n),f.on("dragend",i=>{const d=i.target.getLatLng();v(d.lat,d.lng)}),e.latitude=o,e.longitude=t},v=async(o,t)=>{r.value=!0,h.value="Getting address...";try{const i=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${o}&lon=${t}&format=json&addressdetails=1`,{headers:{"Accept-Language":"en"}});if(!i.ok)throw new Error("Geocoding failed");const d=await i.json(),s=d.address||{};e.latitude=o,e.longitude=t,e.locality=s.suburb||s.neighbourhood||s.village||s.town||"",e.city=s.city||s.town||s.village||s.county||"",e.state=s.state||"",e.postal_code=s.postcode||"",e.address=d.display_name||"",c()}catch(i){console.error("Reverse geocoding error:",i),e.latitude=o,e.longitude=t,c()}finally{r.value=!1}},A=()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}u.value=!0,navigator.geolocation.getCurrentPosition(o=>{const{latitude:t,longitude:i}=o.coords;n.setView([t,i],16),p(t,i),v(t,i),u.value=!1},o=>{u.value=!1;let t="Unable to get your location";switch(o.code){case o.PERMISSION_DENIED:t="Location permission denied. Please enable location access in your browser settings.";break;case o.POSITION_UNAVAILABLE:t="Location information unavailable. Please try again.";break;case o.TIMEOUT:t="Location request timed out. Please try again.";break}alert(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},c=()=>{j("update:location",{latitude:e.latitude,longitude:e.longitude,locality:e.locality,city:e.city,state:e.state,postal_code:e.postal_code,address:e.address})},_=async()=>{if(!(l.initialLatitude&&l.initialLongitude))try{r.value=!0,h.value="Detecting your city...";const t=await(await fetch("https://ipapi.co/json/")).json();t.latitude&&t.longitude?(n.setView([t.latitude,t.longitude],12),e.city=t.city||"",e.state=t.region||"",r.value=!1,w()):(r.value=!1,w())}catch(o){console.error("IP geolocation failed:",o),r.value=!1,w()}},w=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(o=>{const{latitude:t,longitude:i}=o.coords;n.setView([t,i],16),p(t,i),v(t,i)},o=>{console.log("GPS not available or denied:",o.message)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})};return G(()=>[l.initialLatitude,l.initialLongitude],([o,t])=>{o&&t&&n&&(n.setView([o,t],15),p(o,t))}),(o,t)=>(m(),g("div",E,[a("div",O,[a("div",{ref_key:"mapContainer",ref:L,class:"h-64 rounded-lg border border-gray-300 z-0"},null,512),r.value?(m(),g("div",H,[a("div",K,[t[4]||(t[4]=a("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),a("span",null,P(h.value),1)])])):I("",!0)]),a("button",{type:"button",onClick:A,disabled:u.value,class:"mt-3 w-full flex items-center justify-center gap-2 px-4 py-2 bg-primary-50 hover:bg-primary-100 text-primary-700 rounded-lg transition"},[u.value?(m(),g("svg",q,[...t[6]||(t[6]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(m(),g("svg",Z,[...t[5]||(t[5]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},null,-1),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])])),T(" "+P(u.value?"Getting location...":"Use My Current Location"),1)],8,R),t[12]||(t[12]=a("p",{class:"text-xs text-gray-500 mt-2 text-center"}," Click on the map to pin your location, or use GPS ",-1)),M.value?(m(),g("div",$,[a("div",W,[a("div",null,[t[7]||(t[7]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Locality / Area",-1)),b(a("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>e.locality=i),type:"text",class:"input text-sm",placeholder:"e.g., Koramangala",onInput:c},null,544),[[k,e.locality]])]),a("div",null,[t[8]||(t[8]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"City *",-1)),b(a("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>e.city=i),type:"text",required:"",class:"input text-sm",placeholder:"e.g., Bangalore",onInput:c},null,544),[[k,e.city]])])]),a("div",Y,[a("div",null,[t[9]||(t[9]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"State",-1)),b(a("input",{"onUpdate:modelValue":t[2]||(t[2]=i=>e.state=i),type:"text",class:"input text-sm",placeholder:"e.g., Karnataka",onInput:c},null,544),[[k,e.state]])]),a("div",null,[t[10]||(t[10]=a("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"PIN Code",-1)),b(a("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>e.postal_code=i),type:"text",class:"input text-sm",placeholder:"e.g., 560034",maxlength:"6",onInput:c},null,544),[[k,e.postal_code]])])]),t[11]||(t[11]=a("p",{class:"text-xs text-gray-400"}," You can edit the auto-filled details if needed ",-1))])):I("",!0)]))}};export{Q as _};
