import{c as l,o as r,a as e,_ as de,u as ue,C as ce,b as fe,r as f,d as X,D as pe,e as ve,f as n,g as i,j as d,t as u,w as S,i as D,I as me,F as q,h as ge,S as G,y as J,A as Q,H as xe,B as _,N as c,X as ye,p as M,m as F}from"./main-ic6Y-wVz.js";import{d as j}from"./dayjs.min-iy57P9mS.js";import{r as he}from"./ArrowLeftIcon-DnkVOZCK.js";import{r as be}from"./PhoneIcon-DEOSdlcg.js";import{r as V}from"./CheckIcon-USyB4TwD.js";import"./_commonjsHelpers-Cpj98o6Y.js";function W(B,p){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 8.25H9m6 3H9m3 6-3-3h1.5a3 3 0 1 0 0-6M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function _e(B,p){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function we(B,p){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}const ke={class:"h-screen flex flex-col bg-gray-100"},Ce={class:"bg-white border-b shadow-sm safe-area-top"},$e={class:"flex items-center gap-3 px-4 py-3"},Me={key:0,class:"flex items-center gap-3 flex-1 min-w-0"},je={class:"relative"},Be=["src","alt"],Oe={class:"min-w-0 flex-1"},Te={class:"font-semibold text-gray-900 truncate"},Se={class:"flex items-center gap-1"},De=["href"],Fe={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-xl shadow-lg border z-50"},Ve={key:0,class:"px-4 pb-3"},Ae=["src","alt"],Ue={class:"flex-1 min-w-0"},ze={class:"font-medium text-gray-900 truncate text-sm"},He={class:"text-primary-600 font-bold"},Ne={key:0,class:"flex justify-center py-8"},Ye={class:"flex justify-center mb-4"},Ze={class:"px-3 py-1 bg-gray-200 rounded-full text-xs text-gray-600"},Ie={key:0,class:"mb-2"},Le={class:"flex items-center gap-2 mb-1"},Ke={class:"text-2xl font-bold"},Re={key:0,class:"flex gap-2 mt-3"},Ee=["onClick"],Pe=["onClick"],Xe={class:"whitespace-pre-wrap"},qe={key:0,class:"flex items-center"},Ge={class:"bg-white border-t px-3 py-3 safe-area-bottom"},Je={class:"flex-1 relative"},Qe=["disabled","onKeydown"],We=["disabled"],et={key:0,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},tt={class:"relative bg-white w-full sm:max-w-sm sm:rounded-xl rounded-t-xl p-6 safe-area-bottom"},st={key:0,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg mb-4"},ot=["src"],rt={class:"font-medium text-sm truncate"},at={class:"text-primary-600 font-bold"},lt={class:"relative mb-4"},nt={class:"flex gap-3"},it=["disabled"],dt={__name:"Conversation",setup(B){const p=ue(),O=ce(),ee=fe(),A=f(!0),w=f(!1),a=f(null),h=f([]),v=f(""),m=f(!1),k=f(!1),g=f(""),C=f(null),x=X(()=>{var o;return(o=ee.user)==null?void 0:o.id}),b=X(()=>a.value?a.value.buyer_id===x.value?a.value.seller:a.value.buyer:null),te=o=>j(o).format("h:mm A"),se=o=>{if(!o)return"";const t=j(o);return t.isSame(j(),"day")?"Today":t.isSame(j().subtract(1,"day"),"day")?"Yesterday":t.format("MMM D, YYYY")},oe=o=>{const t=o.target;t.style.height="auto",t.style.height=Math.min(t.scrollHeight,128)+"px"},T=()=>{ye(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)})},re=async()=>{try{const o=await _.get(`/conversations/${p.params.uuid}`);a.value=o.data.data.conversation,h.value=o.data.data.messages.data||[],T()}catch{c.error("Failed to load conversation"),O.push("/messages")}finally{A.value=!1}},U=async()=>{if(!v.value.trim()||w.value)return;w.value=!0;const o=v.value;v.value="";try{const t=await _.post(`/conversations/${p.params.uuid}/messages`,{message:o,type:"text"});h.value.push(t.data.data),T()}catch{v.value=o,c.error("Failed to send message")}finally{w.value=!1}},ae=async()=>{if(g.value)try{const o=await _.post(`/conversations/${p.params.uuid}/messages`,{message:`I'd like to offer ₹${g.value}`,type:"offer",offer_amount:g.value});h.value.push(o.data.data),k.value=!1,g.value="",T(),c.success("Offer sent!")}catch{c.error("Failed to send offer")}},z=async(o,t)=>{try{await _.post(`/messages/${o}/offer-response`,{action:t});const y=h.value.find($=>$.id===o);y&&(y.offer_status=t==="accept"?"accepted":"rejected"),c.success(`Offer ${t}ed`)}catch{c.error("Failed to respond to offer")}},le=async()=>{m.value=!1;try{await _.post(`/conversations/${p.params.uuid}/block`),c.success("User blocked"),O.push("/messages")}catch{c.error("Failed to block user")}},ne=async()=>{m.value=!1;try{await _.delete(`/conversations/${p.params.uuid}`),c.success("Conversation deleted"),O.push("/messages")}catch{c.error("Failed to delete conversation")}};return pe(()=>{re()}),(o,t)=>{var $,H,N,Y,Z,I,L,K,R,E;const y=ve("router-link");return r(),l("div",ke,[e("header",Ce,[e("div",$e,[e("button",{onClick:t[0]||(t[0]=s=>o.$router.push("/messages")),class:"p-2 -ml-2 hover:bg-gray-100 rounded-full"},[i(d(he),{class:"w-5 h-5 text-gray-600"})]),a.value?(r(),l("div",Me,[e("div",je,[e("img",{src:($=b.value)==null?void 0:$.avatar_url,alt:(H=b.value)==null?void 0:H.name,class:"w-10 h-10 rounded-full object-cover"},null,8,Be),t[9]||(t[9]=e("span",{class:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"},null,-1))]),e("div",Oe,[e("h1",Te,u((N=b.value)==null?void 0:N.name),1),t[10]||(t[10]=e("p",{class:"text-xs text-green-600"},"Online",-1))])])):n("",!0),e("div",Se,[(Y=b.value)!=null&&Y.phone?(r(),l("a",{key:0,href:`tel:${b.value.phone}`,class:"p-2 hover:bg-gray-100 rounded-full"},[i(d(be),{class:"w-5 h-5 text-gray-600"})],8,De)):n("",!0),e("button",{onClick:t[3]||(t[3]=s=>m.value=!m.value),class:"p-2 hover:bg-gray-100 rounded-full relative"},[i(d(_e),{class:"w-5 h-5 text-gray-600"}),m.value?(r(),l("div",Fe,[i(y,{to:`/listing/${(I=(Z=a.value)==null?void 0:Z.listing)==null?void 0:I.slug}`,class:"block px-4 py-3 text-gray-700 hover:bg-gray-50",onClick:t[1]||(t[1]=s=>m.value=!1)},{default:S(()=>[...t[11]||(t[11]=[D(" View Listing ",-1)])]),_:1},8,["to"]),i(y,{to:`/user/${(L=b.value)==null?void 0:L.id}`,class:"block px-4 py-3 text-gray-700 hover:bg-gray-50",onClick:t[2]||(t[2]=s=>m.value=!1)},{default:S(()=>[...t[12]||(t[12]=[D(" View Profile ",-1)])]),_:1},8,["to"]),e("button",{onClick:le,class:"w-full px-4 py-3 text-left text-red-600 hover:bg-red-50"}," Block User "),e("button",{onClick:ne,class:"w-full px-4 py-3 text-left text-red-600 hover:bg-red-50 rounded-b-xl"}," Delete Chat ")])):n("",!0)])])]),(K=a.value)!=null&&K.listing?(r(),l("div",Ve,[i(y,{to:`/listing/${a.value.listing.slug}`,class:"flex items-center gap-3 p-2 bg-gray-50 rounded-xl hover:bg-gray-100 transition"},{default:S(()=>[e("img",{src:a.value.listing.primary_image_url,alt:a.value.listing.title,class:"w-14 h-14 rounded-lg object-cover"},null,8,Ae),e("div",Ue,[e("p",ze,u(a.value.listing.title),1),e("p",He,u(a.value.listing.formatted_price||"₹"+a.value.listing.price),1)]),i(d(me),{class:"w-5 h-5 text-gray-400"})]),_:1},8,["to"])])):n("",!0)]),e("div",{ref_key:"messagesContainer",ref:C,class:"flex-1 overflow-y-auto px-4 py-4 space-y-3"},[A.value?(r(),l("div",Ne,[...t[13]||(t[13]=[e("div",{class:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"},null,-1)])])):(r(),l(q,{key:1},[e("div",Ye,[e("span",Ze,u(se((R=h.value[0])==null?void 0:R.created_at)),1)]),(r(!0),l(q,null,ge(h.value,s=>{var P;return r(),l("div",{key:s.id,class:M(["flex",s.sender_id===x.value?"justify-end":"justify-start"])},[e("div",{class:M(["max-w-[80%] rounded-2xl px-4 py-2 shadow-sm",s.sender_id===x.value?"bg-primary-600 text-white rounded-br-sm":"bg-white text-gray-900 rounded-bl-sm"])},[s.type==="offer"?(r(),l("div",Ie,[e("div",Le,[i(d(W),{class:"w-4 h-4"}),t[14]||(t[14]=e("span",{class:"text-sm opacity-80"},"Offer",-1))]),e("p",Ke,"₹"+u((P=s.offer_amount)==null?void 0:P.toLocaleString()),1),s.offer_status==="pending"&&s.sender_id!==x.value?(r(),l("div",Re,[e("button",{onClick:ie=>z(s.id,"accept"),class:"flex-1 px-3 py-2 bg-green-500 text-white rounded-lg text-sm font-medium"}," Accept ",8,Ee),e("button",{onClick:ie=>z(s.id,"reject"),class:"flex-1 px-3 py-2 bg-white/20 text-white rounded-lg text-sm font-medium"}," Decline ",8,Pe)])):s.offer_status!=="pending"?(r(),l("p",{key:1,class:M(["text-sm mt-2 font-medium",s.sender_id===x.value?s.offer_status==="accepted"?"text-green-200":"text-red-200":s.offer_status==="accepted"?"text-green-600":"text-red-600"])},u(s.offer_status==="accepted"?"Accepted":"Declined"),3)):n("",!0)])):n("",!0),e("p",Xe,u(s.body),1),e("p",{class:M(["text-[10px] mt-1 flex items-center gap-1",s.sender_id===x.value?"text-primary-200 justify-end":"text-gray-400"])},[D(u(te(s.created_at))+" ",1),s.sender_id===x.value?(r(),l("span",qe,[s.is_read?(r(),F(d(V),{key:0,class:"w-3 h-3"})):n("",!0),s.is_read?(r(),F(d(V),{key:1,class:"w-3 h-3 -ml-1"})):(r(),F(d(V),{key:2,class:"w-3 h-3"}))])):n("",!0)],2)],2)],2)}),128))],64))],512),e("div",Ge,[e("form",{onSubmit:G(U,["prevent"]),class:"flex items-end gap-2"},[e("button",{type:"button",onClick:t[4]||(t[4]=s=>k.value=!0),class:"p-3 text-primary-600 hover:bg-primary-50 rounded-full flex-shrink-0",title:"Make an offer"},[i(d(W),{class:"w-6 h-6"})]),e("div",Je,[J(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>v.value=s),placeholder:"Type a message...",class:"w-full px-4 py-3 bg-gray-100 rounded-2xl resize-none focus:outline-none focus:ring-2 focus:ring-primary-500 max-h-32",rows:"1",disabled:w.value,onInput:oe,onKeydown:xe(G(U,["exact","prevent"]),["enter"])},null,40,Qe),[[Q,v.value]])]),e("button",{type:"submit",disabled:!v.value.trim()||w.value,class:"p-3 bg-primary-600 text-white rounded-full flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-primary-700 transition"},[i(d(we),{class:"w-5 h-5"})],8,We)],32)]),k.value?(r(),l("div",et,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[6]||(t[6]=s=>k.value=!1)}),e("div",tt,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold mb-4"},"Make an Offer",-1)),(E=a.value)!=null&&E.listing?(r(),l("div",st,[e("img",{src:a.value.listing.primary_image_url,class:"w-12 h-12 rounded-lg object-cover"},null,8,ot),e("div",null,[e("p",rt,u(a.value.listing.title),1),e("p",at,u(a.value.listing.formatted_price||"₹"+a.value.listing.price),1)])])):n("",!0),e("div",lt,[t[15]||(t[15]=e("span",{class:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg"},"₹",-1)),J(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>g.value=s),type:"number",min:"1",class:"w-full pl-10 pr-4 py-3 bg-gray-100 rounded-xl text-lg font-semibold focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter your offer"},null,512),[[Q,g.value]])]),e("div",nt,[e("button",{onClick:t[8]||(t[8]=s=>k.value=!1),class:"flex-1 py-3 border border-gray-300 rounded-xl font-medium"}," Cancel "),e("button",{onClick:ae,class:"flex-1 py-3 bg-primary-600 text-white rounded-xl font-medium disabled:opacity-50",disabled:!g.value}," Send Offer ",8,it)])])])):n("",!0)])}}},gt=de(dt,[["__scopeId","data-v-74eccf57"]]);export{gt as default};
