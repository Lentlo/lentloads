var R=($,p,a)=>new Promise((v,u)=>{var _=r=>{try{d(a.next(r))}catch(x){u(x)}},y=r=>{try{d(a.throw(r))}catch(x){u(x)}},d=r=>r.done?v(r.value):Promise.resolve(r.value).then(_,y);d((a=a.apply($,p)).next())});import{f as m,r as T,s as G,o as H,v as J,k as o,l as n,p as t,x as f,H as w,B as i,F as h,I as b,a as C,A as M,U as L,J as P,y as W,C as q,D as K,E as O}from"./vue-vendor-Clry8SR-.js";import{b as U}from"./main-capacitor-isrJZnKt.js";import{toast as z}from"./ui-vendor-B7DvqItC.js";import{d as Q}from"./dayjs.min-BTXJx9iZ.js";import{r as V}from"./StarIcon-BRCRKmnt.js";const X={class:"min-h-screen bg-gray-50 py-6"},Z={class:"container-app max-w-2xl"},I={class:"flex gap-4 mb-6"},ee={key:0,class:"card p-6 mb-6"},te={class:"flex items-center gap-6"},se={class:"text-center"},ae={class:"text-4xl font-bold text-primary-600"},le={class:"flex justify-center mt-1"},oe={class:"text-sm text-gray-500 mt-1"},ne={class:"flex-1"},re={class:"text-sm w-8"},ie={class:"flex-1 bg-gray-200 rounded-full h-2"},de={class:"text-sm text-gray-500 w-8"},ce={key:1,class:"space-y-4"},ue={key:2,class:"space-y-4"},ve={class:"flex items-start gap-4"},me=["src","alt"],pe={class:"flex-1"},_e={class:"flex items-center justify-between"},ye={class:"flex items-center gap-1 mt-1"},xe={class:"text-sm text-gray-500"},ge={key:0,class:"text-gray-600 mt-2"},fe={key:1,class:"text-sm text-gray-500 mt-2"},he={key:2,class:"mt-4 pl-4 border-l-2 border-gray-200"},be={class:"text-sm text-gray-600"},ke={key:3,class:"mt-4"},we=["onClick"],Ce={key:4,class:"mt-4"},Re=["onUpdate:modelValue"],Me={class:"flex gap-2 mt-2"},Ve=["onClick"],$e=["onClick"],Ne={key:3,class:"card p-12 text-center"},Be={class:"text-gray-500"},Ue={__name:"MyReviews",setup($){const p=m(!0),a=m("received"),v=m([]),u=T({received:0,given:0}),_=m(0),y=m({}),d=m([]),r=T({}),x=l=>Q(l).format("MMM D, YYYY"),A=l=>{const s=u.received;return s?(y.value[l]||0)/s*100:0},N=()=>R(this,null,function*(){p.value=!0;try{const l=yield U.get("/reviews/my",{params:{type:a.value}});v.value=l.data.data,a.value==="received"&&l.data.stats&&(_.value=l.data.stats.average||0,y.value=l.data.stats.breakdown||{},u.received=l.data.stats.total||0)}finally{p.value=!1}}),E=l=>R(this,null,function*(){const s=r[l];if(s!=null&&s.trim())try{yield U.post(`/reviews/${l}/respond`,{response:s});const g=v.value.find(e=>e.id===l);g&&(g.seller_response=s),d.value=d.value.filter(e=>e!==l),delete r[l],z.success("Response added")}catch(g){z.error("Failed to add response")}});return G(a,()=>{N()}),H(()=>{N()}),(l,s)=>{const g=J("router-link");return n(),o("div",X,[t("div",Z,[s[5]||(s[5]=t("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"My Reviews",-1)),t("div",I,[t("button",{onClick:s[0]||(s[0]=e=>a.value="received"),class:w(["px-4 py-2 rounded-lg font-medium",a.value==="received"?"bg-primary-600 text-white":"bg-white text-gray-600"])}," Received ("+i(u.received)+") ",3),t("button",{onClick:s[1]||(s[1]=e=>a.value="given"),class:w(["px-4 py-2 rounded-lg font-medium",a.value==="given"?"bg-primary-600 text-white":"bg-white text-gray-600"])}," Given ("+i(u.given)+") ",3)]),a.value==="received"?(n(),o("div",ee,[t("div",te,[t("div",se,[t("p",ae,i(_.value),1),t("div",le,[(n(),o(h,null,b(5,e=>C(M(V),{key:e,class:w(["w-5 h-5",e<=Math.round(_.value)?"text-yellow-400 fill-current":"text-gray-300"])},null,8,["class"])),64))]),t("p",oe,i(u.received)+" reviews",1)]),t("div",ne,[(n(),o(h,null,b(5,e=>t("div",{key:e,class:"flex items-center gap-2 mb-1"},[t("span",re,i(6-e),1),t("div",ie,[t("div",{class:"bg-yellow-400 h-2 rounded-full",style:L({width:A(6-e)+"%"})},null,4)]),t("span",de,i(y.value[6-e]||0),1)])),64))])])])):f("",!0),p.value?(n(),o("div",ce,[(n(),o(h,null,b(3,e=>t("div",{key:e,class:"card p-4"},[...s[2]||(s[2]=[P('<div class="flex gap-4"><div class="skeleton w-10 h-10 rounded-full"></div><div class="flex-1"><div class="skeleton h-4 w-1/4 mb-2"></div><div class="skeleton h-3 w-full"></div></div></div>',1)])])),64))])):v.value.length?(n(),o("div",ue,[(n(!0),o(h,null,b(v.value,e=>{var B,D,Y,j,F,S;return n(),o("div",{key:e.id,class:"card p-4"},[t("div",ve,[t("img",{src:a.value==="received"?(B=e.reviewer)==null?void 0:B.avatar_url:(D=e.reviewed)==null?void 0:D.avatar_url,alt:a.value==="received"?(Y=e.reviewer)==null?void 0:Y.name:(j=e.reviewed)==null?void 0:j.name,class:"w-10 h-10 rounded-full object-cover"},null,8,me),t("div",pe,[t("div",_e,[t("div",null,[C(g,{to:`/user/${a.value==="received"?(F=e.reviewer)==null?void 0:F.id:(S=e.reviewed)==null?void 0:S.id}`,class:"font-semibold text-gray-900 hover:text-primary-600"},{default:W(()=>{var c,k;return[q(i(a.value==="received"?(c=e.reviewer)==null?void 0:c.name:(k=e.reviewed)==null?void 0:k.name),1)]}),_:2},1032,["to"]),t("div",ye,[(n(),o(h,null,b(5,c=>C(M(V),{key:c,class:w(["w-4 h-4",c<=e.rating?"text-yellow-400 fill-current":"text-gray-300"])},null,8,["class"])),64))])]),t("span",xe,i(x(e.created_at)),1)]),e.comment?(n(),o("p",ge,i(e.comment),1)):f("",!0),e.listing?(n(),o("p",fe," Re: "+i(e.listing.title),1)):f("",!0),e.seller_response?(n(),o("div",he,[s[3]||(s[3]=t("p",{class:"text-sm font-medium text-gray-900"},"Your response:",-1)),t("p",be,i(e.seller_response),1)])):a.value==="received"&&!d.value.includes(e.id)?(n(),o("div",ke,[t("button",{onClick:c=>d.value.push(e.id),class:"text-sm text-primary-600 hover:underline"}," Add response ",8,we)])):f("",!0),d.value.includes(e.id)?(n(),o("div",Ce,[K(t("textarea",{"onUpdate:modelValue":c=>r[e.id]=c,rows:"2",class:"input text-sm",placeholder:"Write your response..."},null,8,Re),[[O,r[e.id]]]),t("div",Me,[t("button",{onClick:c=>d.value=d.value.filter(k=>k!==e.id),class:"btn-secondary btn-sm"}," Cancel ",8,Ve),t("button",{onClick:c=>E(e.id),class:"btn-primary btn-sm"}," Submit ",8,$e)])])):f("",!0)])])])}),128))])):(n(),o("div",Ne,[C(M(V),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),s[4]||(s[4]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No reviews yet",-1)),t("p",Be,i(a.value==="received"?"Complete transactions to receive reviews":"Rate your transactions"),1)]))])])}}};export{Ue as default};
