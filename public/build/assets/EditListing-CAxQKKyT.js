import{u as I,C as _,x as j,r as b,K as B,d as h,D as A,e as D,c as i,o,a as t,R as E,y as r,M as v,F as f,h as x,A as u,t as w,E as T,f as R,g as k,j as U,w as G,i as K,B as F,P as n,l as Y}from"./main-CknUce79.js";import{u as z}from"./listings-CgWYCP4i.js";import{r as H}from"./CameraIcon-aikZNkfE.js";const J={class:"min-h-screen bg-gray-50 py-6"},O={class:"container-app max-w-3xl"},Q={class:"card p-6"},W={key:0,class:"space-y-4"},X=["label"],Z=["value"],ee={class:"text-sm text-gray-500 mt-1"},te={class:"grid grid-cols-2 gap-4"},se={class:"relative"},le={class:"grid grid-cols-2 gap-4"},ie={class:"grid grid-cols-4 gap-4"},oe=["src"],ae=["onClick"],ne=["onClick"],re={key:1,class:"absolute bottom-1 left-1 text-xs bg-primary-500 text-white px-2 py-1 rounded"},de={key:0,class:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-primary-500"},ue={class:"border-t pt-6"},pe={class:"grid grid-cols-2 gap-4"},ce={class:"border-t pt-6 flex justify-end gap-4"},ge=["disabled"],fe={__name:"EditListing",setup(me){const p=I(),C=_(),L=j(),y=z(),S=b(!0),m=b(!1),d=b([]),s=B({category_id:"",title:"",description:"",price:"",price_type:"fixed",condition:"",brand:"",model:"",city:"",state:""}),P=h(()=>L.categories),V=async()=>{try{const e=(await F.get(`/listings/${p.params.id}`)).data.data.listing;s.category_id=e.category_id,s.title=e.title,s.description=e.description,s.price=e.price,s.price_type=e.price_type,s.condition=e.condition||"",s.brand=e.brand||"",s.model=e.model||"",s.city=e.city,s.state=e.state||"",d.value=e.images||[]}catch{n.error("Failed to load listing"),C.push("/my-listings")}finally{S.value=!1}},N=async a=>{const e=Array.from(a.target.files),c=10-d.value.length;if(e.length>c){n.error(`You can only add ${c} more images`);return}try{await y.addImages(p.params.id,e.slice(0,c)),n.success("Images added"),V()}catch{n.error("Failed to upload images")}},q=async a=>{if(d.value.length<=1){n.error("Listing must have at least one image");return}try{await y.deleteImage(p.params.id,a),d.value=d.value.filter(e=>e.id!==a),n.success("Image deleted")}catch{n.error("Failed to delete image")}},M=async a=>{try{await F.put(`/listings/${p.params.id}/images/${a}/primary`),d.value=d.value.map(e=>({...e,is_primary:e.id===a})),n.success("Primary image updated")}catch{n.error("Failed to update primary image")}},$=async()=>{m.value=!0;try{await y.updateListing(p.params.id,s),n.success("Listing updated successfully"),C.push("/my-listings")}catch{n.error("Failed to update listing")}finally{m.value=!1}};return A(()=>{V()}),(a,e)=>{const c=D("router-link");return o(),i("div",J,[t("div",O,[t("div",Q,[e[29]||(e[29]=t("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Edit Listing",-1)),S.value?(o(),i("div",W,[...e[10]||(e[10]=[t("div",{class:"skeleton h-10 w-full"},null,-1),t("div",{class:"skeleton h-10 w-full"},null,-1),t("div",{class:"skeleton h-32 w-full"},null,-1)])])):(o(),i("form",{key:1,onSubmit:E($,["prevent"]),class:"space-y-6"},[t("div",null,[e[12]||(e[12]=t("label",{class:"label"},"Category *",-1)),r(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>s.category_id=l),required:"",class:"input"},[e[11]||(e[11]=t("option",{value:""},"Select a category",-1)),(o(!0),i(f,null,x(P.value,l=>(o(),i("optgroup",{key:l.id,label:l.name},[(o(!0),i(f,null,x(l.children,g=>(o(),i("option",{key:g.id,value:g.id},w(g.name),9,Z))),128))],8,X))),128))],512),[[v,s.category_id]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"label"},"Title *",-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.title=l),type:"text",maxlength:"100",required:"",class:"input"},null,512),[[u,s.title]]),t("p",ee,w(s.title.length)+"/100",1)]),t("div",null,[e[14]||(e[14]=t("label",{class:"label"},"Description *",-1)),r(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.description=l),rows:"5",maxlength:"5000",required:"",class:"input"},null,512),[[u,s.description]])]),t("div",te,[t("div",null,[e[16]||(e[16]=t("label",{class:"label"},"Price *",-1)),t("div",se,[e[15]||(e[15]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},"â‚¹",-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.price=l),type:"number",min:"0",required:"",class:"input pl-8"},null,512),[[u,s.price]])])]),t("div",null,[e[18]||(e[18]=t("label",{class:"label"},"Price Type",-1)),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.price_type=l),class:"input"},[...e[17]||(e[17]=[t("option",{value:"fixed"},"Fixed",-1),t("option",{value:"negotiable"},"Negotiable",-1),t("option",{value:"free"},"Free",-1),t("option",{value:"contact"},"Contact for Price",-1)])],512),[[v,s.price_type]])])]),t("div",null,[e[20]||(e[20]=t("label",{class:"label"},"Condition",-1)),r(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.condition=l),class:"input"},[...e[19]||(e[19]=[T('<option value="">Select condition</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[v,s.condition]])]),t("div",le,[t("div",null,[e[21]||(e[21]=t("label",{class:"label"},"Brand",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.brand=l),type:"text",class:"input"},null,512),[[u,s.brand]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"label"},"Model",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.model=l),type:"text",class:"input"},null,512),[[u,s.model]])])]),t("div",null,[e[24]||(e[24]=t("label",{class:"label"},"Current Photos",-1)),t("div",ie,[(o(!0),i(f,null,x(d.value,l=>(o(),i("div",{key:l.id,class:"relative aspect-square bg-gray-100 rounded-lg overflow-hidden"},[t("img",{src:l.thumbnail_url,class:"w-full h-full object-cover"},null,8,oe),t("button",{type:"button",onClick:g=>q(l.id),class:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center"},[k(U(Y),{class:"w-4 h-4"})],8,ae),l.is_primary?(o(),i("span",re," Primary ")):(o(),i("button",{key:0,type:"button",onClick:g=>M(l.id),class:"absolute bottom-1 left-1 text-xs bg-white px-2 py-1 rounded"}," Set as primary ",8,ne))]))),128)),d.value.length<10?(o(),i("label",de,[k(U(H),{class:"w-8 h-8 text-gray-400 mb-1"}),e[23]||(e[23]=t("span",{class:"text-sm text-gray-500"},"Add More",-1)),t("input",{type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:N},null,32)])):R("",!0)])]),t("div",ue,[e[27]||(e[27]=t("h3",{class:"font-semibold text-gray-900 mb-4"},"Location",-1)),t("div",pe,[t("div",null,[e[25]||(e[25]=t("label",{class:"label"},"City *",-1)),r(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.city=l),type:"text",required:"",class:"input"},null,512),[[u,s.city]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"label"},"State",-1)),r(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.state=l),type:"text",class:"input"},null,512),[[u,s.state]])])])]),t("div",ce,[k(c,{to:"/my-listings",class:"btn-secondary"},{default:G(()=>[...e[28]||(e[28]=[K(" Cancel ",-1)])]),_:1}),t("button",{type:"submit",disabled:m.value,class:"btn-primary"},w(m.value?"Saving...":"Save Changes"),9,ge)])],32))])])])}}};export{fe as default};
