import{c as n,o as a,a as s,_ as ve,u as pe,C as fe,b as _e,r as u,d as X,D as me,e as he,f as r,g as i,j as f,t as d,w as V,i as T,I as ge,F as S,h as ye,y as q,A as G,H as ke,S as we,B as w,N as c,X as J,p as j,m as be}from"./main-D2LYTPc_.js";import{d as B}from"./dayjs.min-iy57P9mS.js";import{r as Ce}from"./ArrowLeftIcon-BCBp2li7.js";import{r as $e}from"./PhoneIcon-Dnb2YGYT.js";import{r as Q}from"./CheckIcon-B_mwehtF.js";import"./_commonjsHelpers-Cpj98o6Y.js";function W(O,_){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 8.25H9m6 3H9m3 6-3-3h1.5a3 3 0 1 0 0-6M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function xe(O,_){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function Me(O,_){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}const Te={class:"conversation-page"},Se={key:0,class:"sending-overlay"},Be={class:"conversation-header"},Oe={class:"header-content"},De={key:0,class:"user-info"},Fe={class:"avatar-wrapper"},Ve=["src","alt"],je={class:"user-details"},Ae={class:"header-actions"},Ie=["href"],Ue={key:0,class:"options-menu"},Ye={key:1,class:"product-card"},He=["src","alt"],Ne={class:"product-info"},Ze={class:"product-title"},Le={class:"product-price"},Ke={key:0,class:"loading-spinner"},Re={key:0,class:"date-badge"},ze={key:0,class:"offer-content"},Ee={class:"offer-header"},Pe={class:"offer-amount"},Xe={key:0,class:"offer-actions"},qe=["onClick"],Ge=["onClick"],Je={class:"message-text"},Qe={class:"message-time"},We={key:0,class:"read-status"},es={key:1,class:"empty-state"},ss={class:"input-area"},ts=["disabled"],os={class:"input-wrapper"},as=["disabled","onKeydown"],ns=["disabled"],ls={key:2,class:"modal-overlay"},rs={class:"modal-content"},is={key:0,class:"modal-product"},us=["src"],ds={class:"title"},cs={class:"price"},vs={class:"offer-input"},ps={class:"modal-actions"},fs=["disabled"],_s={__name:"Conversation",setup(O){const _=pe(),D=fe(),ee=_e(),A=u(!0),v=u(!1),l=u(null),m=u([]),h=u(""),p=u(!1),b=u(!1),g=u(""),$=u(null),C=u(null),x=X(()=>{var t;return(t=ee.user)==null?void 0:t.id}),k=X(()=>l.value?l.value.buyer_id===x.value?l.value.seller:l.value.buyer:null),se=t=>B(t).format("h:mm A"),te=t=>{if(!t)return"";const e=B(t);return e.isSame(B(),"day")?"Today":e.isSame(B().subtract(1,"day"),"day")?"Yesterday":e.format("MMM D, YYYY")},oe=t=>{const e=t.target;e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"},ae=()=>{C.value&&(C.value.style.height="auto")},F=()=>{J(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)})},ne=t=>{t.touches[0].clientY},le=t=>{t.touches[0].clientY},re=async()=>{try{const t=await w.get(`/conversations/${_.params.uuid}`);l.value=t.data.data.conversation,m.value=t.data.data.messages.data||[],F()}catch{c.error("Failed to load conversation"),D.push("/messages")}finally{A.value=!1}},I=async()=>{if(!h.value.trim()||v.value)return;v.value=!0;const t=h.value;h.value="",ae();try{const e=await w.post(`/conversations/${_.params.uuid}/messages`,{message:t,type:"text"});m.value.push(e.data.data),F()}catch{h.value=t,c.error("Failed to send message")}finally{v.value=!1,J(()=>{C.value&&C.value.focus()})}},ie=async()=>{if(g.value){v.value=!0,b.value=!1;try{const t=await w.post(`/conversations/${_.params.uuid}/messages`,{message:`I'd like to offer ₹${g.value}`,type:"offer",offer_amount:g.value});m.value.push(t.data.data),g.value="",F(),c.success("Offer sent!")}catch{c.error("Failed to send offer")}finally{v.value=!1}}},U=async(t,e)=>{try{await w.post(`/messages/${t}/offer-response`,{action:e});const y=m.value.find(M=>M.id===t);y&&(y.offer_status=e==="accept"?"accepted":"rejected"),c.success(`Offer ${e}ed`)}catch{c.error("Failed to respond to offer")}},ue=async()=>{p.value=!1;try{await w.post(`/conversations/${_.params.uuid}/block`),c.success("User blocked"),D.push("/messages")}catch{c.error("Failed to block user")}},de=async()=>{p.value=!1;try{await w.delete(`/conversations/${_.params.uuid}`),c.success("Conversation deleted"),D.push("/messages")}catch{c.error("Failed to delete conversation")}};return me(()=>{re()}),(t,e)=>{var M,Y,H,N,Z,L,K,R,z,E;const y=he("router-link");return a(),n("div",Te,[v.value?(a(),n("div",Se,[...e[10]||(e[10]=[s("div",{class:"sending-popup"},[s("div",{class:"sending-spinner"}),s("p",null,"Sending...")],-1)])])):r("",!0),s("header",Be,[s("div",Oe,[s("button",{onClick:e[0]||(e[0]=o=>t.$router.push("/messages")),class:"back-btn"},[i(f(Ce),{class:"w-5 h-5"})]),l.value?(a(),n("div",De,[s("div",Fe,[s("img",{src:((M=k.value)==null?void 0:M.avatar_url)||"/images/default-avatar.png",alt:(Y=k.value)==null?void 0:Y.name,class:"avatar"},null,8,Ve),e[11]||(e[11]=s("span",{class:"online-dot"},null,-1))]),s("div",je,[s("h1",null,d((H=k.value)==null?void 0:H.name),1),e[12]||(e[12]=s("p",null,"Online",-1))])])):r("",!0),s("div",Ae,[(N=k.value)!=null&&N.phone?(a(),n("a",{key:0,href:`tel:${k.value.phone}`,class:"action-btn"},[i(f($e),{class:"w-5 h-5"})],8,Ie)):r("",!0),s("button",{onClick:e[1]||(e[1]=o=>p.value=!p.value),class:"action-btn"},[i(f(xe),{class:"w-5 h-5"})])])]),p.value?(a(),n("div",Ue,[i(y,{to:`/listing/${(L=(Z=l.value)==null?void 0:Z.listing)==null?void 0:L.slug}`,onClick:e[2]||(e[2]=o=>p.value=!1)},{default:V(()=>[...e[13]||(e[13]=[T(" View Listing ",-1)])]),_:1},8,["to"]),i(y,{to:`/user/${(K=k.value)==null?void 0:K.id}`,onClick:e[3]||(e[3]=o=>p.value=!1)},{default:V(()=>[...e[14]||(e[14]=[T(" View Profile ",-1)])]),_:1},8,["to"]),s("button",{onClick:ue,class:"danger"},"Block User"),s("button",{onClick:de,class:"danger"},"Delete Chat")])):r("",!0),(R=l.value)!=null&&R.listing?(a(),n("div",Ye,[i(y,{to:`/listing/${l.value.listing.slug}`,class:"product-link"},{default:V(()=>[s("img",{src:l.value.listing.primary_image_url,alt:l.value.listing.title},null,8,He),s("div",Ne,[s("p",Ze,d(l.value.listing.title),1),s("p",Le,d(l.value.listing.formatted_price||"₹"+l.value.listing.price),1)]),i(f(ge),{class:"w-5 h-5 text-gray-400"})]),_:1},8,["to"])])):r("",!0)]),p.value?(a(),n("div",{key:1,class:"menu-overlay",onClick:e[4]||(e[4]=o=>p.value=!1)})):r("",!0),s("div",{ref_key:"messagesContainer",ref:$,class:"messages-area",onTouchstart:ne,onTouchmove:le},[A.value?(a(),n("div",Ke,[...e[15]||(e[15]=[s("div",{class:"spinner"},null,-1)])])):(a(),n(S,{key:1},[m.value.length>0?(a(),n("div",Re,d(te((z=m.value[0])==null?void 0:z.created_at)),1)):r("",!0),(a(!0),n(S,null,ye(m.value,o=>{var P;return a(),n("div",{key:o.id,class:j(["message-row",o.sender_id===x.value?"sent":"received"])},[s("div",{class:j(["message-bubble",{pending:o.pending}])},[o.type==="offer"?(a(),n("div",ze,[s("div",Ee,[i(f(W),{class:"w-4 h-4"}),e[16]||(e[16]=s("span",null,"Offer",-1))]),s("p",Pe,"₹"+d((P=o.offer_amount)==null?void 0:P.toLocaleString()),1),o.offer_status==="pending"&&o.sender_id!==x.value?(a(),n("div",Xe,[s("button",{onClick:ce=>U(o.id,"accept"),class:"accept-btn"},"Accept",8,qe),s("button",{onClick:ce=>U(o.id,"reject"),class:"decline-btn"},"Decline",8,Ge)])):o.offer_status!=="pending"?(a(),n("p",{key:1,class:j(["offer-status",o.offer_status])},d(o.offer_status==="accepted"?"Accepted":"Declined"),3)):r("",!0)])):r("",!0),s("p",Je,d(o.body),1),s("p",Qe,[o.pending?(a(),n(S,{key:0},[T("Sending...")],64)):(a(),n(S,{key:1},[T(d(se(o.created_at))+" ",1),o.sender_id===x.value?(a(),n("span",We,[i(f(Q),{class:"w-3 h-3"}),o.is_read?(a(),be(f(Q),{key:0,class:"w-3 h-3 -ml-1"})):r("",!0)])):r("",!0)],64))])],2)],2)}),128)),m.value.length===0?(a(),n("div",es,[...e[17]||(e[17]=[s("p",null,"No messages yet. Say hello!",-1)])])):r("",!0)],64))],544),s("div",ss,[s("button",{type:"button",onClick:e[5]||(e[5]=o=>b.value=!0),class:"offer-btn",disabled:v.value},[i(f(W),{class:"w-6 h-6"})],8,ts),s("div",os,[q(s("textarea",{ref_key:"messageInput",ref:C,"onUpdate:modelValue":e[6]||(e[6]=o=>h.value=o),placeholder:"Type a message...",rows:"1",disabled:v.value,onInput:oe,onKeydown:ke(we(I,["exact","prevent"]),["enter"])},null,40,as),[[G,h.value]])]),s("button",{type:"button",onClick:I,disabled:!h.value.trim()||v.value,class:"send-btn"},[i(f(Me),{class:"w-5 h-5"})],8,ns)]),b.value?(a(),n("div",ls,[s("div",{class:"modal-backdrop",onClick:e[7]||(e[7]=o=>b.value=!1)}),s("div",rs,[e[19]||(e[19]=s("h3",null,"Make an Offer",-1)),(E=l.value)!=null&&E.listing?(a(),n("div",is,[s("img",{src:l.value.listing.primary_image_url},null,8,us),s("div",null,[s("p",ds,d(l.value.listing.title),1),s("p",cs,d(l.value.listing.formatted_price||"₹"+l.value.listing.price),1)])])):r("",!0),s("div",vs,[e[18]||(e[18]=s("span",null,"₹",-1)),q(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>g.value=o),type:"number",min:"1",placeholder:"Enter your offer"},null,512),[[G,g.value]])]),s("div",ps,[s("button",{onClick:e[9]||(e[9]=o=>b.value=!1),class:"cancel-btn"},"Cancel"),s("button",{onClick:ie,class:"submit-btn",disabled:!g.value},"Send Offer",8,fs)])])])):r("",!0)])}}},bs=ve(_s,[["__scopeId","data-v-4c3f4d4a"]]);export{bs as default};
