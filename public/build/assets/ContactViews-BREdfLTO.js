import{r as x,G as B,y as E,c as r,o as d,a as t,t as a,f as g,F as w,h as k,J as V,M as j,j as Y,B as O,p as G}from"./main-B5CGK4YZ.js";import{d as L}from"./dayjs.min-BSc964Jx.js";import{r as I}from"./relativeTime-CgjQZ6WX.js";const J={class:"p-6"},W={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},q={class:"card p-4"},H={class:"text-2xl font-bold"},K={class:"card p-4"},Q={class:"text-2xl font-bold text-green-600"},R={class:"card p-4"},X={class:"text-2xl font-bold text-blue-600"},Z={class:"card p-4"},tt={class:"text-2xl font-bold text-purple-600"},et={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"},st={class:"card p-4"},at={class:"space-y-2"},ot={class:"flex items-center gap-2"},nt={class:"w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-xs font-medium"},lt={class:"text-sm font-medium"},rt={class:"text-xs text-gray-500"},dt={class:"badge bg-green-100 text-green-800"},it={key:0,class:"text-sm text-gray-500 text-center py-2"},ct={class:"card p-4"},pt={class:"space-y-2"},_t={class:"flex items-center gap-2"},mt={class:"w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-xs font-medium"},ut={class:"text-sm font-medium"},xt={class:"text-xs text-gray-500"},gt={class:"badge bg-blue-100 text-blue-800"},ft={key:0,class:"text-sm text-gray-500 text-center py-2"},yt={class:"card p-4 mb-6"},ht={class:"flex flex-wrap gap-4"},vt={class:"flex-1 min-w-[200px]"},bt={class:"card overflow-hidden"},wt={key:0,class:"p-8 text-center"},kt={key:1,class:"w-full"},Vt={class:"divide-y"},jt={class:"px-4 py-3"},Ct={class:"flex items-center gap-2"},Tt={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-sm font-medium"},Mt={class:"font-medium text-sm"},Ut={class:"text-xs text-gray-500"},Dt={class:"px-4 py-3"},Nt={class:"flex items-center gap-2"},Ft={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-sm font-medium"},St={class:"font-medium text-sm"},At={class:"text-xs text-gray-500"},Bt={class:"px-4 py-3"},Yt={class:"text-sm font-medium truncate max-w-[200px]"},Ot={class:"px-4 py-3"},Lt={class:"px-4 py-3 text-sm text-gray-600"},Pt={key:0},$t={key:2,class:"p-4 border-t flex items-center justify-between"},zt={class:"text-sm text-gray-600"},Et={class:"flex gap-2"},Gt=["disabled"],It=["disabled"],Kt={__name:"ContactViews",setup(Jt){const P=(o,e)=>{let s;return(...c)=>{clearTimeout(s),s=setTimeout(()=>o(...c),e)}};L.extend(I);const f=x([]),y=x(!0),m=x({}),h=x([]),v=x([]),_=B({search:"",from_date:"",to_date:""}),l=B({current_page:1,last_page:1,from:0,to:0,total:0}),$=o=>L(o).format("MMM D, YYYY h:mm A"),z=async()=>{try{const o=await O.get("/admin/contact-views/stats"),e=o.data.data||o.data;m.value=e.stats||{},h.value=e.top_owners||[],v.value=e.top_viewers||[]}catch(o){console.error("Failed to fetch stats",o)}},u=async()=>{var o,e,s,c,p;y.value=!0;try{const i={page:l.current_page,..._},n=(await O.get("/admin/contact-views",{params:i})).data;f.value=n.data||[],Object.assign(l,{current_page:((o=n.meta)==null?void 0:o.current_page)||n.current_page||1,last_page:((e=n.meta)==null?void 0:e.last_page)||n.last_page||1,from:((s=n.meta)==null?void 0:s.from)||n.from||0,to:((c=n.meta)==null?void 0:c.to)||n.to||0,total:((p=n.meta)==null?void 0:p.total)||n.total||0})}catch(i){console.error("Failed to fetch contact views",i)}finally{y.value=!1}},C=P(()=>{l.current_page=1,u()},300),T=o=>{l.current_page=o,u()};return E(()=>{z(),u()}),(o,e)=>(d(),r("div",J,[e[15]||(e[15]=t("div",{class:"flex items-center justify-between mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Contact Views"),t("span",{class:"text-sm text-gray-500"},"Track who viewed whose contact details")],-1)),t("div",W,[t("div",q,[e[6]||(e[6]=t("p",{class:"text-sm text-gray-500"},"Total Views",-1)),t("p",H,a(m.value.total_views||0),1)]),t("div",K,[e[7]||(e[7]=t("p",{class:"text-sm text-gray-500"},"Today",-1)),t("p",Q,a(m.value.today||0),1)]),t("div",R,[e[8]||(e[8]=t("p",{class:"text-sm text-gray-500"},"This Week",-1)),t("p",X,a(m.value.this_week||0),1)]),t("div",Z,[e[9]||(e[9]=t("p",{class:"text-sm text-gray-500"},"This Month",-1)),t("p",tt,a(m.value.this_month||0),1)])]),t("div",et,[t("div",st,[e[10]||(e[10]=t("h3",{class:"font-semibold mb-3"},"Most Viewed Sellers",-1)),t("div",at,[(d(!0),r(w,null,k(h.value,(s,c)=>{var p,i;return d(),r("div",{key:s.owner_id,class:"flex items-center justify-between"},[t("div",ot,[t("span",nt,a(c+1),1),t("div",null,[t("p",lt,a(((p=s.owner)==null?void 0:p.name)||"Unknown"),1),t("p",rt,a((i=s.owner)==null?void 0:i.email),1)])]),t("span",dt,a(s.view_count)+" views",1)])}),128)),h.value.length?g("",!0):(d(),r("p",it,"No data"))])]),t("div",ct,[e[11]||(e[11]=t("h3",{class:"font-semibold mb-3"},"Most Active Viewers",-1)),t("div",pt,[(d(!0),r(w,null,k(v.value,(s,c)=>{var p,i;return d(),r("div",{key:s.viewer_id,class:"flex items-center justify-between"},[t("div",_t,[t("span",mt,a(c+1),1),t("div",null,[t("p",ut,a(((p=s.viewer)==null?void 0:p.name)||"Unknown"),1),t("p",xt,a((i=s.viewer)==null?void 0:i.email),1)])]),t("span",gt,a(s.view_count)+" views",1)])}),128)),v.value.length?g("",!0):(d(),r("p",ft,"No data"))])])]),t("div",yt,[t("div",ht,[t("div",vt,[V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>_.search=s),type:"text",placeholder:"Search by viewer or owner name/email...",class:"input",onInput:e[1]||(e[1]=(...s)=>Y(C)&&Y(C)(...s))},null,544),[[j,_.search]])]),V(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>_.from_date=s),type:"date",class:"input w-40",onChange:u},null,544),[[j,_.from_date]]),V(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>_.to_date=s),type:"date",class:"input w-40",onChange:u},null,544),[[j,_.to_date]])])]),t("div",bt,[y.value?(d(),r("div",wt,[...e[12]||(e[12]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto"},null,-1)])])):(d(),r("table",kt,[e[14]||(e[14]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Viewer"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Viewed Contact Of"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Listing"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Type"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Date")])],-1)),t("tbody",Vt,[(d(!0),r(w,null,k(f.value,s=>{var c,p,i,b,n,M,U,D,N,F,S,A;return d(),r("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",jt,[t("div",Ct,[t("div",Tt,a(((i=(p=(c=s.viewer)==null?void 0:c.name)==null?void 0:p.charAt(0))==null?void 0:i.toUpperCase())||"?"),1),t("div",null,[t("p",Mt,a((b=s.viewer)==null?void 0:b.name),1),t("p",Ut,a((n=s.viewer)==null?void 0:n.email),1)])])]),t("td",Dt,[t("div",Nt,[t("div",Ft,a(((D=(U=(M=s.owner)==null?void 0:M.name)==null?void 0:U.charAt(0))==null?void 0:D.toUpperCase())||"?"),1),t("div",null,[t("p",St,a((N=s.owner)==null?void 0:N.name),1),t("p",At,a(((F=s.owner)==null?void 0:F.phone)||((S=s.owner)==null?void 0:S.email)),1)])])]),t("td",Bt,[t("p",Yt,a(((A=s.listing)==null?void 0:A.title)||"Deleted"),1)]),t("td",Ot,[t("span",{class:G(["badge",{"bg-blue-100 text-blue-800":s.contact_type==="phone","bg-green-100 text-green-800":s.contact_type==="whatsapp","bg-purple-100 text-purple-800":s.contact_type==="email"}])},a(s.contact_type),3)]),t("td",Lt,a($(s.created_at)),1)])}),128)),f.value.length?g("",!0):(d(),r("tr",Pt,[...e[13]||(e[13]=[t("td",{colspan:"5",class:"px-4 py-8 text-center text-gray-500"}," No contact views found ",-1)])]))])])),l.last_page>1?(d(),r("div",$t,[t("p",zt," Showing "+a(l.from)+" to "+a(l.to)+" of "+a(l.total),1),t("div",Et,[t("button",{onClick:e[4]||(e[4]=s=>T(l.current_page-1)),disabled:l.current_page===1,class:"btn-sm"}," Previous ",8,Gt),t("button",{onClick:e[5]||(e[5]=s=>T(l.current_page+1)),disabled:l.current_page===l.last_page,class:"btn-sm"}," Next ",8,It)])])):g("",!0)])]))}};export{Kt as default};
