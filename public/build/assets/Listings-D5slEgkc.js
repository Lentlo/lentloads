import{u as W,r as a,A as q,l as G,m as J,c as l,o as n,a as t,g as y,w as f,d as u,e as c,v as R,C as L,y as F,F as U,i as E,t as i,j as h,H as g,s as T,h as K,E as Q,f as X}from"./main-CccGz_zE.js";import{d as Z}from"./dayjs.min-Bof1u0Bp.js";import{d as tt}from"./debounce-CA4cRjAU.js";import{r as et}from"./MagnifyingGlassIcon-qiMtPc2a.js";import{r as st}from"./EyeIcon-B3n5wCRs.js";import{r as ot}from"./CheckIcon-C9hWf1_0.js";import{r as at}from"./TrashIcon-CyKn3IkU.js";const lt={class:"p-6"},nt={class:"card p-4 mb-6"},it={class:"flex flex-wrap gap-4"},rt={class:"flex-1 min-w-[200px]"},dt={class:"relative"},ut=["value"],ct={class:"card overflow-hidden"},pt={class:"w-full"},vt={class:"divide-y"},gt={key:0},xt={key:1},mt={class:"px-4 py-3"},yt={class:"flex items-center gap-3"},ft=["src","alt"],bt={class:"font-medium text-gray-900 truncate max-w-[200px]"},_t={class:"text-sm text-gray-500"},ht={class:"px-4 py-3"},wt={class:"px-4 py-3 text-gray-600"},kt={class:"px-4 py-3 font-medium text-gray-900"},Ct={class:"px-4 py-3"},jt={class:"px-4 py-3 text-gray-600"},$t={class:"px-4 py-3"},Lt={class:"flex items-center gap-2"},St=["onClick"],Vt=["onClick"],Mt=["onClick"],Dt={key:0,class:"p-4 border-t flex items-center justify-between"},At={class:"text-sm text-gray-500"},Nt={class:"flex gap-2"},Pt=["disabled"],Rt=["disabled"],Ft={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ut={class:"relative bg-white rounded-xl p-6 w-full max-w-md"},Et={class:"space-y-4"},Tt={class:"flex gap-2"},Yt=["disabled"],Jt={__name:"Listings",setup(Bt){const S=W(),w=a(!0),k=a([]),C=a(""),r=a(1),b=a(1),j=a(20),$=a(0),p=a(null),x=a(""),_=a(""),v=q({status:"",category:""}),V=a([]),Y=o=>Z(o).format("MMM D, YYYY"),B=o=>({active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",rejected:"bg-red-100 text-red-800",sold:"bg-blue-100 text-blue-800",expired:"bg-gray-100 text-gray-800"})[o]||"bg-gray-100 text-gray-800",d=async()=>{w.value=!0;try{const o=await h.get("/admin/listings",{params:{page:r.value,search:C.value,status:v.status,category_id:v.category}});k.value=o.data.data,r.value=o.data.meta.current_page,b.value=o.data.meta.last_page,j.value=o.data.meta.per_page,$.value=o.data.meta.total}finally{w.value=!1}},M=tt(()=>{r.value=1,d()},300),D=o=>{o>=1&&o<=b.value&&(r.value=o,d())},I=async o=>{try{await h.post(`/admin/listings/${o.id}/approve`),g.success("Listing approved"),d()}catch{g.error("Failed to approve listing")}},z=o=>{p.value=o,x.value="",_.value=""},H=async()=>{try{await h.post(`/admin/listings/${p.value.id}/reject`,{reason:x.value,notes:_.value}),g.success("Listing rejected"),p.value=null,d()}catch{g.error("Failed to reject listing")}},O=async o=>{if(confirm(`Delete "${o.title}"? This cannot be undone.`))try{await h.delete(`/admin/listings/${o.id}`),g.success("Listing deleted"),d()}catch{g.error("Failed to delete listing")}};return G(async()=>{await S.fetchCategories(),V.value=S.categories,d()}),(o,e)=>{const A=J("router-link");return n(),l("div",lt,[e[19]||(e[19]=t("div",{class:"flex items-center justify-between mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"Manage Listings")],-1)),t("div",nt,[t("div",it,[t("div",rt,[t("div",dt,[u(c(et),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),type:"text",placeholder:"Search listings...",class:"input pl-10",onInput:e[1]||(e[1]=(...s)=>c(M)&&c(M)(...s))},null,544),[[R,C.value]])])]),f(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>v.status=s),onChange:d,class:"input w-auto"},[...e[10]||(e[10]=[F('<option value="">All Status</option><option value="pending">Pending</option><option value="active">Active</option><option value="rejected">Rejected</option><option value="sold">Sold</option><option value="expired">Expired</option>',6)])],544),[[L,v.status]]),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>v.category=s),onChange:d,class:"input w-auto"},[e[11]||(e[11]=t("option",{value:""},"All Categories",-1)),(n(!0),l(U,null,E(V.value,s=>(n(),l("option",{key:s.id,value:s.id},i(s.name),9,ut))),128))],544),[[L,v.category]])])]),t("div",ct,[t("table",pt,[e[14]||(e[14]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Listing"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Seller"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Category"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Price"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Status"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Date"),t("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions")])],-1)),t("tbody",vt,[w.value?(n(),l("tr",gt,[...e[12]||(e[12]=[t("td",{colspan:"7",class:"px-4 py-8 text-center text-gray-500"}," Loading... ",-1)])])):k.value.length?y("",!0):(n(),l("tr",xt,[...e[13]||(e[13]=[t("td",{colspan:"7",class:"px-4 py-8 text-center text-gray-500"}," No listings found ",-1)])])),(n(!0),l(U,null,E(k.value,s=>{var N,P;return n(),l("tr",{key:s.id,class:"hover:bg-gray-50"},[t("td",mt,[t("div",yt,[t("img",{src:s.primary_image_url,alt:s.title,class:"w-12 h-12 rounded object-cover"},null,8,ft),t("div",null,[t("p",bt,i(s.title),1),t("p",_t,"ID: "+i(s.id),1)])])]),t("td",ht,[u(A,{to:`/user/${(N=s.user)==null?void 0:N.id}`,class:"text-primary-600 hover:underline"},{default:T(()=>{var m;return[K(i((m=s.user)==null?void 0:m.name),1)]}),_:2},1032,["to"])]),t("td",wt,i((P=s.category)==null?void 0:P.name),1),t("td",kt,i(s.formatted_price),1),t("td",Ct,[t("span",{class:Q(["badge",B(s.status)])},i(s.status),3)]),t("td",jt,i(Y(s.created_at)),1),t("td",$t,[t("div",Lt,[u(A,{to:`/listing/${s.slug}`,class:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"View",target:"_blank"},{default:T(()=>[u(c(st),{class:"w-5 h-5"})]),_:1},8,["to"]),s.status==="pending"?(n(),l("button",{key:0,onClick:m=>I(s),class:"p-1 text-green-600 hover:bg-green-50 rounded",title:"Approve"},[u(c(ot),{class:"w-5 h-5"})],8,St)):y("",!0),s.status==="pending"?(n(),l("button",{key:1,onClick:m=>z(s),class:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Reject"},[u(c(X),{class:"w-5 h-5"})],8,Vt)):y("",!0),t("button",{onClick:m=>O(s),class:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete"},[u(c(at),{class:"w-5 h-5"})],8,Mt)])])])}),128))])]),b.value>1?(n(),l("div",Dt,[t("p",At," Showing "+i((r.value-1)*j.value+1)+" to "+i(Math.min(r.value*j.value,$.value))+" of "+i($.value)+" listings ",1),t("div",Nt,[t("button",{onClick:e[4]||(e[4]=s=>D(r.value-1)),disabled:r.value===1,class:"btn-secondary btn-sm"}," Previous ",8,Pt),t("button",{onClick:e[5]||(e[5]=s=>D(r.value+1)),disabled:r.value===b.value,class:"btn-secondary btn-sm"}," Next ",8,Rt)])])):y("",!0)]),p.value?(n(),l("div",Ft,[t("div",{class:"absolute inset-0 bg-black/50",onClick:e[6]||(e[6]=s=>p.value=null)}),t("div",Ut,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold mb-4"},"Reject Listing",-1)),t("div",Et,[t("div",null,[e[16]||(e[16]=t("label",{class:"label"},"Reason for rejection",-1)),f(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>x.value=s),class:"input"},[...e[15]||(e[15]=[F('<option value="">Select a reason</option><option value="prohibited_item">Prohibited item</option><option value="misleading_info">Misleading information</option><option value="duplicate">Duplicate listing</option><option value="inappropriate_content">Inappropriate content</option><option value="wrong_category">Wrong category</option><option value="other">Other</option>',7)])],512),[[L,x.value]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"label"},"Additional notes (optional)",-1)),f(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=s=>_.value=s),rows:"3",class:"input",placeholder:"Explain the issue..."},null,512),[[R,_.value]])]),t("div",Tt,[t("button",{onClick:e[9]||(e[9]=s=>p.value=null),class:"btn-secondary flex-1"}," Cancel "),t("button",{onClick:H,disabled:!x.value,class:"btn-danger flex-1"}," Reject ",8,Yt)])])])])):y("",!0)])}}};export{Jt as default};
