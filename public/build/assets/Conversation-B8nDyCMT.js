import{c as r,o as a,a as e,u as J,C as K,b as P,r as i,d as N,D as W,e as ee,f as v,g as m,j as _,t as p,w as te,F as se,h as oe,S as re,y as R,A as H,B as h,Q as n,X as ae,p as C,i as ne}from"./main-CBkiVDVn.js";import{d as le}from"./dayjs.min-iy57P9mS.js";import{r as ie}from"./ArrowLeftIcon-Bx1PQedh.js";import{r as de}from"./EyeIcon-D2ejAOyL.js";import"./_commonjsHelpers-Cpj98o6Y.js";function ue($,d){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 8.25H9m6 3H9m3 6-3-3h1.5a3 3 0 1 0 0-6M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ce($,d){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function pe($,d){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}const fe={class:"min-h-screen bg-gray-50 flex flex-col"},ve={class:"bg-white border-b sticky top-0 z-10"},me={class:"container-app py-3 flex items-center gap-4"},he={key:0,class:"flex items-center gap-3 flex-1 min-w-0"},ye=["src","alt"],xe={class:"min-w-0"},ge={class:"font-semibold text-gray-900 truncate"},be={class:"text-sm text-gray-500 truncate"},_e={class:"flex items-center gap-2"},we={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border z-50"},ke={key:0,class:"flex justify-center py-8"},Ce={key:0,class:"mb-2"},$e={class:"text-xl font-bold"},Me={key:0,class:"flex gap-2 mt-2"},je=["onClick"],Be=["onClick"],Oe={key:0},Te={class:"bg-white border-t p-4"},Fe={class:"container-app"},Ue=["disabled"],Ve=["disabled"],Ae={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Se={class:"relative bg-white rounded-xl p-6 w-full max-w-sm"},Ze={class:"text-sm text-gray-500 mb-4"},ze={class:"relative mb-4"},De={class:"flex gap-2"},Ne=["disabled"],Qe={__name:"Conversation",setup($){const d=J(),M=K(),L=P(),T=i(!0),y=i(!1),l=i(null),x=i([]),u=i(""),j=i(!1),g=i(!1),c=i(""),w=i(null),f=N(()=>{var o;return(o=L.user)==null?void 0:o.id}),B=N(()=>l.value?l.value.buyer_id===f.value?l.value.seller:l.value.buyer:null),E=o=>le(o).format("h:mm A"),O=()=>{ae(()=>{w.value&&(w.value.scrollTop=w.value.scrollHeight)})},I=async()=>{try{const o=await h.get(`/conversations/${d.params.uuid}`);l.value=o.data.data.conversation,x.value=o.data.data.messages.data||[],O()}catch{n.error("Failed to load conversation"),M.push("/messages")}finally{T.value=!1}},Q=async()=>{if(!u.value.trim()||y.value)return;y.value=!0;const o=u.value;u.value="";try{const t=await h.post(`/conversations/${d.params.uuid}/messages`,{message:o,type:"text"});x.value.push(t.data.data),O()}catch{u.value=o,n.error("Failed to send message")}finally{y.value=!1}},X=async()=>{if(c.value)try{const o=await h.post(`/conversations/${d.params.uuid}/messages`,{message:`I'd like to offer ₹${c.value}`,type:"offer",offer_amount:c.value});x.value.push(o.data.data),g.value=!1,c.value="",O(),n.success("Offer sent!")}catch{n.error("Failed to send offer")}},F=async(o,t)=>{try{await h.post(`/messages/${o}/offer-response`,{action:t});const b=x.value.find(k=>k.id===o);b&&(b.offer_status=t==="accept"?"accepted":"rejected"),n.success(`Offer ${t}ed`)}catch{n.error("Failed to respond to offer")}},Y=async()=>{try{await h.post(`/conversations/${d.params.uuid}/block`),n.success("User blocked"),M.push("/messages")}catch{n.error("Failed to block user")}},q=async()=>{try{await h.delete(`/conversations/${d.params.uuid}`),n.success("Conversation deleted"),M.push("/messages")}catch{n.error("Failed to delete conversation")}};return W(()=>{I()}),(o,t)=>{var k,U,V,A,S,Z,z,D;const b=ee("router-link");return a(),r("div",fe,[e("header",ve,[e("div",me,[e("button",{onClick:t[0]||(t[0]=s=>o.$router.back()),class:"p-2 hover:bg-gray-100 rounded-lg"},[m(_(ie),{class:"w-5 h-5"})]),l.value?(a(),r("div",he,[e("img",{src:(k=B.value)==null?void 0:k.avatar_url,alt:(U=B.value)==null?void 0:U.name,class:"w-10 h-10 rounded-full object-cover"},null,8,ye),e("div",xe,[e("h1",ge,p((V=B.value)==null?void 0:V.name),1),e("p",be,p((A=l.value.listing)==null?void 0:A.title),1)])])):v("",!0),e("div",_e,[m(b,{to:`/listing/${(Z=(S=l.value)==null?void 0:S.listing)==null?void 0:Z.slug}`,class:"p-2 hover:bg-gray-100 rounded-lg",title:"View listing"},{default:te(()=>[m(_(de),{class:"w-5 h-5 text-gray-600"})]),_:1},8,["to"]),e("button",{onClick:t[1]||(t[1]=s=>j.value=!j.value),class:"p-2 hover:bg-gray-100 rounded-lg relative"},[m(_(ce),{class:"w-5 h-5 text-gray-600"}),j.value?(a(),r("div",we,[e("button",{onClick:Y,class:"w-full px-4 py-2 text-left text-red-600 hover:bg-red-50"}," Block User "),e("button",{onClick:q,class:"w-full px-4 py-2 text-left text-red-600 hover:bg-red-50"}," Delete Conversation ")])):v("",!0)])])])]),e("div",{ref_key:"messagesContainer",ref:w,class:"flex-1 overflow-y-auto p-4 space-y-4"},[T.value?(a(),r("div",ke,[...t[7]||(t[7]=[e("div",{class:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"},null,-1)])])):(a(!0),r(se,{key:1},oe(x.value,s=>(a(),r("div",{key:s.id,class:C(["flex",s.sender_id===f.value?"justify-end":"justify-start"])},[e("div",{class:C(["max-w-[75%] rounded-2xl px-4 py-2",s.sender_id===f.value?"bg-primary-600 text-white rounded-br-md":"bg-white text-gray-900 rounded-bl-md shadow"])},[s.type==="offer"?(a(),r("div",Ce,[t[8]||(t[8]=e("p",{class:"text-sm opacity-75"},"Made an offer",-1)),e("p",$e,"₹"+p(s.offer_amount),1),s.offer_status==="pending"&&s.sender_id!==f.value?(a(),r("div",Me,[e("button",{onClick:G=>F(s.id,"accept"),class:"px-3 py-1 bg-green-500 text-white rounded text-sm"}," Accept ",8,je),e("button",{onClick:G=>F(s.id,"reject"),class:"px-3 py-1 bg-red-500 text-white rounded text-sm"}," Reject ",8,Be)])):s.offer_status!=="pending"?(a(),r("p",{key:1,class:C(["text-sm mt-1",s.offer_status==="accepted"?"text-green-300":"text-red-300"])}," Offer "+p(s.offer_status),3)):v("",!0)])):v("",!0),e("p",null,p(s.body),1),e("p",{class:C(["text-xs mt-1",s.sender_id===f.value?"text-primary-200":"text-gray-400"])},[ne(p(E(s.created_at))+" ",1),s.sender_id===f.value&&s.is_read?(a(),r("span",Oe," · Read ")):v("",!0)],2)],2)],2))),128))],512),e("div",Te,[e("div",Fe,[e("form",{onSubmit:re(Q,["prevent"]),class:"flex gap-2"},[e("button",{type:"button",onClick:t[2]||(t[2]=s=>g.value=!0),class:"p-3 text-primary-600 hover:bg-primary-50 rounded-lg",title:"Make an offer"},[m(_(ue),{class:"w-6 h-6"})]),R(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value=s),type:"text",placeholder:"Type a message...",class:"flex-1 input",disabled:y.value},null,8,Ue),[[H,u.value]]),e("button",{type:"submit",disabled:!u.value.trim()||y.value,class:"btn-primary px-6"},[m(_(pe),{class:"w-5 h-5"})],8,Ve)],32)])]),g.value?(a(),r("div",Ae,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[4]||(t[4]=s=>g.value=!1)}),e("div",Se,[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold mb-4"},"Make an Offer",-1)),e("p",Ze," Listing price: "+p((D=(z=l.value)==null?void 0:z.listing)==null?void 0:D.formatted_price),1),e("div",ze,[t[9]||(t[9]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},"₹",-1)),R(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>c.value=s),type:"number",min:"1",class:"input pl-8",placeholder:"Your offer"},null,512),[[H,c.value]])]),e("div",De,[e("button",{onClick:t[6]||(t[6]=s=>g.value=!1),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:X,class:"btn-primary flex-1",disabled:!c.value}," Send Offer ",8,Ne)])])])):v("",!0)])}}};export{Qe as default};
