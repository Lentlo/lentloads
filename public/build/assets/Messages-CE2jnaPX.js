import{b as P,d,e as w,z as T,f as U,c as r,o as l,a as e,g as c,F as M,i as N,h as j,k as z,s as A,w as C,j as B,t as o,C as E,n as I}from"./main-BBche1Ln.js";import{d as L}from"./dayjs.min-BTLq5Hqd.js";import{r as O}from"./relativeTime-BNktVWPQ.js";const R={class:"messages-page min-h-screen bg-gray-50"},Y={class:"container-app py-6"},$={key:0,class:"space-y-4"},q={key:1,class:"space-y-2"},G=["src","alt"],H={class:"flex-1 min-w-0"},J={class:"flex items-center justify-between mb-1"},K={class:"font-semibold text-gray-900 truncate"},Q={class:"text-xs text-gray-500"},W={class:"text-sm text-gray-500 truncate mb-1"},X={class:"text-sm text-gray-600 truncate"},Z={key:0},ee={key:0,class:"flex items-center"},se={class:"w-6 h-6 bg-primary-600 text-white text-xs rounded-full flex items-center justify-center"},te=["src"],ae={key:2,class:"card p-12 text-center"},le={key:3,class:"mt-6 text-center"},re=["disabled"],ce={__name:"Messages",setup(oe){L.extend(O);const S=P(),u=d(!0),i=d(!1),n=d([]),m=d(1),g=d(1),y=w(()=>{var a;return(a=S.user)==null?void 0:a.id}),V=w(()=>m.value<g.value),_=a=>a.buyer_id===y.value?a.seller:a.buyer,D=a=>a?L(a).fromNow():"",f=async(a=!1)=>{a?i.value=!0:u.value=!0;try{const s=await E.get("/conversations",{params:{page:a?m.value+1:1}});a?n.value=[...n.value,...s.data.data]:n.value=s.data.data,m.value=s.data.meta.current_page,g.value=s.data.meta.last_page}finally{u.value=!1,i.value=!1}},F=()=>{f(!0)};return T(()=>{f()}),(a,s)=>{const p=U("router-link");return l(),r("div",R,[e("div",Y,[s[4]||(s[4]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Messages",-1)),u.value?(l(),r("div",$,[(l(),r(M,null,N(5,t=>e("div",{key:t,class:"card p-4 flex gap-4"},[...s[0]||(s[0]=[e("div",{class:"skeleton w-12 h-12 rounded-full"},null,-1),e("div",{class:"flex-1"},[e("div",{class:"skeleton h-4 w-1/3 mb-2"}),e("div",{class:"skeleton h-3 w-2/3"})],-1)])])),64))])):n.value.length?(l(),r("div",q,[(l(!0),r(M,null,N(n.value,t=>(l(),I(p,{key:t.id,to:`/messages/${t.uuid}`,class:"card p-4 flex gap-4 hover:shadow-md transition"},{default:C(()=>{var h,x,v,b,k;return[e("img",{src:_(t).avatar_url,alt:_(t).name,class:"w-12 h-12 rounded-full object-cover"},null,8,G),e("div",H,[e("div",J,[e("h3",K,o(_(t).name),1),e("span",Q,o(D((h=t.latest_message)==null?void 0:h.created_at)),1)]),e("p",W," Re: "+o((x=t.listing)==null?void 0:x.title),1),e("p",X,[((v=t.latest_message)==null?void 0:v.sender_id)===y.value?(l(),r("span",Z,"You: ")):c("",!0),B(" "+o(((b=t.latest_message)==null?void 0:b.body)||"No messages yet"),1)])]),t.unread_count>0?(l(),r("div",ee,[e("span",se,o(t.unread_count),1)])):c("",!0),(k=t.listing)!=null&&k.primary_image?(l(),r("img",{key:1,src:t.listing.primary_image.thumbnail_url,class:"w-16 h-16 rounded-lg object-cover hidden sm:block"},null,8,te)):c("",!0)]}),_:2},1032,["to"]))),128))])):(l(),r("div",ae,[j(z(A),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),s[2]||(s[2]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No messages yet",-1)),s[3]||(s[3]=e("p",{class:"text-gray-500 mb-4"},"Start a conversation by contacting a seller",-1)),j(p,{to:"/search",class:"btn-primary"},{default:C(()=>[...s[1]||(s[1]=[B(" Browse Listings ",-1)])]),_:1})])),V.value?(l(),r("div",le,[e("button",{onClick:F,disabled:i.value,class:"btn-secondary"},o(i.value?"Loading...":"Load More"),9,re)])):c("",!0)])])}}};export{ce as default};
