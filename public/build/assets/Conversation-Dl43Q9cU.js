import{c as r,o as a,a as e,C as P,l as Q,L as W,r as d,b as N,m as X,n as ee,g as f,d as m,e as _,t as p,y as te,F as se,j as oe,O as re,w as R,v as D,k as h,K as n,V as ae,I as $,h as ne}from"./main-Dzo1rjju.js";import{d as le}from"./dayjs.min-Bof1u0Bp.js";import{r as ie}from"./EyeIcon-QidhatGe.js";function de(w,l){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"})])}function ue(w,l){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 8.25H9m6 3H9m3 6-3-3h1.5a3 3 0 1 0 0-6M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ce(w,l){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function pe(w,l){return a(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}const ve={class:"min-h-screen bg-gray-50 flex flex-col"},fe={class:"bg-white border-b sticky top-0 z-10"},me={class:"container-app py-3 flex items-center gap-4"},he={key:0,class:"flex items-center gap-3 flex-1 min-w-0"},xe=["src","alt"],ye={class:"min-w-0"},ge={class:"font-semibold text-gray-900 truncate"},be={class:"text-sm text-gray-500 truncate"},_e={class:"flex items-center gap-2"},we={key:0,class:"absolute right-0 top-full mt-1 w-48 bg-white rounded-lg shadow-lg border z-50"},ke={key:0,class:"flex justify-center py-8"},Ce={key:0,class:"mb-2"},$e={class:"text-xl font-bold"},Me={key:0,class:"flex gap-2 mt-2"},je=["onClick"],Oe=["onClick"],Be={key:0},Te={class:"bg-white border-t p-4"},Fe={class:"container-app"},Ve=["disabled"],Ue=["disabled"],Ae={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Se={class:"relative bg-white rounded-xl p-6 w-full max-w-sm"},Ze={class:"text-sm text-gray-500 mb-4"},ze={class:"relative mb-4"},Le={class:"flex gap-2"},Ne=["disabled"],Ie={__name:"Conversation",setup(w){const l=P(),M=Q(),H=W(),T=d(!0),x=d(!1),i=d(null),y=d([]),u=d(""),j=d(!1),g=d(!1),c=d(""),k=d(null),v=N(()=>{var o;return(o=H.user)==null?void 0:o.id}),O=N(()=>i.value?i.value.buyer_id===v.value?i.value.seller:i.value.buyer:null),I=o=>le(o).format("h:mm A"),B=()=>{ae(()=>{k.value&&(k.value.scrollTop=k.value.scrollHeight)})},E=async()=>{try{const o=await h.get(`/conversations/${l.params.uuid}`);i.value=o.data.data.conversation,y.value=o.data.data.messages.data||[],B()}catch{n.error("Failed to load conversation"),M.push("/messages")}finally{T.value=!1}},K=async()=>{if(!u.value.trim()||x.value)return;x.value=!0;const o=u.value;u.value="";try{const t=await h.post(`/conversations/${l.params.uuid}/messages`,{message:o,type:"text"});y.value.push(t.data.data),B()}catch{u.value=o,n.error("Failed to send message")}finally{x.value=!1}},Y=async()=>{if(c.value)try{const o=await h.post(`/conversations/${l.params.uuid}/messages`,{message:`I'd like to offer ₹${c.value}`,type:"offer",offer_amount:c.value});y.value.push(o.data.data),g.value=!1,c.value="",B(),n.success("Offer sent!")}catch{n.error("Failed to send offer")}},F=async(o,t)=>{try{await h.post(`/messages/${o}/offer-response`,{action:t});const b=y.value.find(C=>C.id===o);b&&(b.offer_status=t==="accept"?"accepted":"rejected"),n.success(`Offer ${t}ed`)}catch{n.error("Failed to respond to offer")}},q=async()=>{try{await h.post(`/conversations/${l.params.uuid}/block`),n.success("User blocked"),M.push("/messages")}catch{n.error("Failed to block user")}},G=async()=>{try{await h.delete(`/conversations/${l.params.uuid}`),n.success("Conversation deleted"),M.push("/messages")}catch{n.error("Failed to delete conversation")}};return X(()=>{E()}),(o,t)=>{var C,V,U,A,S,Z,z,L;const b=ee("router-link");return a(),r("div",ve,[e("header",fe,[e("div",me,[e("button",{onClick:t[0]||(t[0]=s=>o.$router.back()),class:"p-2 hover:bg-gray-100 rounded-lg"},[m(_(de),{class:"w-5 h-5"})]),i.value?(a(),r("div",he,[e("img",{src:(C=O.value)==null?void 0:C.avatar_url,alt:(V=O.value)==null?void 0:V.name,class:"w-10 h-10 rounded-full object-cover"},null,8,xe),e("div",ye,[e("h1",ge,p((U=O.value)==null?void 0:U.name),1),e("p",be,p((A=i.value.listing)==null?void 0:A.title),1)])])):f("",!0),e("div",_e,[m(b,{to:`/listing/${(Z=(S=i.value)==null?void 0:S.listing)==null?void 0:Z.slug}`,class:"p-2 hover:bg-gray-100 rounded-lg",title:"View listing"},{default:te(()=>[m(_(ie),{class:"w-5 h-5 text-gray-600"})]),_:1},8,["to"]),e("button",{onClick:t[1]||(t[1]=s=>j.value=!j.value),class:"p-2 hover:bg-gray-100 rounded-lg relative"},[m(_(ce),{class:"w-5 h-5 text-gray-600"}),j.value?(a(),r("div",we,[e("button",{onClick:q,class:"w-full px-4 py-2 text-left text-red-600 hover:bg-red-50"}," Block User "),e("button",{onClick:G,class:"w-full px-4 py-2 text-left text-red-600 hover:bg-red-50"}," Delete Conversation ")])):f("",!0)])])])]),e("div",{ref_key:"messagesContainer",ref:k,class:"flex-1 overflow-y-auto p-4 space-y-4"},[T.value?(a(),r("div",ke,[...t[7]||(t[7]=[e("div",{class:"w-8 h-8 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"},null,-1)])])):(a(!0),r(se,{key:1},oe(y.value,s=>(a(),r("div",{key:s.id,class:$(["flex",s.sender_id===v.value?"justify-end":"justify-start"])},[e("div",{class:$(["max-w-[75%] rounded-2xl px-4 py-2",s.sender_id===v.value?"bg-primary-600 text-white rounded-br-md":"bg-white text-gray-900 rounded-bl-md shadow"])},[s.type==="offer"?(a(),r("div",Ce,[t[8]||(t[8]=e("p",{class:"text-sm opacity-75"},"Made an offer",-1)),e("p",$e,"₹"+p(s.offer_amount),1),s.offer_status==="pending"&&s.sender_id!==v.value?(a(),r("div",Me,[e("button",{onClick:J=>F(s.id,"accept"),class:"px-3 py-1 bg-green-500 text-white rounded text-sm"}," Accept ",8,je),e("button",{onClick:J=>F(s.id,"reject"),class:"px-3 py-1 bg-red-500 text-white rounded text-sm"}," Reject ",8,Oe)])):s.offer_status!=="pending"?(a(),r("p",{key:1,class:$(["text-sm mt-1",s.offer_status==="accepted"?"text-green-300":"text-red-300"])}," Offer "+p(s.offer_status),3)):f("",!0)])):f("",!0),e("p",null,p(s.body),1),e("p",{class:$(["text-xs mt-1",s.sender_id===v.value?"text-primary-200":"text-gray-400"])},[ne(p(I(s.created_at))+" ",1),s.sender_id===v.value&&s.is_read?(a(),r("span",Be," · Read ")):f("",!0)],2)],2)],2))),128))],512),e("div",Te,[e("div",Fe,[e("form",{onSubmit:re(K,["prevent"]),class:"flex gap-2"},[e("button",{type:"button",onClick:t[2]||(t[2]=s=>g.value=!0),class:"p-3 text-primary-600 hover:bg-primary-50 rounded-lg",title:"Make an offer"},[m(_(ue),{class:"w-6 h-6"})]),R(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value=s),type:"text",placeholder:"Type a message...",class:"flex-1 input",disabled:x.value},null,8,Ve),[[D,u.value]]),e("button",{type:"submit",disabled:!u.value.trim()||x.value,class:"btn-primary px-6"},[m(_(pe),{class:"w-5 h-5"})],8,Ue)],32)])]),g.value?(a(),r("div",Ae,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[4]||(t[4]=s=>g.value=!1)}),e("div",Se,[t[10]||(t[10]=e("h3",{class:"text-lg font-semibold mb-4"},"Make an Offer",-1)),e("p",Ze," Listing price: "+p((L=(z=i.value)==null?void 0:z.listing)==null?void 0:L.formatted_price),1),e("div",ze,[t[9]||(t[9]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},"₹",-1)),R(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>c.value=s),type:"number",min:"1",class:"input pl-8",placeholder:"Your offer"},null,512),[[D,c.value]])]),e("div",Le,[e("button",{onClick:t[6]||(t[6]=s=>g.value=!1),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:Y,class:"btn-primary flex-1",disabled:!c.value}," Send Offer ",8,Ne)])])])):f("",!0)])}}};export{Ie as default};
