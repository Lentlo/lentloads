var P=(S,I,a)=>new Promise((u,g)=>{var c=n=>{try{r(a.next(n))}catch(p){g(p)}},f=n=>{try{r(a.throw(n))}catch(p){g(p)}},r=n=>n.done?u(n.value):Promise.resolve(n.value).then(c,f);r((a=a.apply(S,I)).next())});import{f as h,r as W,b as Y,o as F,e as J,s as C,k as v,l as x,p as l,x as O,A as H,I as Q,C as L,D as w}from"./vue-vendor-DFuH7PQo.js";import{L as b}from"./leaflet-DM52LaZd.js";const X={class:"location-picker"},tt={class:"relative"},et={key:0,class:"absolute inset-0 bg-white/70 flex items-center justify-center rounded-lg"},at={class:"flex items-center gap-2 text-gray-600"},it=["disabled"],ot={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},lt={key:1,class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},nt={key:0,class:"mt-4 p-4 bg-gray-50 rounded-lg space-y-3"},st={class:"grid grid-cols-2 gap-3"},dt={class:"grid grid-cols-2 gap-3"},pt={__name:"LocationPicker",props:{latitude:{type:Number,default:null},longitude:{type:Number,default:null},city:{type:String,default:""},state:{type:String,default:""},locality:{type:String,default:""},postalCode:{type:String,default:""},initialLatitude:{type:Number,default:null},initialLongitude:{type:Number,default:null},initialCity:{type:String,default:""},initialState:{type:String,default:""},initialLocality:{type:String,default:""},initialPostalCode:{type:String,default:""}},emits:["update:location","update:latitude","update:longitude","update:locality","update:city","update:state","update:postalCode"],setup(S,{emit:I}){var _,j;delete b.Icon.Default.prototype._getIconUrl,b.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const a=S,u=I,g=h(null),c=h(!1),f=h("Loading map..."),r=h(!1);let n=null,p=null;const e=W({latitude:(_=a.latitude)!=null?_:a.initialLatitude,longitude:(j=a.longitude)!=null?j:a.initialLongitude,locality:a.locality||a.initialLocality||"",city:a.city||a.initialCity||"",state:a.state||a.initialState||"",postal_code:a.postalCode||a.initialPostalCode||"",address:""}),R=Y(()=>e.latitude&&e.longitude||e.city||e.state||e.locality);F(()=>{Z(),K()}),J(()=>{n&&(n.remove(),n=null)});const Z=()=>{var U,A,N,D,z,B,T;if(!g.value)return;const i=(U=a.latitude)!=null?U:a.initialLatitude,t=(N=(A=a.latitude)!=null?A:a.initialLatitude)!=null?N:20.5937,o=(z=(D=a.longitude)!=null?D:a.initialLongitude)!=null?z:78.9629,d=i?15:5;n=b.map(g.value,{scrollWheelZoom:!1,touchZoom:!0,zoomControl:!0}).setView([t,o],d),b.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(n);const s=(B=a.latitude)!=null?B:a.initialLatitude,M=(T=a.longitude)!=null?T:a.initialLongitude;s&&M&&y(s,M),n.on("click",$=>{const{lat:E,lng:G}=$.latlng;y(E,G),k(E,G)})},y=(i,t)=>{p&&n.removeLayer(p),p=b.marker([i,t],{draggable:!0}).addTo(n),p.on("dragend",o=>{const d=o.target.getLatLng();k(d.lat,d.lng)}),e.latitude=i,e.longitude=t},k=(i,t)=>P(this,null,function*(){c.value=!0,f.value="Getting address...";try{const o=yield fetch(`https://nominatim.openstreetmap.org/reverse?lat=${i}&lon=${t}&format=json&addressdetails=1`,{headers:{"Accept-Language":"en"}});if(!o.ok)throw new Error("Geocoding failed");const d=yield o.json(),s=d.address||{};e.latitude=i,e.longitude=t,e.locality=s.suburb||s.neighbourhood||s.village||s.town||"",e.city=s.city||s.town||s.village||s.county||"",e.state=s.state||"",e.postal_code=s.postcode||"",e.address=d.display_name||"",m()}catch(o){console.error("Reverse geocoding error:",o),e.latitude=i,e.longitude=t,m()}finally{c.value=!1}}),q=()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}r.value=!0,navigator.geolocation.getCurrentPosition(i=>{const{latitude:t,longitude:o}=i.coords;n.setView([t,o],16),y(t,o),k(t,o),r.value=!1},i=>{r.value=!1;let t="Unable to get your location";switch(i.code){case i.PERMISSION_DENIED:t="Location permission denied. Please enable location access in your browser settings.";break;case i.POSITION_UNAVAILABLE:t="Location information unavailable. Please try again.";break;case i.TIMEOUT:t="Location request timed out. Please try again.";break}alert(t)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},m=()=>{u("update:location",{latitude:e.latitude,longitude:e.longitude,locality:e.locality,city:e.city,state:e.state,postal_code:e.postal_code,address:e.address}),u("update:latitude",e.latitude),u("update:longitude",e.longitude),u("update:locality",e.locality),u("update:city",e.city),u("update:state",e.state),u("update:postalCode",e.postal_code)},K=()=>P(this,null,function*(){var t,o;if(!(((t=a.latitude)!=null?t:a.initialLatitude)&&((o=a.longitude)!=null?o:a.initialLongitude)))try{c.value=!0,f.value="Detecting your city...";const s=yield(yield fetch("https://ipapi.co/json/")).json();s.latitude&&s.longitude?(n.setView([s.latitude,s.longitude],12),e.city=s.city||"",e.state=s.region||"",c.value=!1,V()):(c.value=!1,V())}catch(d){console.error("IP geolocation failed:",d),c.value=!1,V()}}),V=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(i=>{const{latitude:t,longitude:o}=i.coords;n.setView([t,o],16),y(t,o),k(t,o)},i=>{},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})};return C(()=>[a.latitude,a.longitude],([i,t])=>{i&&t&&n&&(n.setView([i,t],15),y(i,t),e.latitude=i,e.longitude=t)},{immediate:!1}),C(()=>[a.initialLatitude,a.initialLongitude],([i,t])=>{i&&t&&n&&!a.latitude&&!a.longitude&&(n.setView([i,t],15),y(i,t),e.latitude=i,e.longitude=t)},{immediate:!1}),C(()=>[a.city,a.state,a.locality,a.postalCode],([i,t,o,d])=>{i!=null&&(e.city=i||""),t!=null&&(e.state=t||""),o!=null&&(e.locality=o||""),d!=null&&(e.postal_code=d||"")},{immediate:!0}),C(()=>[a.initialCity,a.initialState,a.initialLocality,a.initialPostalCode],([i,t,o,d])=>{!a.city&&i&&(e.city=i),!a.state&&t&&(e.state=t),!a.locality&&o&&(e.locality=o),!a.postalCode&&d&&(e.postal_code=d)},{immediate:!0}),(i,t)=>(x(),v("div",X,[l("div",tt,[l("div",{ref_key:"mapContainer",ref:g,class:"h-64 rounded-lg border border-gray-300 z-0"},null,512),c.value?(x(),v("div",et,[l("div",at,[t[4]||(t[4]=l("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),l("span",null,H(f.value),1)])])):O("",!0)]),l("button",{type:"button",onClick:q,disabled:r.value,class:"mt-3 w-full flex items-center justify-center gap-2 px-4 py-2 bg-primary-50 hover:bg-primary-100 text-primary-700 rounded-lg transition"},[r.value?(x(),v("svg",lt,[...t[6]||(t[6]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(x(),v("svg",ot,[...t[5]||(t[5]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},null,-1),l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)])])),Q(" "+H(r.value?"Getting location...":"Use My Current Location"),1)],8,it),t[12]||(t[12]=l("p",{class:"text-xs text-gray-500 mt-2 text-center"}," Click on the map to pin your location, or use GPS ",-1)),R.value?(x(),v("div",nt,[l("div",st,[l("div",null,[t[7]||(t[7]=l("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"Locality / Area",-1)),L(l("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>e.locality=o),type:"text",class:"input text-sm",placeholder:"e.g., Koramangala",onInput:m},null,544),[[w,e.locality]])]),l("div",null,[t[8]||(t[8]=l("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"City *",-1)),L(l("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>e.city=o),type:"text",required:"",class:"input text-sm",placeholder:"e.g., Bangalore",onInput:m},null,544),[[w,e.city]])])]),l("div",dt,[l("div",null,[t[9]||(t[9]=l("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"State",-1)),L(l("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>e.state=o),type:"text",class:"input text-sm",placeholder:"e.g., Karnataka",onInput:m},null,544),[[w,e.state]])]),l("div",null,[t[10]||(t[10]=l("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"PIN Code",-1)),L(l("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>e.postal_code=o),type:"text",class:"input text-sm",placeholder:"e.g., 560034",maxlength:"6",onInput:m},null,544),[[w,e.postal_code]])])]),t[11]||(t[11]=l("p",{class:"text-xs text-gray-400"}," You can edit the auto-filled details if needed ",-1))])):O("",!0)]))}};export{pt as _};
