import{c as o,o as a,a as e,_ as ee,C as W,r as g,f as i,g as c,j as v,l as te,t as r,F as D,h as L,p as N,y as V,A as E,i as m,O as se,m as C,B as Z,P as B,u as le,b as ae,d as T,D as oe,L as ie,e as re,E as ne,I as de,Q as ue,w as U,s as ce}from"./main-CknUce79.js";import{u as ve}from"./listings-CgWYCP4i.js";import{_ as me}from"./ListingCard-GtQ-3FT5.js";import{_ as ge}from"./LoadingSpinner-BuPgSHnP.js";import{r as pe}from"./ChatBubbleLeftIcon-Bz5RJ3IN.js";import{R as fe}from"./ReportModal-8pIdzx-S.js";import{d as he}from"./dayjs.min-Bof1u0Bp.js";import{r as ye}from"./MapPinIcon-ChdyaEl2.js";import{r as _e}from"./ClockIcon-3Bc0aNlq.js";import{r as be}from"./EyeIcon-DvtNdtK_.js";import{r as xe}from"./StarIcon-Uc-XdrKD.js";import{r as we}from"./CheckBadgeIcon-D27YB0ES.js";import{r as Q}from"./PhoneIcon-dKhcauDc.js";import{r as ke}from"./FlagIcon-DoEaRKnN.js";import"./relativeTime-Ckc_g6N8.js";import"./SparklesIcon-u-5wr8vp.js";import"./BoltIcon-6C9roxJf.js";function $e(f,$){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function Ce(f,$){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}const Me={class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Se={class:"relative bg-white rounded-xl w-full max-w-md animate-slide-up"},je={class:"flex items-center justify-between p-4 border-b"},Ie={key:0,class:"p-4 bg-gray-50 border-b"},Ve={class:"flex gap-3"},Be=["src","alt"],De={class:"flex-1 min-w-0"},Le={class:"font-medium text-gray-900 truncate"},Ne={class:"text-lg font-bold text-primary-600"},Ae={class:"p-4 border-b"},Ye={class:"flex flex-wrap gap-2"},Fe=["onClick"],Re={class:"p-4"},Pe={class:"mt-3"},ze={class:"flex items-center gap-2 text-sm"},Oe={key:0,class:"mt-2 flex items-center gap-2"},Ee=["max"],Te={class:"flex gap-3 p-4 border-t bg-gray-50 rounded-b-xl"},Ue=["disabled"],Qe={__name:"ChatModal",props:{listing:{type:Object,required:!0},sellerId:{type:[Number,String],required:!0}},emits:["close","sent"],setup(f,{emit:$}){const w=f,y=$,M=W(),p=g(""),t=g(!1),_=g(null),d=g(!1),S=["Is this still available?","Can you share more photos?","What is the condition?","Is the price negotiable?","Can I see it today?"],j=async()=>{var h;if(p.value.trim()){d.value=!0;try{const l={listing_id:w.listing.id,receiver_id:w.sellerId,message:p.value.trim()};t.value&&_.value&&(l.offer_amount=_.value);const k=await Z.post("/conversations",l);B.success("Message sent!"),y("sent",k.data.data),y("close"),M.push(`/dashboard/messages/${k.data.data.id}`)}catch(l){((h=l.response)==null?void 0:h.status)===409?(B.info("You already have a conversation about this listing"),M.push(`/dashboard/messages/${l.response.data.conversation_id}`),y("close")):B.error("Failed to send message")}finally{d.value=!1}}};return(h,l)=>{var k;return a(),o("div",Me,[e("div",{class:"absolute inset-0 bg-black/50",onClick:l[0]||(l[0]=n=>h.$emit("close"))}),e("div",Se,[e("div",je,[l[6]||(l[6]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Contact Seller",-1)),e("button",{onClick:l[1]||(l[1]=n=>h.$emit("close")),class:"p-1 hover:bg-gray-100 rounded"},[c(v(te),{class:"w-5 h-5 text-gray-500"})])]),f.listing?(a(),o("div",Ie,[e("div",Ve,[e("img",{src:f.listing.primary_image_url,alt:f.listing.title,class:"w-16 h-16 rounded-lg object-cover"},null,8,Be),e("div",De,[e("h4",Le,r(f.listing.title),1),e("p",Ne,r(f.listing.formatted_price),1)])])])):i("",!0),e("div",Ae,[l[7]||(l[7]=e("p",{class:"text-sm text-gray-500 mb-3"},"Quick messages:",-1)),e("div",Ye,[(a(),o(D,null,L(S,n=>e("button",{key:n,onClick:A=>p.value=n,class:N(["px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition",p.value===n?"bg-primary-100 text-primary-700":""])},r(n),11,Fe)),64))])]),e("div",Re,[V(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=n=>p.value=n),rows:"3",class:"input resize-none",placeholder:"Write your message..."},null,512),[[E,p.value]]),e("div",Pe,[e("label",ze,[V(e("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=n=>t.value=n),class:"rounded text-primary-600"},null,512),[[se,t.value]]),l[8]||(l[8]=m(" Include an offer ",-1))]),t.value?(a(),o("div",Oe,[l[9]||(l[9]=e("span",{class:"text-gray-500"},"â‚¹",-1)),V(e("input",{"onUpdate:modelValue":l[4]||(l[4]=n=>_.value=n),type:"number",class:"input flex-1",placeholder:"Your offer amount",max:(k=f.listing)==null?void 0:k.price},null,8,Ee),[[E,_.value,void 0,{number:!0}]])])):i("",!0)])]),e("div",Te,[e("button",{onClick:l[5]||(l[5]=n=>h.$emit("close")),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:j,disabled:!p.value.trim()||d.value,class:"btn-primary flex-1"},[d.value?(a(),C(ge,{key:1,class:"w-5 h-5 mr-2"})):(a(),C(v(pe),{key:0,class:"w-5 h-5 mr-2"})),m(" "+r(d.value?"Sending...":"Send Message"),1)],8,Ue)])])])}}},We=ee(Qe,[["__scopeId","data-v-47bd1303"]]),Ze={class:"min-h-screen bg-gray-50 py-6"},qe={class:"container-app"},Ge={key:0,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},He={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Je={class:"lg:col-span-2 space-y-6"},Ke={class:"card overflow-hidden"},Xe={class:"relative aspect-[4/3] bg-gray-100"},et=["src","alt"],tt={key:0,class:"flex gap-2 p-4 overflow-x-auto"},st=["onClick"],lt=["src"],at={class:"card p-6"},ot={class:"flex items-start justify-between mb-4"},it={class:"text-2xl font-bold text-primary-600"},rt={class:"text-xl font-semibold text-gray-900 mt-1"},nt={class:"flex items-center gap-2"},dt={class:"flex flex-wrap gap-4 text-sm text-gray-500 mb-6"},ut={class:"flex items-center"},ct={class:"flex items-center"},vt={class:"flex items-center"},mt={class:"border-t pt-6"},gt={class:"text-gray-600 whitespace-pre-line"},pt={key:0,class:"border-t pt-6 mt-6"},ft={class:"grid grid-cols-2 gap-4"},ht={key:0},yt={class:"ml-2 font-medium capitalize"},_t={key:1},bt={class:"ml-2 font-medium"},xt={key:2},wt={class:"ml-2 font-medium"},kt={key:3},$t={class:"ml-2 font-medium"},Ct={class:"space-y-6"},Mt={class:"card p-6"},St={class:"flex items-center gap-4 mb-4"},jt=["src","alt"],It={class:"flex items-center text-sm text-gray-500"},Vt={class:"text-sm text-gray-500"},Bt={key:0,class:"flex items-center text-green-600 text-sm mb-4"},Dt={class:"space-y-3"},Lt=["href"],Nt={key:2,class:"mt-12"},At={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},es={__name:"ListingDetail",setup(f){const $=le(),w=W(),y=ae(),M=ve(),p=g(!0),t=g(null),_=g([]),d=g(0),S=g(!1),j=g(!1),h=g(!1),l=g(!1),k=T(()=>{var u,s,b,I;return(s=(u=t.value)==null?void 0:u.images)!=null&&s.length?(I=t.value.images[d.value])==null?void 0:I.url:(b=t.value)==null?void 0:b.primary_image_url}),n=T(()=>{var u,s,b;return((u=y.user)==null?void 0:u.id)===((b=(s=t.value)==null?void 0:s.user)==null?void 0:b.id)}),A=u=>he(u).format("MMM D, YYYY"),q=()=>{d.value>0?d.value--:d.value=t.value.images.length-1},G=()=>{d.value<t.value.images.length-1?d.value++:d.value=0},H=async()=>{if(!y.isAuthenticated){w.push("/login");return}const u=await M.toggleFavorite(t.value.id);S.value=u.is_favorited},J=()=>{if(!y.isAuthenticated){w.push("/login");return}j.value=!0},K=()=>{navigator.share&&navigator.share({title:t.value.title,text:`Check out this listing: ${t.value.title}`,url:window.location.href})},X=async()=>{if(!y.isAuthenticated){w.push("/login");return}try{await Z.post(`/listings/${t.value.id}/track-contact`,{type:"phone"})}catch{}l.value=!0},Y=async()=>{var u;try{const s=await M.fetchListing($.params.slug);t.value=s.listing,_.value=s.similar,S.value=s.listing.is_favorited}catch(s){((u=s.response)==null?void 0:u.status)===404&&w.push("/404")}finally{p.value=!1}};return oe(()=>{Y()}),ie(()=>$.params.slug,(u,s)=>{u!==s&&(p.value=!0,d.value=0,l.value=!1,Y())}),(u,s)=>{var I,F,R,P,z;const b=re("router-link");return a(),o("div",Ze,[e("div",qe,[p.value?(a(),o("div",Ge,[...s[3]||(s[3]=[ne('<div class="lg:col-span-2"><div class="card p-4"><div class="skeleton h-96 mb-4"></div><div class="skeleton h-8 w-1/3 mb-2"></div><div class="skeleton h-6 w-full mb-4"></div><div class="skeleton h-24 w-full"></div></div></div><div class="card p-4"><div class="skeleton h-16 w-full mb-4"></div><div class="skeleton h-12 w-full mb-2"></div><div class="skeleton h-12 w-full"></div></div>',2)])])):t.value?(a(),o("div",He,[e("div",Je,[e("div",Ke,[e("div",Xe,[e("img",{src:k.value,alt:t.value.title,class:"w-full h-full object-contain"},null,8,et),((I=t.value.images)==null?void 0:I.length)>1?(a(),o("button",{key:0,onClick:q,class:"absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center hover:bg-white"},[c(v($e),{class:"w-6 h-6"})])):i("",!0),((F=t.value.images)==null?void 0:F.length)>1?(a(),o("button",{key:1,onClick:G,class:"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center hover:bg-white"},[c(v(de),{class:"w-6 h-6"})])):i("",!0)]),((R=t.value.images)==null?void 0:R.length)>1?(a(),o("div",tt,[(a(!0),o(D,null,L(t.value.images,(x,O)=>(a(),o("button",{key:x.id,onClick:Yt=>d.value=O,class:N(["w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden border-2",d.value===O?"border-primary-500":"border-transparent"])},[e("img",{src:x.thumbnail_url,class:"w-full h-full object-cover"},null,8,lt)],10,st))),128))])):i("",!0)]),e("div",at,[e("div",ot,[e("div",null,[e("p",it,r(t.value.formatted_price),1),e("h1",rt,r(t.value.title),1)]),e("div",nt,[e("button",{onClick:H,class:"p-2 rounded-full hover:bg-gray-100"},[c(v(ue),{class:N(["w-6 h-6",S.value?"text-red-500 fill-current":"text-gray-400"])},null,8,["class"])]),e("button",{onClick:K,class:"p-2 rounded-full hover:bg-gray-100"},[c(v(Ce),{class:"w-6 h-6 text-gray-400"})])])]),e("div",dt,[e("span",ut,[c(v(ye),{class:"w-4 h-4 mr-1"}),m(" "+r(t.value.location),1)]),e("span",ct,[c(v(_e),{class:"w-4 h-4 mr-1"}),m(" "+r(A(t.value.published_at)),1)]),e("span",vt,[c(v(be),{class:"w-4 h-4 mr-1"}),m(" "+r(t.value.views_count)+" views ",1)])]),e("div",mt,[s[4]||(s[4]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Description",-1)),e("p",gt,r(t.value.description),1)]),t.value.attributes?(a(),o("div",pt,[s[9]||(s[9]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Details",-1)),e("div",ft,[t.value.condition?(a(),o("div",ht,[s[5]||(s[5]=e("span",{class:"text-gray-500"},"Condition:",-1)),e("span",yt,r(t.value.condition.replace("_"," ")),1)])):i("",!0),t.value.brand?(a(),o("div",_t,[s[6]||(s[6]=e("span",{class:"text-gray-500"},"Brand:",-1)),e("span",bt,r(t.value.brand),1)])):i("",!0),t.value.model?(a(),o("div",xt,[s[7]||(s[7]=e("span",{class:"text-gray-500"},"Model:",-1)),e("span",wt,r(t.value.model),1)])):i("",!0),t.value.year?(a(),o("div",kt,[s[8]||(s[8]=e("span",{class:"text-gray-500"},"Year:",-1)),e("span",$t,r(t.value.year),1)])):i("",!0)])])):i("",!0)])]),e("div",Ct,[e("div",Mt,[e("div",St,[e("img",{src:t.value.user.avatar_url,alt:t.value.user.name,class:"w-14 h-14 rounded-full object-cover"},null,8,jt),e("div",null,[c(b,{to:`/user/${t.value.user.id}`,class:"font-semibold text-gray-900 hover:text-primary-600"},{default:U(()=>[m(r(t.value.user.name),1)]),_:1},8,["to"]),e("div",It,[c(v(xe),{class:"w-4 h-4 text-yellow-400 mr-1"}),m(" "+r(t.value.user.rating||"0.0")+" ("+r(t.value.user.total_reviews)+" reviews) ",1)]),e("p",Vt,r(t.value.user.city),1)])]),t.value.user.is_verified_seller?(a(),o("div",Bt,[c(v(we),{class:"w-5 h-5 mr-1"}),s[10]||(s[10]=m(" Verified Seller ",-1))])):i("",!0),e("div",Dt,[n.value?i("",!0):(a(),o("button",{key:0,onClick:J,class:"btn-primary w-full"},[c(v(ce),{class:"w-5 h-5 mr-2"}),s[11]||(s[11]=m(" Chat with Seller ",-1))])),t.value.user.phone&&!n.value&&!l.value?(a(),o("button",{key:1,onClick:X,class:"btn-outline w-full"},[c(v(Q),{class:"w-5 h-5 mr-2"}),s[12]||(s[12]=m(" Show Phone Number ",-1))])):i("",!0),t.value.user.phone&&!n.value&&l.value?(a(),o("a",{key:2,href:`tel:${t.value.user.phone}`,class:"btn-outline w-full text-green-600 border-green-600"},[c(v(Q),{class:"w-5 h-5 mr-2"}),m(" "+r(t.value.user.phone),1)],8,Lt)):i("",!0),n.value?(a(),C(b,{key:3,to:`/listing/${t.value.id}/edit`,class:"btn-primary w-full"},{default:U(()=>[...s[13]||(s[13]=[m(" Edit Listing ",-1)])]),_:1},8,["to"])):i("",!0)])]),s[15]||(s[15]=e("div",{class:"card p-6 bg-yellow-50 border-yellow-200"},[e("h3",{class:"font-semibold text-yellow-800 mb-2"},"Safety Tips"),e("ul",{class:"text-sm text-yellow-700 space-y-1"},[e("li",null,"Meet in a safe public place"),e("li",null,"Check the item before you pay"),e("li",null,"Pay only after collecting the item"),e("li",null,"Never share financial information")])],-1)),e("button",{onClick:s[0]||(s[0]=x=>h.value=!0),class:"text-sm text-gray-500 hover:text-red-600 flex items-center"},[c(v(ke),{class:"w-4 h-4 mr-1"}),s[14]||(s[14]=m(" Report this ad ",-1))])])])):i("",!0),(P=_.value)!=null&&P.length?(a(),o("div",Nt,[s[16]||(s[16]=e("h2",{class:"text-xl font-bold text-gray-900 mb-6"},"Similar Ads",-1)),e("div",At,[(a(!0),o(D,null,L(_.value,x=>(a(),C(me,{key:x.id,listing:x},null,8,["listing"]))),128))])])):i("",!0)]),j.value?(a(),C(We,{key:0,listing:t.value,onClose:s[1]||(s[1]=x=>j.value=!1)},null,8,["listing"])):i("",!0),h.value?(a(),C(fe,{key:1,type:"listing",id:(z=t.value)==null?void 0:z.id,onClose:s[2]||(s[2]=x=>h.value=!1)},null,8,["id"])):i("",!0)])}}};export{es as default};
