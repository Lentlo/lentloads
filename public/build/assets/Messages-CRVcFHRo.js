import{J as P,r as d,c as w,o as T,b as U,d as r,e as l,f as e,h as c,F as M,m as N,i as j,j as q,L as A,n as B,p as C,t as o,q as E,g as I}from"./main-CrvqE6re.js";import{d as L}from"./dayjs.min-Bof1u0Bp.js";import{r as J}from"./relativeTime-Ckc_g6N8.js";const O={class:"min-h-screen bg-gray-50 py-6"},R={class:"container-app"},Y={key:0,class:"space-y-4"},$={key:1,class:"space-y-2"},z=["src","alt"],G={class:"flex-1 min-w-0"},H={class:"flex items-center justify-between mb-1"},K={class:"font-semibold text-gray-900 truncate"},Q={class:"text-xs text-gray-500"},W={class:"text-sm text-gray-500 truncate mb-1"},X={class:"text-sm text-gray-600 truncate"},Z={key:0},ee={key:0,class:"flex items-center"},te={class:"w-6 h-6 bg-primary-600 text-white text-xs rounded-full flex items-center justify-center"},se=["src"],ae={key:2,class:"card p-12 text-center"},le={key:3,class:"mt-6 text-center"},re=["disabled"],ce={__name:"Messages",setup(oe){L.extend(J);const S=P(),u=d(!0),i=d(!1),n=d([]),m=d(1),g=d(1),y=w(()=>{var a;return(a=S.user)==null?void 0:a.id}),V=w(()=>m.value<g.value),_=a=>a.buyer_id===y.value?a.seller:a.buyer,D=a=>a?L(a).fromNow():"",f=async(a=!1)=>{a?i.value=!0:u.value=!0;try{const t=await E.get("/conversations",{params:{page:a?m.value+1:1}});a?n.value=[...n.value,...t.data.data]:n.value=t.data.data,m.value=t.data.meta.current_page,g.value=t.data.meta.last_page}finally{u.value=!1,i.value=!1}},F=()=>{f(!0)};return T(()=>{f()}),(a,t)=>{const p=U("router-link");return l(),r("div",O,[e("div",R,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Messages",-1)),u.value?(l(),r("div",Y,[(l(),r(M,null,N(5,s=>e("div",{key:s,class:"card p-4 flex gap-4"},[...t[0]||(t[0]=[e("div",{class:"skeleton w-12 h-12 rounded-full"},null,-1),e("div",{class:"flex-1"},[e("div",{class:"skeleton h-4 w-1/3 mb-2"}),e("div",{class:"skeleton h-3 w-2/3"})],-1)])])),64))])):n.value.length?(l(),r("div",$,[(l(!0),r(M,null,N(n.value,s=>(l(),I(p,{key:s.id,to:`/messages/${s.uuid}`,class:"card p-4 flex gap-4 hover:shadow-md transition"},{default:B(()=>{var h,x,v,b,k;return[e("img",{src:_(s).avatar_url,alt:_(s).name,class:"w-12 h-12 rounded-full object-cover"},null,8,z),e("div",G,[e("div",H,[e("h3",K,o(_(s).name),1),e("span",Q,o(D((h=s.latest_message)==null?void 0:h.created_at)),1)]),e("p",W," Re: "+o((x=s.listing)==null?void 0:x.title),1),e("p",X,[((v=s.latest_message)==null?void 0:v.sender_id)===y.value?(l(),r("span",Z,"You: ")):c("",!0),C(" "+o(((b=s.latest_message)==null?void 0:b.body)||"No messages yet"),1)])]),s.unread_count>0?(l(),r("div",ee,[e("span",te,o(s.unread_count),1)])):c("",!0),(k=s.listing)!=null&&k.primary_image?(l(),r("img",{key:1,src:s.listing.primary_image.thumbnail_url,class:"w-16 h-16 rounded-lg object-cover hidden sm:block"},null,8,se)):c("",!0)]}),_:2},1032,["to"]))),128))])):(l(),r("div",ae,[j(q(A),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t[2]||(t[2]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No messages yet",-1)),t[3]||(t[3]=e("p",{class:"text-gray-500 mb-4"},"Start a conversation by contacting a seller",-1)),j(p,{to:"/search",class:"btn-primary"},{default:B(()=>[...t[1]||(t[1]=[C(" Browse Listings ",-1)])]),_:1})])),V.value?(l(),r("div",le,[e("button",{onClick:F,disabled:i.value,class:"btn-secondary"},o(i.value?"Loading...":"Load More"),9,re)])):c("",!0)])])}}};export{ce as default};
