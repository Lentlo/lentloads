import{b as G,r as v,e as K,c as r,f as A,o as n,a as e,g as c,j as g,l as J,S as U,y,A as k,i as b,t as w,T as I,m as S,w as j,B as O,C as X,x as Z,K as ee,d as R,D as te,M as N,F as E,h as F,E as se,Q as Y}from"./main-CBkiVDVn.js";import{u as le}from"./listings-DXm6iC6h.js";import{_ as oe}from"./LocationPicker-BZ0q3gf9.js";import{r as z}from"./PhoneIcon-PWX0qcAt.js";import{r as H}from"./UserIcon-rnTvXbK3.js";import{r as W}from"./EyeIcon-D2ejAOyL.js";import{r as Q}from"./EyeSlashIcon-DfMqNIlQ.js";import{r as ae}from"./CameraIcon-CMxKqKox.js";import"./leaflet-Bln94WRs.js";import"./_commonjsHelpers-Cpj98o6Y.js";const ne={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},ie={class:"relative bg-white rounded-xl shadow-xl w-full max-w-md p-6 z-10"},re={key:0},de={class:"text-center mb-6"},ue={class:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4"},pe={class:"mb-4"},me={class:"flex"},ce=["disabled"],ve=["disabled"],ye={key:0,class:"flex items-center justify-center gap-2"},ge={key:1},be={key:1},xe={class:"text-center mb-6"},fe={class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},he={class:"text-xl font-bold text-gray-900"},we={class:"mb-4"},ke={class:"flex items-center justify-between text-sm mb-1"},$e={class:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg text-gray-700"},Ce={class:"mb-4"},_e={class:"relative"},Pe=["type","disabled"],Ae={key:0,class:"text-red-500 text-sm mb-4"},Ve=["disabled"],Se={key:0,class:"flex items-center justify-center gap-2"},Ue={key:1},je={class:"text-center"},Le={key:2},Me={class:"text-center mb-6"},qe={class:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4"},Be={class:"mb-4"},Ne={class:"flex items-center justify-between text-sm mb-1"},Ee={class:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg text-gray-700"},Fe={class:"mb-4"},ze=["disabled"],De={class:"mb-4"},Te=["disabled"],Ie={class:"mb-4"},Oe={class:"relative"},Re=["type","disabled"],Ye={key:0,class:"text-red-500 text-sm mb-4"},He=["disabled"],We={key:0,class:"flex items-center justify-center gap-2"},Qe={key:1},Ge={class:"text-xs text-gray-500 text-center"},Ke={__name:"AuthPromptModal",props:{isOpen:{type:Boolean,default:!1}},emits:["close","authenticated"],setup(D,{emit:L}){const $=L,V=G(),f=v("phone"),i=v(!1),u=v(""),p=v(!1),m=v(""),l=v(""),P=v(""),C=v(""),x=v(""),M=async()=>{var d,t;if(m.value.length===10){i.value=!0,u.value="";try{const o=await O.post("/auth/check-phone",{phone:"+91"+m.value});o.data.data.exists?(l.value=o.data.data.name,f.value="login"):f.value="register"}catch(o){u.value=((t=(d=o.response)==null?void 0:d.data)==null?void 0:t.message)||"Something went wrong. Please try again."}finally{i.value=!1}}},q=async()=>{var d,t;i.value=!0,u.value="";try{await V.login({login:"+91"+m.value,password:x.value}),$("authenticated")}catch(o){u.value=((t=(d=o.response)==null?void 0:d.data)==null?void 0:t.message)||"Invalid password. Please try again."}finally{i.value=!1}},B=async()=>{var d,t;i.value=!0,u.value="";try{const o=await O.post("/auth/quick-register",{name:P.value,email:C.value,password:x.value,phone:"+91"+m.value});V.setAuth(o.data.data),$("authenticated")}catch(o){u.value=((t=(d=o.response)==null?void 0:d.data)==null?void 0:t.message)||"Registration failed. Please try again."}finally{i.value=!1}};return(d,t)=>{const o=K("router-link");return D.isOpen?(n(),r("div",ne,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[0]||(t[0]=s=>d.$emit("close"))}),e("div",ie,[e("button",{onClick:t[1]||(t[1]=s=>d.$emit("close")),class:"absolute top-4 right-4 text-gray-400 hover:text-gray-600"},[c(g(J),{class:"w-6 h-6"})]),f.value==="phone"?(n(),r("div",re,[e("div",de,[e("div",ue,[c(g(z),{class:"w-8 h-8 text-primary-600"})]),t[14]||(t[14]=e("h2",{class:"text-xl font-bold text-gray-900"},"Almost Done!",-1)),t[15]||(t[15]=e("p",{class:"text-gray-500 mt-1"},"Enter your phone number to continue",-1))]),e("form",{onSubmit:U(M,["prevent"])},[e("div",pe,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Phone Number",-1)),e("div",me,[t[16]||(t[16]=e("span",{class:"inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-lg text-gray-500"}," +91 ",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s),type:"tel",required:"",maxlength:"10",pattern:"[0-9]{10}",placeholder:"Enter 10 digit number",class:"input rounded-l-none flex-1",disabled:i.value},null,8,ce),[[k,m.value]])])]),e("button",{type:"submit",disabled:i.value||m.value.length!==10,class:"btn-primary w-full"},[i.value?(n(),r("span",ye,[...t[18]||(t[18]=[e("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),b(" Checking... ",-1)])])):(n(),r("span",ge,"Continue"))],8,ve)],32)])):f.value==="login"?(n(),r("div",be,[e("div",xe,[e("div",fe,[c(g(H),{class:"w-8 h-8 text-green-600"})]),e("h2",he,"Welcome Back"+w(l.value?`, ${l.value}`:"")+"!",1),t[19]||(t[19]=e("p",{class:"text-gray-500 mt-1"},"Enter your password to post your ad",-1))]),e("form",{onSubmit:U(q,["prevent"])},[e("div",we,[e("div",ke,[t[20]||(t[20]=e("label",{class:"font-medium text-gray-700"},"Phone",-1)),e("button",{type:"button",onClick:t[3]||(t[3]=s=>f.value="phone"),class:"text-primary-600 hover:underline"}," Change ")]),e("div",$e,[c(g(z),{class:"w-5 h-5 text-gray-400"}),b(" +91 "+w(m.value),1)])]),e("div",Ce,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Password",-1)),e("div",_e,[y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>x.value=s),type:p.value?"text":"password",required:"",placeholder:"Enter your password",class:"input pr-10",disabled:i.value},null,8,Pe),[[I,x.value]]),e("button",{type:"button",onClick:t[5]||(t[5]=s=>p.value=!p.value),class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"},[p.value?(n(),S(g(Q),{key:1,class:"w-5 h-5"})):(n(),S(g(W),{key:0,class:"w-5 h-5"}))])])]),u.value?(n(),r("p",Ae,w(u.value),1)):A("",!0),e("button",{type:"submit",disabled:i.value||!x.value,class:"btn-primary w-full mb-3"},[i.value?(n(),r("span",Se,[...t[22]||(t[22]=[e("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),b(" Logging in... ",-1)])])):(n(),r("span",Ue,"Login & Post Ad"))],8,Ve),e("div",je,[c(o,{to:"/forgot-password",class:"text-sm text-primary-600 hover:underline",onClick:t[6]||(t[6]=s=>d.$emit("close"))},{default:j(()=>[...t[23]||(t[23]=[b(" Forgot Password? ",-1)])]),_:1})])],32)])):f.value==="register"?(n(),r("div",Le,[e("div",Me,[e("div",qe,[c(g(H),{class:"w-8 h-8 text-primary-600"})]),t[24]||(t[24]=e("h2",{class:"text-xl font-bold text-gray-900"},"Create Account",-1)),t[25]||(t[25]=e("p",{class:"text-gray-500 mt-1"},"Quick signup to post your ad",-1))]),e("form",{onSubmit:U(B,["prevent"])},[e("div",Be,[e("div",Ne,[t[26]||(t[26]=e("label",{class:"font-medium text-gray-700"},"Phone",-1)),e("button",{type:"button",onClick:t[7]||(t[7]=s=>f.value="phone"),class:"text-primary-600 hover:underline"}," Change ")]),e("div",Ee,[c(g(z),{class:"w-5 h-5 text-gray-400"}),b(" +91 "+w(m.value),1)])]),e("div",Fe,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Your Name",-1)),y(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>P.value=s),type:"text",required:"",placeholder:"Enter your name",class:"input",disabled:i.value},null,8,ze),[[k,P.value]])]),e("div",De,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),y(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>C.value=s),type:"email",required:"",placeholder:"Enter your email",class:"input",disabled:i.value},null,8,Te),[[k,C.value]])]),e("div",Ie,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Create Password",-1)),e("div",Oe,[y(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>x.value=s),type:p.value?"text":"password",required:"",minlength:"8",placeholder:"Min 8 characters",class:"input pr-10",disabled:i.value},null,8,Re),[[I,x.value]]),e("button",{type:"button",onClick:t[11]||(t[11]=s=>p.value=!p.value),class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"},[p.value?(n(),S(g(Q),{key:1,class:"w-5 h-5"})):(n(),S(g(W),{key:0,class:"w-5 h-5"}))])])]),u.value?(n(),r("p",Ye,w(u.value),1)):A("",!0),e("button",{type:"submit",disabled:i.value||!P.value||!C.value||x.value.length<8,class:"btn-primary w-full mb-3"},[i.value?(n(),r("span",We,[...t[30]||(t[30]=[e("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),b(" Creating account... ",-1)])])):(n(),r("span",Qe,"Create Account & Post Ad"))],8,He),e("p",Ge,[t[33]||(t[33]=b(" By creating an account, you agree to our ",-1)),c(o,{to:"/pages/terms",class:"text-primary-600 hover:underline",onClick:t[12]||(t[12]=s=>d.$emit("close"))},{default:j(()=>[...t[31]||(t[31]=[b("Terms",-1)])]),_:1}),t[34]||(t[34]=b(" and ",-1)),c(o,{to:"/pages/privacy",class:"text-primary-600 hover:underline",onClick:t[13]||(t[13]=s=>d.$emit("close"))},{default:j(()=>[...t[32]||(t[32]=[b("Privacy Policy",-1)])]),_:1})])],32)])):A("",!0)])])):A("",!0)}}},Je={class:"min-h-screen bg-gray-50 py-6"},Xe={class:"container-app max-w-3xl"},Ze={class:"card p-6"},et=["label"],tt=["value"],st={class:"text-sm text-gray-500 mt-1"},lt={class:"text-sm text-gray-500 mt-1"},ot={class:"grid grid-cols-2 gap-4"},at={class:"relative"},nt={class:"grid grid-cols-2 gap-4"},it={class:"grid grid-cols-4 gap-4"},rt=["src"],dt=["onClick"],ut={key:0,class:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-primary-500 hover:bg-primary-50"},pt={class:"border-t pt-6"},mt={class:"border-t pt-6 flex justify-end gap-4"},ct=["disabled"],Ct={__name:"CreateListing",setup(D){const L=X(),$=Z(),V=G(),f=le(),i=v(!1),u=v(!1),p=v([]),m=v([]),l=ee({category_id:"",title:"",description:"",price:"",price_type:"fixed",condition:"",brand:"",model:"",city:"",state:"",locality:"",postal_code:"",latitude:null,longitude:null}),P=R(()=>$.categories),C=R(()=>l.category_id&&l.title&&l.description&&l.price!==""&&l.city&&p.value.length>0),x=o=>{const s=Array.from(o.target.files),_=10-p.value.length;s.slice(0,_).forEach(a=>{if(a.type.startsWith("image/")){p.value.push(a);const h=new FileReader;h.onload=T=>{m.value.push(T.target.result)},h.readAsDataURL(a)}})},M=o=>{p.value.splice(o,1),m.value.splice(o,1)},q=o=>{l.city=o.city,l.state=o.state,l.locality=o.locality,l.postal_code=o.postal_code,l.latitude=o.latitude,l.longitude=o.longitude},B=async()=>{if(C.value){if(!V.isAuthenticated){u.value=!0;return}await d()}},d=async()=>{var o,s;i.value=!0;try{const _={...l,images:p.value};await f.createListing(_),Y.success("Your ad has been submitted for review!"),L.push("/my-listings")}catch(_){Y.error(((s=(o=_.response)==null?void 0:o.data)==null?void 0:s.message)||"Failed to create listing")}finally{i.value=!1}},t=async()=>{u.value=!1,await d()};return te(()=>{$.currentLocation&&(l.city=$.currentLocation.city,l.state=$.currentLocation.state)}),(o,s)=>{const _=K("router-link");return n(),r("div",Je,[e("div",Xe,[e("div",Ze,[s[26]||(s[26]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Post Your Ad",-1)),c(Ke,{"is-open":u.value,onClose:s[0]||(s[0]=a=>u.value=!1),onAuthenticated:t},null,8,["is-open"]),e("form",{onSubmit:U(B,["prevent"]),class:"space-y-6"},[e("div",null,[s[10]||(s[10]=e("label",{class:"label"},"Category *",-1)),y(e("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>l.category_id=a),required:"",class:"input"},[s[9]||(s[9]=e("option",{value:""},"Select a category",-1)),(n(!0),r(E,null,F(P.value,a=>(n(),r("optgroup",{key:a.id,label:a.name},[(n(!0),r(E,null,F(a.children,h=>(n(),r("option",{key:h.id,value:h.id},w(h.name),9,tt))),128))],8,et))),128))],512),[[N,l.category_id]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"label"},"Title *",-1)),y(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>l.title=a),type:"text",maxlength:"100",required:"",class:"input",placeholder:"What are you selling?"},null,512),[[k,l.title]]),e("p",st,w(l.title.length)+"/100",1)]),e("div",null,[s[12]||(s[12]=e("label",{class:"label"},"Description *",-1)),y(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=a=>l.description=a),rows:"5",maxlength:"5000",required:"",class:"input",placeholder:"Describe your item in detail..."},null,512),[[k,l.description]]),e("p",lt,w(l.description.length)+"/5000",1)]),e("div",ot,[e("div",null,[s[14]||(s[14]=e("label",{class:"label"},"Price *",-1)),e("div",at,[s[13]||(s[13]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},"â‚¹",-1)),y(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>l.price=a),type:"number",min:"0",required:"",class:"input pl-8",placeholder:"0"},null,512),[[k,l.price]])])]),e("div",null,[s[16]||(s[16]=e("label",{class:"label"},"Price Type",-1)),y(e("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>l.price_type=a),class:"input"},[...s[15]||(s[15]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"negotiable"},"Negotiable",-1),e("option",{value:"free"},"Free",-1),e("option",{value:"contact"},"Contact for Price",-1)])],512),[[N,l.price_type]])])]),e("div",null,[s[18]||(s[18]=e("label",{class:"label"},"Condition",-1)),y(e("select",{"onUpdate:modelValue":s[6]||(s[6]=a=>l.condition=a),class:"input"},[...s[17]||(s[17]=[se('<option value="">Select condition</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[N,l.condition]])]),e("div",nt,[e("div",null,[s[19]||(s[19]=e("label",{class:"label"},"Brand (Optional)",-1)),y(e("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>l.brand=a),type:"text",class:"input",placeholder:"e.g., Apple"},null,512),[[k,l.brand]])]),e("div",null,[s[20]||(s[20]=e("label",{class:"label"},"Model (Optional)",-1)),y(e("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>l.model=a),type:"text",class:"input",placeholder:"e.g., iPhone 15"},null,512),[[k,l.model]])])]),e("div",null,[s[22]||(s[22]=e("label",{class:"label"},"Photos * (Max 10)",-1)),e("div",it,[(n(!0),r(E,null,F(m.value,(a,h)=>(n(),r("div",{key:h,class:"relative aspect-square bg-gray-100 rounded-lg overflow-hidden"},[e("img",{src:a,class:"w-full h-full object-cover"},null,8,rt),e("button",{type:"button",onClick:T=>M(h),class:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center"},[c(g(J),{class:"w-4 h-4"})],8,dt)]))),128)),m.value.length<10?(n(),r("label",ut,[c(g(ae),{class:"w-8 h-8 text-gray-400 mb-1"}),s[21]||(s[21]=e("span",{class:"text-sm text-gray-500"},"Add Photo",-1)),e("input",{type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:x},null,32)])):A("",!0)]),s[23]||(s[23]=e("p",{class:"text-sm text-gray-500 mt-2"},"First image will be the cover photo",-1))]),e("div",pt,[s[24]||(s[24]=e("h3",{class:"font-semibold text-gray-900 mb-4"},"Your Location",-1)),c(oe,{"initial-city":l.city,"initial-state":l.state,"onUpdate:location":q},null,8,["initial-city","initial-state"])]),e("div",mt,[c(_,{to:"/my-listings",class:"btn-secondary"},{default:j(()=>[...s[25]||(s[25]=[b(" Cancel ",-1)])]),_:1}),e("button",{type:"submit",disabled:i.value||!C.value,class:"btn-primary"},w(i.value?"Posting...":"Post Ad"),9,ct)])],32)])])])}}};export{Ct as default};
