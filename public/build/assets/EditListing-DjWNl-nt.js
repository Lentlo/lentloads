import{u as I,D as M,x as j,r as b,L as B,d as D,E,e as T,c as o,o as a,a as e,U as A,z as d,N as f,F as x,h as w,B as g,t as k,G,f as R,g as m,j as V,w as z,i as O,C as h,O as n,l as Y}from"./main-BzJjJd1N.js";import{u as H}from"./listings-9KKi7_O2.js";import{_ as J}from"./LocationPicker-BzqYezXb.js";import{r as K}from"./CameraIcon-CJKV3aVl.js";import"./leaflet-Nt-bLEg5.js";const Q={class:"min-h-screen bg-gray-50 py-6"},W={class:"container-app max-w-3xl"},X={class:"card p-6"},Z={key:0,class:"space-y-4"},tt=["label"],et=["value"],lt={class:"text-sm text-gray-500 mt-1"},it={class:"grid grid-cols-2 gap-4"},st={class:"relative"},ot={class:"grid grid-cols-2 gap-4"},at={class:"grid grid-cols-4 gap-4"},nt=["src"],rt=["onClick"],dt=["onClick"],ut={key:1,class:"absolute bottom-1 left-1 text-xs bg-primary-500 text-white px-2 py-1 rounded"},pt={key:0,class:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-primary-500"},ct={class:"border-t pt-6"},gt={class:"border-t pt-6 flex justify-end gap-4"},yt=["disabled"],kt={__name:"EditListing",setup(mt){const u=I(),_=M(),L=j(),v=H(),C=b(!0),y=b(!1),r=b([]),l=B({category_id:"",title:"",description:"",price:"",price_type:"fixed",condition:"",brand:"",model:"",city:"",state:"",locality:"",postal_code:"",latitude:null,longitude:null}),U=D(()=>L.categories),S=async()=>{try{const t=(await h.get(`/listings/${u.params.id}`)).data.data.listing;l.category_id=t.category_id,l.title=t.title,l.description=t.description,l.price=t.price,l.price_type=t.price_type,l.condition=t.condition||"",l.brand=t.brand||"",l.model=t.model||"",l.city=t.city,l.state=t.state||"",l.locality=t.locality||"",l.postal_code=t.postal_code||"",l.latitude=t.latitude||null,l.longitude=t.longitude||null,r.value=t.images||[]}catch{n.error("Failed to load listing"),_.push("/my-listings")}finally{C.value=!1}},F=async s=>{const t=Array.from(s.target.files),p=10-r.value.length;if(t.length>p){n.error(`You can only add ${p} more images`);return}try{await v.addImages(u.params.id,t.slice(0,p)),n.success("Images added"),S()}catch{n.error("Failed to upload images")}},N=async s=>{if(r.value.length<=1){n.error("Listing must have at least one image");return}try{await v.deleteImage(u.params.id,s),r.value=r.value.filter(t=>t.id!==s),n.success("Image deleted")}catch{n.error("Failed to delete image")}},P=async s=>{try{await h.put(`/listings/${u.params.id}/images/${s}/primary`),r.value=r.value.map(t=>({...t,is_primary:t.id===s})),n.success("Primary image updated")}catch{n.error("Failed to update primary image")}},$=s=>{l.city=s.city,l.state=s.state,l.locality=s.locality,l.postal_code=s.postal_code,l.latitude=s.latitude,l.longitude=s.longitude},q=async()=>{y.value=!0;try{await v.updateListing(u.params.id,l),n.success("Listing updated successfully"),_.push("/my-listings")}catch{n.error("Failed to update listing")}finally{y.value=!1}};return E(()=>{S()}),(s,t)=>{const p=T("router-link");return a(),o("div",Q,[e("div",W,[e("div",X,[t[25]||(t[25]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Edit Listing",-1)),C.value?(a(),o("div",Z,[...t[8]||(t[8]=[e("div",{class:"skeleton h-10 w-full"},null,-1),e("div",{class:"skeleton h-10 w-full"},null,-1),e("div",{class:"skeleton h-32 w-full"},null,-1)])])):(a(),o("form",{key:1,onSubmit:A(q,["prevent"]),class:"space-y-6"},[e("div",null,[t[10]||(t[10]=e("label",{class:"label"},"Category *",-1)),d(e("select",{"onUpdate:modelValue":t[0]||(t[0]=i=>l.category_id=i),required:"",class:"input"},[t[9]||(t[9]=e("option",{value:""},"Select a category",-1)),(a(!0),o(x,null,w(U.value,i=>(a(),o("optgroup",{key:i.id,label:i.name},[(a(!0),o(x,null,w(i.children,c=>(a(),o("option",{key:c.id,value:c.id},k(c.name),9,et))),128))],8,tt))),128))],512),[[f,l.category_id]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"label"},"Title *",-1)),d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>l.title=i),type:"text",maxlength:"100",required:"",class:"input"},null,512),[[g,l.title]]),e("p",lt,k(l.title.length)+"/100",1)]),e("div",null,[t[12]||(t[12]=e("label",{class:"label"},"Description *",-1)),d(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=i=>l.description=i),rows:"5",maxlength:"5000",required:"",class:"input"},null,512),[[g,l.description]])]),e("div",it,[e("div",null,[t[14]||(t[14]=e("label",{class:"label"},"Price *",-1)),e("div",st,[t[13]||(t[13]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},"â‚¹",-1)),d(e("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>l.price=i),type:"number",min:"0",required:"",class:"input pl-8"},null,512),[[g,l.price]])])]),e("div",null,[t[16]||(t[16]=e("label",{class:"label"},"Price Type",-1)),d(e("select",{"onUpdate:modelValue":t[4]||(t[4]=i=>l.price_type=i),class:"input"},[...t[15]||(t[15]=[e("option",{value:"fixed"},"Fixed",-1),e("option",{value:"negotiable"},"Negotiable",-1),e("option",{value:"free"},"Free",-1),e("option",{value:"contact"},"Contact for Price",-1)])],512),[[f,l.price_type]])])]),e("div",null,[t[18]||(t[18]=e("label",{class:"label"},"Condition",-1)),d(e("select",{"onUpdate:modelValue":t[5]||(t[5]=i=>l.condition=i),class:"input"},[...t[17]||(t[17]=[G('<option value="">Select condition</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[f,l.condition]])]),e("div",ot,[e("div",null,[t[19]||(t[19]=e("label",{class:"label"},"Brand",-1)),d(e("input",{"onUpdate:modelValue":t[6]||(t[6]=i=>l.brand=i),type:"text",class:"input"},null,512),[[g,l.brand]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"label"},"Model",-1)),d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>l.model=i),type:"text",class:"input"},null,512),[[g,l.model]])])]),e("div",null,[t[22]||(t[22]=e("label",{class:"label"},"Current Photos",-1)),e("div",at,[(a(!0),o(x,null,w(r.value,i=>(a(),o("div",{key:i.id,class:"relative aspect-square bg-gray-100 rounded-lg overflow-hidden"},[e("img",{src:i.thumbnail_url,class:"w-full h-full object-cover"},null,8,nt),e("button",{type:"button",onClick:c=>N(i.id),class:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center"},[m(V(Y),{class:"w-4 h-4"})],8,rt),i.is_primary?(a(),o("span",ut," Primary ")):(a(),o("button",{key:0,type:"button",onClick:c=>P(i.id),class:"absolute bottom-1 left-1 text-xs bg-white px-2 py-1 rounded"}," Set as primary ",8,dt))]))),128)),r.value.length<10?(a(),o("label",pt,[m(V(K),{class:"w-8 h-8 text-gray-400 mb-1"}),t[21]||(t[21]=e("span",{class:"text-sm text-gray-500"},"Add More",-1)),e("input",{type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:F},null,32)])):R("",!0)])]),e("div",ct,[t[23]||(t[23]=e("h3",{class:"font-semibold text-gray-900 mb-4"},"Location",-1)),m(J,{"initial-latitude":l.latitude,"initial-longitude":l.longitude,"initial-city":l.city,"initial-state":l.state,"initial-locality":l.locality,"initial-postal-code":l.postal_code,"onUpdate:location":$},null,8,["initial-latitude","initial-longitude","initial-city","initial-state","initial-locality","initial-postal-code"])]),e("div",gt,[m(p,{to:"/my-listings",class:"btn-secondary"},{default:z(()=>[...t[24]||(t[24]=[O(" Cancel ",-1)])]),_:1}),e("button",{type:"submit",disabled:y.value,class:"btn-primary"},k(y.value?"Saving...":"Save Changes"),9,yt)])],32))])])])}}};export{kt as default};
