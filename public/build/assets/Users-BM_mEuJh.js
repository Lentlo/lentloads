import{C as Q,r as v,D as B,m as W,c as i,o as d,a as e,g as h,w as r,d as m,e as u,i as X,v as $,G as w,F as E,j as T,t as a,I as k,f as Z,O as ee,J as te,k as b,h as R,K as p}from"./main-td6pS0N2.js";import{d as se}from"./dayjs.min-Bof1u0Bp.js";import{d as le,r as ae}from"./debounce-aVx8c7ga.js";import{r as oe}from"./CheckBadgeIcon-CUUT-V7i.js";import{r as ne}from"./TagIcon-DWicKbWj.js";import{r as ie}from"./StarIcon-CvWzk8g5.js";import{r as de}from"./EyeIcon-CDPChSYS.js";import{r as re,a as ue}from"./TrashIcon-D2AXuA6o.js";const pe={class:"p-6"},ce={class:"card p-4 mb-6"},ve={class:"flex flex-wrap gap-4"},xe={class:"flex-1 min-w-[200px]"},ge={class:"relative"},me={class:"card overflow-hidden"},ye={class:"w-full"},be={class:"divide-y"},fe={key:0},_e={key:1},he={class:"px-4 py-3"},we={class:"flex items-center gap-3"},ke=["src","alt"],Ue={class:"font-medium text-gray-900"},Ce={class:"text-sm text-gray-500"},$e={class:"px-4 py-3 text-gray-600"},Ve={class:"px-4 py-3"},Se=["onUpdate:modelValue","onChange"],Me={class:"px-4 py-3"},je=["onUpdate:modelValue","onChange"],Ne={class:"px-4 py-3"},Ae=["onClick"],Re={class:"px-4 py-3 text-xs text-gray-500"},Fe={class:"flex flex-col gap-1"},De={class:"px-4 py-3 text-gray-600 text-sm"},Le={class:"px-4 py-3"},Pe={class:"flex items-center gap-1"},Be=["onClick"],Ee=["onClick"],Te=["onClick"],Ye={key:0,class:"p-4 border-t flex items-center justify-between"},ze={class:"text-sm text-gray-500"},Je={class:"flex gap-2"},Ie=["disabled"],qe=["disabled"],Ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ke={class:"relative bg-white rounded-xl p-6 w-full max-w-3xl max-h-[90vh] overflow-y-auto"},Oe={class:"flex items-start justify-between mb-6"},He={class:"flex items-center gap-4"},Qe=["src","alt"],We={class:"text-xl font-semibold"},Xe={class:"text-gray-500"},Ze={class:"flex items-center gap-2 mt-1"},et={key:0,class:"badge bg-green-100 text-green-700"},tt={class:"grid grid-cols-4 gap-4 mb-6"},st={class:"bg-gray-50 rounded-lg p-4 text-center"},lt={class:"text-2xl font-bold text-gray-900"},at={class:"bg-gray-50 rounded-lg p-4 text-center"},ot={class:"text-2xl font-bold text-gray-900"},nt={class:"bg-gray-50 rounded-lg p-4 text-center"},it={class:"text-2xl font-bold text-gray-900"},dt={class:"bg-gray-50 rounded-lg p-4 text-center"},rt={class:"text-2xl font-bold text-gray-900"},ut={key:0,class:"space-y-2"},pt=["src","alt"],ct={class:"flex-1 min-w-0"},vt={class:"font-medium truncate"},xt={class:"text-sm text-gray-500"},gt=["href"],mt={key:1,class:"text-gray-500 text-sm"},yt={class:"mt-6 pt-6 border-t"},bt={class:"grid grid-cols-2 gap-4 text-sm"},ft={class:"ml-2"},_t={class:"ml-2"},ht={class:"ml-2"},wt={class:"ml-2"},kt={key:1,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ut={class:"relative bg-white rounded-xl p-6 w-full max-w-md"},Ct={class:"grid grid-cols-2 gap-4"},$t={class:"flex items-center gap-2"},Vt={class:"flex gap-2 pt-2"},St=["disabled"],Bt={__name:"Users",setup(Mt){const Y=Q(),V=v(!0),U=v(!1),S=v([]),M=v(Y.query.search||""),c=v(1),C=v(1),j=v(20),N=v(0),f=v(null),o=v(null),n=B({name:"",email:"",phone:"",role:"user",status:"active",is_verified_seller:!1}),_=B({role:"",status:""}),A=l=>se(l).format("MMM D, YYYY"),F=l=>({active:"bg-green-100 text-green-800",suspended:"bg-yellow-100 text-yellow-800",banned:"bg-red-100 text-red-800"})[l]||"bg-gray-100 text-gray-800",D=l=>({admin:"bg-purple-100 text-purple-800",moderator:"bg-blue-100 text-blue-800",user:"bg-gray-100 text-gray-800"})[l]||"bg-gray-100 text-gray-800",z=l=>({active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",rejected:"bg-red-100 text-red-800",sold:"bg-blue-100 text-blue-800"})[l]||"bg-gray-100 text-gray-800",x=async()=>{V.value=!0;try{const l=await b.get("/admin/users",{params:{page:c.value,search:M.value,role:_.role,status:_.status}});S.value=l.data.data,c.value=l.data.meta.current_page,C.value=l.data.meta.last_page,j.value=l.data.meta.per_page,N.value=l.data.meta.total}finally{V.value=!1}},L=le(()=>{c.value=1,x()},300),P=l=>{l>=1&&l<=C.value&&(c.value=l,x())},J=async l=>{try{const t=await b.get(`/admin/users/${l.id}`);o.value=t.data.data}catch{p.error("Failed to load user details")}},I=l=>{f.value=l,n.name=l.name,n.email=l.email,n.phone=l.phone||"",n.role=l.role,n.status=l.status,n.is_verified_seller=l.is_verified_seller||!1},q=async()=>{var l,t;U.value=!0;try{await b.put(`/admin/users/${f.value.id}`,n),p.success("User updated"),f.value=null,x()}catch(y){p.error(((t=(l=y.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to update user")}finally{U.value=!1}},G=async l=>{try{await b.put(`/admin/users/${l.id}`,{role:l.role}),p.success("Role updated")}catch{p.error("Failed to update role"),x()}},K=async l=>{try{await b.put(`/admin/users/${l.id}`,{status:l.status}),p.success("Status updated")}catch{p.error("Failed to update status"),x()}},O=async l=>{try{const t=!l.is_verified_seller;await b.put(`/admin/users/${l.id}`,{is_verified_seller:t}),l.is_verified_seller=t,p.success(t?"Seller verified":"Verification removed")}catch{p.error("Failed to update verification")}},H=async l=>{var t,y;if(confirm(`Delete ${l.name}? This action cannot be undone.`))try{await b.delete(`/admin/users/${l.id}`),p.success("User deleted"),x()}catch(s){p.error(((y=(t=s.response)==null?void 0:t.data)==null?void 0:y.message)||"Failed to delete user")}};return W(()=>{x()}),(l,t)=>{var y;return d(),i("div",pe,[t[41]||(t[41]=e("div",{class:"flex items-center justify-between mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Manage Users")],-1)),e("div",ce,[e("div",ve,[e("div",xe,[e("div",ge,[m(u(X),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),r(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>M.value=s),type:"text",placeholder:"Search users...",class:"input pl-10",onInput:t[1]||(t[1]=(...s)=>u(L)&&u(L)(...s))},null,544),[[$,M.value]])])]),r(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>_.role=s),onChange:x,class:"input w-auto"},[...t[16]||(t[16]=[e("option",{value:""},"All Roles",-1),e("option",{value:"user"},"User",-1),e("option",{value:"moderator"},"Moderator",-1),e("option",{value:"admin"},"Admin",-1)])],544),[[w,_.role]]),r(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>_.status=s),onChange:x,class:"input w-auto"},[...t[17]||(t[17]=[e("option",{value:""},"All Status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"suspended"},"Suspended",-1),e("option",{value:"banned"},"Banned",-1)])],544),[[w,_.status]])])]),e("div",me,[e("table",ye,[t[22]||(t[22]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"User"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Email"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Role"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Status"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Verified"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Stats"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Joined"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions")])],-1)),e("tbody",be,[V.value?(d(),i("tr",fe,[...t[18]||(t[18]=[e("td",{colspan:"8",class:"px-4 py-8 text-center text-gray-500"}," Loading... ",-1)])])):S.value.length?h("",!0):(d(),i("tr",_e,[...t[19]||(t[19]=[e("td",{colspan:"8",class:"px-4 py-8 text-center text-gray-500"}," No users found ",-1)])])),(d(!0),i(E,null,T(S.value,s=>(d(),i("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",he,[e("div",we,[e("img",{src:s.avatar_url,alt:s.name,class:"w-10 h-10 rounded-full object-cover"},null,8,ke),e("div",null,[e("p",Ue,a(s.name),1),e("p",Ce,a(s.phone||"No phone"),1)])])]),e("td",$e,a(s.email),1),e("td",Ve,[r(e("select",{"onUpdate:modelValue":g=>s.role=g,onChange:g=>G(s),class:k(["text-xs border rounded px-2 py-1",D(s.role)])},[...t[20]||(t[20]=[e("option",{value:"user"},"User",-1),e("option",{value:"moderator"},"Moderator",-1),e("option",{value:"admin"},"Admin",-1)])],42,Se),[[w,s.role]])]),e("td",Me,[r(e("select",{"onUpdate:modelValue":g=>s.status=g,onChange:g=>K(s),class:k(["text-xs border rounded px-2 py-1",F(s.status)])},[...t[21]||(t[21]=[e("option",{value:"active"},"Active",-1),e("option",{value:"suspended"},"Suspended",-1),e("option",{value:"banned"},"Banned",-1)])],42,je),[[w,s.status]])]),e("td",Ne,[e("button",{onClick:g=>O(s),class:k([s.is_verified_seller?"bg-green-100 text-green-700":"bg-gray-100 text-gray-400","px-2 py-1 rounded text-xs font-medium flex items-center gap-1"])},[m(u(oe),{class:"w-4 h-4"}),R(" "+a(s.is_verified_seller?"Verified":"Unverified"),1)],10,Ae)]),e("td",Re,[e("div",Fe,[e("span",null,[m(u(ne),{class:"w-3 h-3 inline"}),R(" "+a(s.listings_count||0)+" listings",1)]),e("span",null,[m(u(ie),{class:"w-3 h-3 inline"}),R(" "+a(s.rating||"0.0")+" rating",1)])])]),e("td",De,a(A(s.created_at)),1),e("td",Le,[e("div",Pe,[e("button",{onClick:g=>J(s),class:"p-1 text-gray-600 hover:bg-gray-100 rounded",title:"View Details"},[m(u(de),{class:"w-5 h-5"})],8,Be),e("button",{onClick:g=>I(s),class:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:"Edit"},[m(u(re),{class:"w-5 h-5"})],8,Ee),s.role!=="admin"?(d(),i("button",{key:0,onClick:g=>H(s),class:"p-1 text-red-600 hover:bg-red-50 rounded",title:"Delete"},[m(u(ue),{class:"w-5 h-5"})],8,Te)):h("",!0)])])]))),128))])]),C.value>1?(d(),i("div",Ye,[e("p",ze," Showing "+a((c.value-1)*j.value+1)+" to "+a(Math.min(c.value*j.value,N.value))+" of "+a(N.value)+" users ",1),e("div",Je,[e("button",{onClick:t[4]||(t[4]=s=>P(c.value-1)),disabled:c.value===1,class:"btn-secondary btn-sm"}," Previous ",8,Ie),e("button",{onClick:t[5]||(t[5]=s=>P(c.value+1)),disabled:c.value===C.value,class:"btn-secondary btn-sm"}," Next ",8,qe)])])):h("",!0)]),o.value?(d(),i("div",Ge,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[6]||(t[6]=s=>o.value=null)}),e("div",Ke,[e("div",Oe,[e("div",He,[e("img",{src:o.value.avatar_url,alt:o.value.name,class:"w-16 h-16 rounded-full object-cover"},null,8,Qe),e("div",null,[e("h3",We,a(o.value.name),1),e("p",Xe,a(o.value.email),1),e("div",Ze,[e("span",{class:k([F(o.value.status),"badge"])},a(o.value.status),3),e("span",{class:k([D(o.value.role),"badge"])},a(o.value.role),3),o.value.is_verified_seller?(d(),i("span",et,"Verified Seller")):h("",!0)])])]),e("button",{onClick:t[7]||(t[7]=s=>o.value=null),class:"p-2 text-gray-400 hover:text-gray-600"},[m(u(Z),{class:"w-6 h-6"})])]),e("div",tt,[e("div",st,[e("p",lt,a(o.value.listings_count||0),1),t[23]||(t[23]=e("p",{class:"text-sm text-gray-500"},"Listings",-1))]),e("div",at,[e("p",ot,a(o.value.successful_sales||0),1),t[24]||(t[24]=e("p",{class:"text-sm text-gray-500"},"Sales",-1))]),e("div",nt,[e("p",it,a(o.value.rating||"0.0"),1),t[25]||(t[25]=e("p",{class:"text-sm text-gray-500"},"Rating",-1))]),e("div",dt,[e("p",rt,a(o.value.reviews_received_count||0),1),t[26]||(t[26]=e("p",{class:"text-sm text-gray-500"},"Reviews",-1))])]),e("div",null,[t[27]||(t[27]=e("h4",{class:"font-semibold mb-3"},"Recent Listings",-1)),(y=o.value.listings)!=null&&y.length?(d(),i("div",ut,[(d(!0),i(E,null,T(o.value.listings,s=>(d(),i("div",{key:s.id,class:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg"},[e("img",{src:s.primary_image_url,alt:s.title,class:"w-12 h-12 rounded object-cover"},null,8,pt),e("div",ct,[e("p",vt,a(s.title),1),e("p",xt,a(s.formatted_price),1)]),e("span",{class:k([z(s.status),"badge text-xs"])},a(s.status),3),e("a",{href:`/listing/${s.slug}`,target:"_blank",class:"p-1 text-gray-400 hover:text-gray-600"},[m(u(ae),{class:"w-4 h-4"})],8,gt)]))),128))])):(d(),i("p",mt,"No listings yet"))]),e("div",yt,[e("div",bt,[e("div",null,[t[28]||(t[28]=e("span",{class:"text-gray-500"},"Phone:",-1)),e("span",ft,a(o.value.phone||"Not provided"),1)]),e("div",null,[t[29]||(t[29]=e("span",{class:"text-gray-500"},"Location:",-1)),e("span",_t,a(o.value.city||"Not provided"),1)]),e("div",null,[t[30]||(t[30]=e("span",{class:"text-gray-500"},"Joined:",-1)),e("span",ht,a(A(o.value.created_at)),1)]),e("div",null,[t[31]||(t[31]=e("span",{class:"text-gray-500"},"Last Active:",-1)),e("span",wt,a(o.value.last_active_at?A(o.value.last_active_at):"Unknown"),1)])])])])])):h("",!0),f.value?(d(),i("div",kt,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[8]||(t[8]=s=>f.value=null)}),e("div",Ut,[t[40]||(t[40]=e("h3",{class:"text-lg font-semibold mb-4"},"Edit User",-1)),e("form",{onSubmit:ee(q,["prevent"]),class:"space-y-4"},[e("div",null,[t[32]||(t[32]=e("label",{class:"label"},"Name",-1)),r(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>n.name=s),type:"text",class:"input"},null,512),[[$,n.name]])]),e("div",null,[t[33]||(t[33]=e("label",{class:"label"},"Email",-1)),r(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>n.email=s),type:"email",class:"input"},null,512),[[$,n.email]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"label"},"Phone",-1)),r(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>n.phone=s),type:"text",class:"input"},null,512),[[$,n.phone]])]),e("div",Ct,[e("div",null,[t[36]||(t[36]=e("label",{class:"label"},"Role",-1)),r(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>n.role=s),class:"input"},[...t[35]||(t[35]=[e("option",{value:"user"},"User",-1),e("option",{value:"moderator"},"Moderator",-1),e("option",{value:"admin"},"Admin",-1)])],512),[[w,n.role]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"label"},"Status",-1)),r(e("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>n.status=s),class:"input"},[...t[37]||(t[37]=[e("option",{value:"active"},"Active",-1),e("option",{value:"suspended"},"Suspended",-1),e("option",{value:"banned"},"Banned",-1)])],512),[[w,n.status]])])]),e("div",$t,[r(e("input",{type:"checkbox","onUpdate:modelValue":t[14]||(t[14]=s=>n.is_verified_seller=s),id:"verified",class:"rounded"},null,512),[[te,n.is_verified_seller]]),t[39]||(t[39]=e("label",{for:"verified",class:"text-sm"},"Verified Seller",-1))]),e("div",Vt,[e("button",{type:"button",onClick:t[15]||(t[15]=s=>f.value=null),class:"btn-secondary flex-1"}," Cancel "),e("button",{type:"submit",class:"btn-primary flex-1",disabled:U.value},a(U.value?"Saving...":"Save"),9,St)])],32)])])):h("",!0)])}}};export{Bt as default};
