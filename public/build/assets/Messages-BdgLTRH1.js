var j=(h,f,n)=>new Promise((u,d)=>{var _=o=>{try{c(n.next(o))}catch(i){d(i)}},y=o=>{try{c(n.throw(o))}catch(i){d(i)}},c=o=>o.done?u(o.value):Promise.resolve(o.value).then(_,y);c((n=n.apply(h,f)).next())});import{d as P,h as T,b as U}from"./main-capacitor-C1-jC-GR.js";import{d as B}from"./dayjs.min-CEPR7PNd.js";import{r as z}from"./relativeTime-ly0sVqCw.js";import{f as g,b as C,o as E,v as G,k as r,l,p as e,x as p,F as L,G as S,a as V,z as H,y as A,I as D,A as m,H as O}from"./vue-vendor-DFuH7PQo.js";import"./ui-vendor-CosC-cw2.js";const R={class:"messages-page min-h-screen bg-gray-50"},Y={class:"container-app py-6"},$={key:0,class:"space-y-4"},q={key:1,class:"space-y-2"},J=["src","alt"],K={class:"flex-1 min-w-0"},Q={class:"flex items-center justify-between mb-1"},W={class:"font-semibold text-gray-900 truncate"},X={class:"text-xs text-gray-500"},Z={class:"text-sm text-gray-500 truncate mb-1"},ee={class:"text-sm text-gray-600 truncate"},te={key:0},se={key:0,class:"flex items-center"},ae={class:"w-6 h-6 bg-primary-600 text-white text-xs rounded-full flex items-center justify-center"},le=["src"],re={key:2,class:"card p-12 text-center"},oe={key:3,class:"mt-6 text-center"},ne=["disabled"],ge={__name:"Messages",setup(h){B.extend(z);const f=P(),n=g(!0),u=g(!1),d=g([]),_=g(1),y=g(1),c=C(()=>{var a;return(a=f.user)==null?void 0:a.id}),o=C(()=>_.value<y.value),i=a=>a.buyer_id===c.value?a.seller:a.buyer,F=a=>a?B(a).fromNow():"",x=(a=!1)=>j(this,null,function*(){a?u.value=!0:n.value=!0;try{const t=yield U.get("/conversations",{params:{page:a?_.value+1:1}});a?d.value=[...d.value,...t.data.data]:d.value=t.data.data,_.value=t.data.meta.current_page,y.value=t.data.meta.last_page}finally{n.value=!1,u.value=!1}}),I=()=>{x(!0)};return E(()=>{x()}),(a,t)=>{const v=G("router-link");return l(),r("div",R,[e("div",Y,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Messages",-1)),n.value?(l(),r("div",$,[(l(),r(L,null,S(5,s=>e("div",{key:s,class:"card p-4 flex gap-4"},[...t[0]||(t[0]=[e("div",{class:"skeleton w-12 h-12 rounded-full"},null,-1),e("div",{class:"flex-1"},[e("div",{class:"skeleton h-4 w-1/3 mb-2"}),e("div",{class:"skeleton h-3 w-2/3"})],-1)])])),64))])):d.value.length?(l(),r("div",q,[(l(!0),r(L,null,S(d.value,s=>(l(),O(v,{key:s.id,to:`/messages/${s.uuid}`,class:"card p-4 flex gap-4 hover:shadow-md transition"},{default:A(()=>{var b,k,w,M,N;return[e("img",{src:i(s).avatar_url,alt:i(s).name,class:"w-12 h-12 rounded-full object-cover"},null,8,J),e("div",K,[e("div",Q,[e("h3",W,m(i(s).name),1),e("span",X,m(F((b=s.latest_message)==null?void 0:b.created_at)),1)]),e("p",Z," Re: "+m((k=s.listing)==null?void 0:k.title),1),e("p",ee,[((w=s.latest_message)==null?void 0:w.sender_id)===c.value?(l(),r("span",te,"You: ")):p("",!0),D(" "+m(((M=s.latest_message)==null?void 0:M.body)||"No messages yet"),1)])]),s.unread_count>0?(l(),r("div",se,[e("span",ae,m(s.unread_count),1)])):p("",!0),(N=s.listing)!=null&&N.primary_image?(l(),r("img",{key:1,src:s.listing.primary_image.thumbnail_url,class:"w-16 h-16 rounded-lg object-cover hidden sm:block"},null,8,le)):p("",!0)]}),_:2},1032,["to"]))),128))])):(l(),r("div",re,[V(H(T),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t[2]||(t[2]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No messages yet",-1)),t[3]||(t[3]=e("p",{class:"text-gray-500 mb-4"},"Start a conversation by contacting a seller",-1)),V(v,{to:"/search",class:"btn-primary"},{default:A(()=>[...t[1]||(t[1]=[D(" Browse Listings ",-1)])]),_:1})])),o.value?(l(),r("div",oe,[e("button",{onClick:I,disabled:u.value,class:"btn-secondary"},m(u.value?"Loading...":"Load More"),9,ne)])):p("",!0)])])}}};export{ge as default};
