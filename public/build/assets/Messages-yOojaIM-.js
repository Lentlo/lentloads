import{L as P,r as d,b as w,m as T,n as U,c as r,o as l,a as e,g as i,F as N,j as M,d as j,e as A,N as E,y as B,h as C,t as o,k as I,p as O}from"./main-BULliYwU.js";import{d as L}from"./dayjs.min-Bof1u0Bp.js";import{r as R}from"./relativeTime-Ckc_g6N8.js";const Y={class:"min-h-screen bg-gray-50 py-6"},$={class:"container-app"},q={key:0,class:"space-y-4"},z={key:1,class:"space-y-2"},G=["src","alt"],H={class:"flex-1 min-w-0"},J={class:"flex items-center justify-between mb-1"},K={class:"font-semibold text-gray-900 truncate"},Q={class:"text-xs text-gray-500"},W={class:"text-sm text-gray-500 truncate mb-1"},X={class:"text-sm text-gray-600 truncate"},Z={key:0},ee={key:0,class:"flex items-center"},te={class:"w-6 h-6 bg-primary-600 text-white text-xs rounded-full flex items-center justify-center"},se=["src"],ae={key:2,class:"card p-12 text-center"},le={key:3,class:"mt-6 text-center"},re=["disabled"],ie={__name:"Messages",setup(oe){L.extend(R);const S=P(),u=d(!0),c=d(!1),n=d([]),m=d(1),g=d(1),y=w(()=>{var a;return(a=S.user)==null?void 0:a.id}),V=w(()=>m.value<g.value),_=a=>a.buyer_id===y.value?a.seller:a.buyer,D=a=>a?L(a).fromNow():"",f=async(a=!1)=>{a?c.value=!0:u.value=!0;try{const t=await I.get("/conversations",{params:{page:a?m.value+1:1}});a?n.value=[...n.value,...t.data.data]:n.value=t.data.data,m.value=t.data.meta.current_page,g.value=t.data.meta.last_page}finally{u.value=!1,c.value=!1}},F=()=>{f(!0)};return T(()=>{f()}),(a,t)=>{const p=U("router-link");return l(),r("div",Y,[e("div",$,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Messages",-1)),u.value?(l(),r("div",q,[(l(),r(N,null,M(5,s=>e("div",{key:s,class:"card p-4 flex gap-4"},[...t[0]||(t[0]=[e("div",{class:"skeleton w-12 h-12 rounded-full"},null,-1),e("div",{class:"flex-1"},[e("div",{class:"skeleton h-4 w-1/3 mb-2"}),e("div",{class:"skeleton h-3 w-2/3"})],-1)])])),64))])):n.value.length?(l(),r("div",z,[(l(!0),r(N,null,M(n.value,s=>(l(),O(p,{key:s.id,to:`/messages/${s.uuid}`,class:"card p-4 flex gap-4 hover:shadow-md transition"},{default:B(()=>{var h,x,v,b,k;return[e("img",{src:_(s).avatar_url,alt:_(s).name,class:"w-12 h-12 rounded-full object-cover"},null,8,G),e("div",H,[e("div",J,[e("h3",K,o(_(s).name),1),e("span",Q,o(D((h=s.latest_message)==null?void 0:h.created_at)),1)]),e("p",W," Re: "+o((x=s.listing)==null?void 0:x.title),1),e("p",X,[((v=s.latest_message)==null?void 0:v.sender_id)===y.value?(l(),r("span",Z,"You: ")):i("",!0),C(" "+o(((b=s.latest_message)==null?void 0:b.body)||"No messages yet"),1)])]),s.unread_count>0?(l(),r("div",ee,[e("span",te,o(s.unread_count),1)])):i("",!0),(k=s.listing)!=null&&k.primary_image?(l(),r("img",{key:1,src:s.listing.primary_image.thumbnail_url,class:"w-16 h-16 rounded-lg object-cover hidden sm:block"},null,8,se)):i("",!0)]}),_:2},1032,["to"]))),128))])):(l(),r("div",ae,[j(A(E),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t[2]||(t[2]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No messages yet",-1)),t[3]||(t[3]=e("p",{class:"text-gray-500 mb-4"},"Start a conversation by contacting a seller",-1)),j(p,{to:"/search",class:"btn-primary"},{default:B(()=>[...t[1]||(t[1]=[C(" Browse Listings ",-1)])]),_:1})])),V.value?(l(),r("div",le,[e("button",{onClick:F,disabled:c.value,class:"btn-secondary"},o(c.value?"Loading...":"Load More"),9,re)])):i("",!0)])])}}};export{ie as default};
