import{c as o,o as a,a as s,_ as ie,u as le,C as ae,x as oe,b as ne,r as c,K as re,d as h,D as de,L as ce,f as u,g as m,j as p,t as n,y as d,M as P,G as ue,i as F,l as L,F as x,h as y,A as f,z as me,p as M,B as D,N as A,O as pe,m as ge}from"./main-D7-9mSMK.js";import{u as ve}from"./listings-Dax42DMS.js";import{L as xe}from"./ListingCard-DD63wGo7.js";import{r as E}from"./BookmarkIcon-B1GMddeo.js";import"./dayjs.min-iy57P9mS.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./relativeTime-D5nU98bY.js";import"./SparklesIcon-D9rT-qV5.js";import"./BoltIcon-DNYTwzge.js";import"./MapPinIcon-DiyKzJS1.js";function ye(I,V){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"})])}const fe={class:"search-page bg-gray-50"},be={class:"container-app py-4"},_e={class:"lg:hidden mb-4"},he={class:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide"},ke={key:0,class:"w-5 h-5 bg-primary-600 text-white text-xs rounded-full flex items-center justify-center"},we={class:"relative flex-shrink-0"},Ce={key:0,class:"px-3 py-2 bg-primary-100 text-primary-700 rounded-full text-sm flex items-center gap-1 flex-shrink-0"},Se={key:1,class:"px-3 py-2 bg-primary-100 text-primary-700 rounded-full text-sm flex items-center gap-1 flex-shrink-0"},qe={key:2,class:"px-3 py-2 bg-primary-100 text-primary-700 rounded-full text-sm flex items-center gap-1 flex-shrink-0"},Fe={class:"flex flex-col lg:flex-row gap-6"},Le={class:"hidden lg:block lg:w-64 flex-shrink-0"},Me={class:"card p-4 sticky top-20"},Ve={class:"mb-5"},$e=["value"],Ne={class:"mb-5"},Ue={class:"mb-5"},Pe={class:"flex items-center gap-2"},Ae={class:"mb-5"},je={class:"space-y-2"},Ke=["onUpdate:modelValue","value"],Re={class:"ml-2 text-sm text-gray-600"},Be={class:"flex-1"},He={class:"flex items-center justify-between mb-4"},Te={class:"text-lg lg:text-xl font-bold text-gray-900"},Ge={class:"text-sm text-gray-500"},ze={class:"hidden lg:flex items-center gap-3"},De={key:0,class:"grid grid-cols-2 md:grid-cols-3 gap-3"},Ee={key:1,class:"grid grid-cols-2 md:grid-cols-3 gap-3"},Ie={key:2,class:"card p-8 text-center"},Oe={key:3,class:"mt-6 text-center"},Ye=["disabled"],Je={key:0,class:"filter-modal lg:hidden"},We={class:"filter-sheet"},Xe={class:"filter-header"},Ze={class:"flex items-center gap-2"},Qe={class:"filter-content"},et={class:"mb-6"},tt={class:"flex flex-wrap gap-2"},st=["onClick"],it={class:"mb-6"},lt={class:"mb-6"},at={class:"flex flex-wrap gap-2 mb-3"},ot=["onClick"],nt={class:"flex items-center gap-3"},rt={class:"mb-6"},dt={class:"flex flex-wrap gap-2"},ct=["onClick"],ut={class:"filter-actions"},mt={key:1,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},pt={class:"relative bg-white w-full sm:max-w-sm sm:rounded-xl rounded-t-2xl p-6 safe-area-bottom animate-slide-up"},gt={class:"mb-4"},vt={class:"flex gap-3"},xt=["disabled"],yt={__name:"Search",setup(I){const V=le(),O=ae(),k=oe(),Y=ne();ve();const w=c(!1),v=c([]),j=c(0),$=c(1),K=c(1),C=c(!1),b=c(!1),_=c(""),S=c(!1),t=re({q:"",category:"",city:"",min_price:"",max_price:"",condition:"",sort:"nearest",latitude:null,longitude:null}),R=[{value:"",label:"All"},{value:"new",label:"New"},{value:"like_new",label:"Like New"},{value:"good",label:"Good"},{value:"fair",label:"Fair"}],J=[{label:"Under ₹1K",min:"",max:1e3},{label:"₹1K - ₹5K",min:1e3,max:5e3},{label:"₹5K - ₹10K",min:5e3,max:1e4},{label:"₹10K+",min:1e4,max:""}],q=h(()=>k.categories),B=h(()=>Y.isAuthenticated),H=h(()=>t.q),W=h(()=>$.value<K.value),T=h(()=>{let l=0;return t.category&&l++,t.city&&l++,(t.min_price||t.max_price)&&l++,t.condition&&l++,l}),G=h(()=>t.q||t.category||t.city||t.min_price||t.max_price||t.condition),X=l=>{const e=q.value.find(i=>i.slug===l);return(e==null?void 0:e.name)||l},Z=l=>{t.min_price=l.min,t.max_price=l.max},z=l=>{t[l]="",r()},Q=()=>{t.min_price="",t.max_price="",r()},r=async(l=!1)=>{w.value=!0;try{const e={page:l?$.value+1:1,sort:t.sort};t.q&&(e.q=t.q),t.category&&(e.category=t.category),t.city&&(e.city=t.city),t.min_price&&(e.min_price=t.min_price),t.max_price&&(e.max_price=t.max_price),t.condition&&(e.condition=t.condition),t.latitude&&t.longitude&&(e.latitude=t.latitude,e.longitude=t.longitude);const i=await D.get("/listings",{params:e});l?v.value=[...v.value,...i.data.data]:v.value=i.data.data,j.value=i.data.meta.total,$.value=i.data.meta.current_page,K.value=i.data.meta.last_page;const g={...e};delete g.page,e.page>1&&(g.page=e.page),O.replace({query:g})}catch{A.error("Failed to fetch listings")}finally{w.value=!1}},ee=()=>r(!0),N=()=>{C.value=!1,r()},U=()=>{t.category="",t.city="",t.min_price="",t.max_price="",t.condition="",t.sort=t.latitude&&t.longitude?"nearest":"newest",C.value=!1,r()},te=async()=>{var l;if(_.value){S.value=!0;try{await D.post("/saved-searches",{name:_.value,query:t.q||null,category_id:((l=q.value.find(e=>e.slug===t.category))==null?void 0:l.id)||null,city:t.city||null,min_price:t.min_price||null,max_price:t.max_price||null,condition:t.condition||null}),A.success("Search saved! You'll be notified of new listings."),b.value=!1,_.value=""}catch{A.error("Failed to save search")}finally{S.value=!1}}},se=()=>{var l,e;if((l=k.currentLocation)!=null&&l.latitude&&((e=k.currentLocation)!=null&&e.longitude)){t.latitude=k.currentLocation.latitude,t.longitude=k.currentLocation.longitude;return}navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{t.latitude=i.coords.latitude,t.longitude=i.coords.longitude,t.sort==="nearest"&&v.value.length>0&&r()},i=>{console.log("Geolocation not available:",i.message),t.sort==="nearest"&&(t.sort="newest")},{timeout:5e3,maximumAge:3e5}):t.sort==="nearest"&&(t.sort="newest")};return de(()=>{const l=V.query;l.q&&(t.q=l.q),l.category&&(t.category=l.category),l.city&&(t.city=l.city),l.min_price&&(t.min_price=l.min_price),l.max_price&&(t.max_price=l.max_price),l.condition&&(t.condition=l.condition),l.sort&&(t.sort=l.sort),se(),r()}),ce(()=>V.query,l=>{let e=!1;l.q!==t.q&&(t.q=l.q||"",e=!0),l.category!==t.category&&(t.category=l.category||"",e=!0),l.city!==t.city&&(t.city=l.city||"",e=!0),l.min_price!==t.min_price&&(t.min_price=l.min_price||"",e=!0),l.max_price!==t.max_price&&(t.max_price=l.max_price||"",e=!0),l.condition!==t.condition&&(t.condition=l.condition||"",e=!0),l.sort!==t.sort&&l.sort&&(t.sort=l.sort,e=!0),e&&r()},{deep:!0}),(l,e)=>(a(),o("div",fe,[s("div",be,[s("div",_e,[s("div",he,[s("button",{onClick:e[0]||(e[0]=i=>C.value=!0),class:"flex items-center gap-2 px-4 py-2.5 bg-white rounded-full border shadow-sm flex-shrink-0"},[m(p(ye),{class:"w-5 h-5 text-gray-600"}),e[18]||(e[18]=s("span",{class:"text-sm font-medium"},"Filters",-1)),T.value>0?(a(),o("span",ke,n(T.value),1)):u("",!0)]),s("div",we,[d(s("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>t.sort=i),onChange:r,class:"appearance-none px-4 py-2.5 pr-8 bg-white rounded-full border shadow-sm text-sm font-medium"},[...e[19]||(e[19]=[s("option",{value:"nearest"},"Nearest",-1),s("option",{value:"newest"},"Newest",-1),s("option",{value:"price_low"},"Price: Low",-1),s("option",{value:"price_high"},"Price: High",-1)])],544),[[P,t.sort]]),m(p(ue),{class:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]),t.category?(a(),o("span",Ce,[F(n(X(t.category))+" ",1),s("button",{onClick:e[2]||(e[2]=i=>z("category"))},[m(p(L),{class:"w-4 h-4"})])])):u("",!0),t.city?(a(),o("span",Se,[F(n(t.city)+" ",1),s("button",{onClick:e[3]||(e[3]=i=>z("city"))},[m(p(L),{class:"w-4 h-4"})])])):u("",!0),t.min_price||t.max_price?(a(),o("span",qe,[F(" ₹"+n(t.min_price||0)+" - "+n(t.max_price||"∞")+" ",1),s("button",{onClick:Q},[m(p(L),{class:"w-4 h-4"})])])):u("",!0)])]),s("div",Fe,[s("aside",Le,[s("div",Me,[s("div",{class:"flex items-center justify-between mb-4"},[e[20]||(e[20]=s("h3",{class:"font-semibold text-gray-900"},"Filters",-1)),s("button",{onClick:U,class:"text-sm text-primary-600 hover:underline"}," Clear all ")]),s("div",Ve,[e[22]||(e[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Category",-1)),d(s("select",{"onUpdate:modelValue":e[4]||(e[4]=i=>t.category=i),class:"input text-sm"},[e[21]||(e[21]=s("option",{value:""},"All Categories",-1)),(a(!0),o(x,null,y(q.value,i=>(a(),o("option",{key:i.id,value:i.slug},n(i.name),9,$e))),128))],512),[[P,t.category]])]),s("div",Ne,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"City",-1)),d(s("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>t.city=i),type:"text",placeholder:"Enter city",class:"input text-sm"},null,512),[[f,t.city]])]),s("div",Ue,[e[25]||(e[25]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Price Range",-1)),s("div",Pe,[d(s("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>t.min_price=i),type:"number",placeholder:"Min",class:"input text-sm"},null,512),[[f,t.min_price]]),e[24]||(e[24]=s("span",{class:"text-gray-400"},"-",-1)),d(s("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>t.max_price=i),type:"number",placeholder:"Max",class:"input text-sm"},null,512),[[f,t.max_price]])])]),s("div",Ae,[e[26]||(e[26]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Condition",-1)),s("div",je,[(a(),o(x,null,y(R,i=>s("label",{key:i.value,class:"flex items-center"},[d(s("input",{type:"radio","onUpdate:modelValue":g=>t.condition=g,value:i.value,class:"text-primary-600"},null,8,Ke),[[pe,t.condition]]),s("span",Re,n(i.label),1)])),64))])]),s("button",{onClick:r,class:"btn-primary w-full mb-3"}," Apply Filters "),B.value&&G.value?(a(),o("button",{key:0,onClick:e[8]||(e[8]=i=>b.value=!0),class:"btn-secondary w-full text-sm"},[m(p(E),{class:"w-4 h-4 mr-2"}),e[27]||(e[27]=F(" Save This Search ",-1))])):u("",!0)])]),s("main",Be,[s("div",He,[s("div",null,[s("h1",Te,n(H.value?`"${H.value}"`:"All Listings"),1),s("p",Ge,n(j.value)+" results",1)]),s("div",ze,[d(s("select",{"onUpdate:modelValue":e[9]||(e[9]=i=>t.sort=i),onChange:r,class:"input w-auto text-sm"},[...e[28]||(e[28]=[s("option",{value:"nearest"},"Nearest First",-1),s("option",{value:"newest"},"Newest First",-1),s("option",{value:"price_low"},"Price: Low to High",-1),s("option",{value:"price_high"},"Price: High to Low",-1)])],544),[[P,t.sort]])])]),w.value&&!v.value.length?(a(),o("div",De,[(a(),o(x,null,y(6,i=>s("div",{key:i,class:"card p-3"},[...e[29]||(e[29]=[s("div",{class:"skeleton aspect-square mb-2 rounded-lg"},null,-1),s("div",{class:"skeleton h-4 w-16 mb-1"},null,-1),s("div",{class:"skeleton h-4 w-full mb-1"},null,-1),s("div",{class:"skeleton h-3 w-20"},null,-1)])])),64))])):v.value.length?(a(),o("div",Ee,[(a(!0),o(x,null,y(v.value,i=>(a(),ge(xe,{key:i.id,listing:i},null,8,["listing"]))),128))])):(a(),o("div",Ie,[m(p(me),{class:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e[30]||(e[30]=s("h3",{class:"font-medium text-gray-900 mb-1"},"No results found",-1)),e[31]||(e[31]=s("p",{class:"text-sm text-gray-500 mb-4"},"Try adjusting your filters",-1)),s("button",{onClick:U,class:"btn-primary"},"Clear Filters")])),W.value?(a(),o("div",Oe,[s("button",{onClick:ee,disabled:w.value,class:"btn-secondary"},n(w.value?"Loading...":"Load More"),9,Ye)])):u("",!0)])])]),C.value?(a(),o("div",Je,[s("div",{class:"filter-backdrop",onClick:N}),s("div",We,[s("div",Xe,[e[32]||(e[32]=s("h3",{class:"text-lg font-semibold"},"Filters",-1)),s("div",Ze,[s("button",{onClick:U,class:"text-sm text-primary-600 font-medium"},"Clear all"),s("button",{onClick:N,class:"p-2 hover:bg-gray-100 rounded-full"},[m(p(L),{class:"w-5 h-5"})])])]),s("div",Qe,[s("div",et,[e[33]||(e[33]=s("h4",{class:"font-medium text-gray-900 mb-3"},"Category",-1)),s("div",tt,[s("button",{onClick:e[10]||(e[10]=i=>t.category=""),class:M(["px-4 py-2 rounded-full border text-sm transition",t.category?"hover:bg-gray-50":"border-primary-500 bg-primary-50 text-primary-700"])}," All ",2),(a(!0),o(x,null,y(q.value,i=>(a(),o("button",{key:i.id,onClick:g=>t.category=i.slug,class:M(["px-4 py-2 rounded-full border text-sm transition",t.category===i.slug?"border-primary-500 bg-primary-50 text-primary-700":"hover:bg-gray-50"])},n(i.name),11,st))),128))])]),s("div",it,[e[34]||(e[34]=s("h4",{class:"font-medium text-gray-900 mb-3"},"City",-1)),d(s("input",{"onUpdate:modelValue":e[11]||(e[11]=i=>t.city=i),type:"text",placeholder:"Enter city name",class:"input"},null,512),[[f,t.city]])]),s("div",lt,[e[36]||(e[36]=s("h4",{class:"font-medium text-gray-900 mb-3"},"Price Range",-1)),s("div",at,[(a(),o(x,null,y(J,i=>s("button",{key:i.label,onClick:g=>Z(i),class:M(["px-3 py-2 text-sm border rounded-full transition",String(t.min_price)===String(i.min)&&String(t.max_price)===String(i.max)?"border-primary-500 bg-primary-50 text-primary-700":"hover:bg-gray-50"])},n(i.label),11,ot)),64))]),s("div",nt,[d(s("input",{"onUpdate:modelValue":e[12]||(e[12]=i=>t.min_price=i),type:"number",placeholder:"Min",class:"input text-center"},null,512),[[f,t.min_price]]),e[35]||(e[35]=s("span",{class:"text-gray-400"},"to",-1)),d(s("input",{"onUpdate:modelValue":e[13]||(e[13]=i=>t.max_price=i),type:"number",placeholder:"Max",class:"input text-center"},null,512),[[f,t.max_price]])])]),s("div",rt,[e[37]||(e[37]=s("h4",{class:"font-medium text-gray-900 mb-3"},"Condition",-1)),s("div",dt,[(a(),o(x,null,y(R,i=>s("button",{key:i.value,onClick:g=>t.condition=i.value,class:M(["px-4 py-2 rounded-full border text-sm transition",t.condition===i.value?"border-primary-500 bg-primary-50 text-primary-700":"hover:bg-gray-50"])},n(i.label),11,ct)),64))])])]),s("div",ut,[B.value&&G.value?(a(),o("button",{key:0,onClick:e[14]||(e[14]=i=>{b.value=!0,C.value=!1}),class:"btn-secondary"},[m(p(E),{class:"w-4 h-4"})])):u("",!0),s("button",{onClick:N,class:"btn-primary flex-1"}," Show Results ")])])])):u("",!0),b.value?(a(),o("div",mt,[s("div",{class:"absolute inset-0 bg-black/50",onClick:e[15]||(e[15]=i=>b.value=!1)}),s("div",pt,[e[39]||(e[39]=s("h3",{class:"text-lg font-semibold mb-4"},"Save This Search",-1)),e[40]||(e[40]=s("p",{class:"text-sm text-gray-500 mb-4"},"Get notified when new listings match your search criteria.",-1)),s("div",gt,[e[38]||(e[38]=s("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Search Name",-1)),d(s("input",{"onUpdate:modelValue":e[16]||(e[16]=i=>_.value=i),type:"text",class:"input",placeholder:"e.g., iPhone in Mumbai"},null,512),[[f,_.value]])]),s("div",vt,[s("button",{onClick:e[17]||(e[17]=i=>b.value=!1),class:"btn-secondary flex-1"},"Cancel"),s("button",{onClick:te,disabled:!_.value||S.value,class:"btn-primary flex-1"},n(S.value?"Saving...":"Save Search"),9,xt)])])])):u("",!0)]))}},Lt=ie(yt,[["__scopeId","data-v-39480b77"]]);export{Lt as default};
