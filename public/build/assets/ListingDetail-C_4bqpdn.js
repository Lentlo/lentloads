import{c as o,o as l,a as e,_ as P,l as E,r as p,g as i,d as u,e as c,f as Q,t as r,F as B,j as N,I as D,w as L,v as T,h as m,J as G,p as C,k as X,K as V,C as ee,L as te,b as U,m as se,n as le,q as ae,z as oe,M as ie,y as Z,N as re}from"./main-CyatRQiO.js";import{u as ne}from"./listings-bblDH3rS.js";import{_ as de}from"./ListingCard-yRfGN3rP.js";import{_ as ue}from"./LoadingSpinner-BIFWrzPq.js";import{r as ce}from"./ChatBubbleLeftIcon-D_sdvKnM.js";import{r as ve,R as me}from"./ReportModal-D1omsofW.js";import{d as ge}from"./dayjs.min-Bof1u0Bp.js";import{r as pe}from"./MapPinIcon-K1MpY30B.js";import{r as fe}from"./ClockIcon-D_IYYJBK.js";import{r as he}from"./EyeIcon-CddszW8Z.js";import{r as ye}from"./StarIcon-yvt_woeF.js";import{r as _e}from"./FlagIcon-D_sJSRGu.js";import"./relativeTime-Ckc_g6N8.js";import"./SparklesIcon-BWljWgsA.js";function be(g,k){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})])}function xe(g,k){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})])}function we(g,k){return l(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}const ke={class:"fixed inset-0 z-50 flex items-center justify-center p-4"},$e={class:"relative bg-white rounded-xl w-full max-w-md animate-slide-up"},Ce={class:"flex items-center justify-between p-4 border-b"},Me={key:0,class:"p-4 bg-gray-50 border-b"},je={class:"flex gap-3"},Se=["src","alt"],Ie={class:"flex-1 min-w-0"},Le={class:"font-medium text-gray-900 truncate"},Ve={class:"text-lg font-bold text-primary-600"},Be={class:"p-4 border-b"},Ne={class:"flex flex-wrap gap-2"},De=["onClick"],Ye={class:"p-4"},Ae={class:"mt-3"},Fe={class:"flex items-center gap-2 text-sm"},Re={key:0,class:"mt-2 flex items-center gap-2"},ze=["max"],Oe={class:"flex gap-3 p-4 border-t bg-gray-50 rounded-b-xl"},Te=["disabled"],Ue={__name:"ChatModal",props:{listing:{type:Object,required:!0},sellerId:{type:[Number,String],required:!0}},emits:["close","sent"],setup(g,{emit:k}){const $=g,w=k,M=E(),f=p(""),t=p(!1),_=p(null),n=p(!1),j=["Is this still available?","Can you share more photos?","What is the condition?","Is the price negotiable?","Can I see it today?"],S=async()=>{var h;if(f.value.trim()){n.value=!0;try{const a={listing_id:$.listing.id,receiver_id:$.sellerId,message:f.value.trim()};t.value&&_.value&&(a.offer_amount=_.value);const y=await X.post("/conversations",a);V.success("Message sent!"),w("sent",y.data.data),w("close"),M.push(`/dashboard/messages/${y.data.data.id}`)}catch(a){((h=a.response)==null?void 0:h.status)===409?(V.info("You already have a conversation about this listing"),M.push(`/dashboard/messages/${a.response.data.conversation_id}`),w("close")):V.error("Failed to send message")}finally{n.value=!1}}};return(h,a)=>{var y;return l(),o("div",ke,[e("div",{class:"absolute inset-0 bg-black/50",onClick:a[0]||(a[0]=d=>h.$emit("close"))}),e("div",$e,[e("div",Ce,[a[6]||(a[6]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Contact Seller",-1)),e("button",{onClick:a[1]||(a[1]=d=>h.$emit("close")),class:"p-1 hover:bg-gray-100 rounded"},[u(c(Q),{class:"w-5 h-5 text-gray-500"})])]),g.listing?(l(),o("div",Me,[e("div",je,[e("img",{src:g.listing.primary_image_url,alt:g.listing.title,class:"w-16 h-16 rounded-lg object-cover"},null,8,Se),e("div",Ie,[e("h4",Le,r(g.listing.title),1),e("p",Ve,r(g.listing.formatted_price),1)])])])):i("",!0),e("div",Be,[a[7]||(a[7]=e("p",{class:"text-sm text-gray-500 mb-3"},"Quick messages:",-1)),e("div",Ne,[(l(),o(B,null,N(j,d=>e("button",{key:d,onClick:Y=>f.value=d,class:D(["px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-full transition",f.value===d?"bg-primary-100 text-primary-700":""])},r(d),11,De)),64))])]),e("div",Ye,[L(e("textarea",{"onUpdate:modelValue":a[2]||(a[2]=d=>f.value=d),rows:"3",class:"input resize-none",placeholder:"Write your message..."},null,512),[[T,f.value]]),e("div",Ae,[e("label",Fe,[L(e("input",{type:"checkbox","onUpdate:modelValue":a[3]||(a[3]=d=>t.value=d),class:"rounded text-primary-600"},null,512),[[G,t.value]]),a[8]||(a[8]=m(" Include an offer ",-1))]),t.value?(l(),o("div",Re,[a[9]||(a[9]=e("span",{class:"text-gray-500"},"â‚¹",-1)),L(e("input",{"onUpdate:modelValue":a[4]||(a[4]=d=>_.value=d),type:"number",class:"input flex-1",placeholder:"Your offer amount",max:(y=g.listing)==null?void 0:y.price},null,8,ze),[[T,_.value,void 0,{number:!0}]])])):i("",!0)])]),e("div",Oe,[e("button",{onClick:a[5]||(a[5]=d=>h.$emit("close")),class:"btn-secondary flex-1"}," Cancel "),e("button",{onClick:S,disabled:!f.value.trim()||n.value,class:"btn-primary flex-1"},[n.value?(l(),C(ue,{key:1,class:"w-5 h-5 mr-2"})):(l(),C(c(ce),{key:0,class:"w-5 h-5 mr-2"})),m(" "+r(n.value?"Sending...":"Send Message"),1)],8,Te)])])])}}},Ze=P(Ue,[["__scopeId","data-v-47bd1303"]]),Ee={class:"min-h-screen bg-gray-50 py-6"},We={class:"container-app"},qe={key:0,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},He={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Je={class:"lg:col-span-2 space-y-6"},Ke={class:"card overflow-hidden"},Pe={class:"relative aspect-[4/3] bg-gray-100"},Qe=["src","alt"],Ge={key:0,class:"flex gap-2 p-4 overflow-x-auto"},Xe=["onClick"],et=["src"],tt={class:"card p-6"},st={class:"flex items-start justify-between mb-4"},lt={class:"text-2xl font-bold text-primary-600"},at={class:"text-xl font-semibold text-gray-900 mt-1"},ot={class:"flex items-center gap-2"},it={class:"flex flex-wrap gap-4 text-sm text-gray-500 mb-6"},rt={class:"flex items-center"},nt={class:"flex items-center"},dt={class:"flex items-center"},ut={class:"border-t pt-6"},ct={class:"text-gray-600 whitespace-pre-line"},vt={key:0,class:"border-t pt-6 mt-6"},mt={class:"grid grid-cols-2 gap-4"},gt={key:0},pt={class:"ml-2 font-medium capitalize"},ft={key:1},ht={class:"ml-2 font-medium"},yt={key:2},_t={class:"ml-2 font-medium"},bt={key:3},xt={class:"ml-2 font-medium"},wt={class:"space-y-6"},kt={class:"card p-6"},$t={class:"flex items-center gap-4 mb-4"},Ct=["src","alt"],Mt={class:"flex items-center text-sm text-gray-500"},jt={class:"text-sm text-gray-500"},St={key:0,class:"flex items-center text-green-600 text-sm mb-4"},It={class:"space-y-3"},Lt=["href"],Vt={key:2,class:"mt-12"},Bt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Jt={__name:"ListingDetail",setup(g){const k=ee(),$=E(),w=te(),M=ne(),f=p(!0),t=p(null),_=p([]),n=p(0),j=p(!1),S=p(!1),h=p(!1),a=U(()=>{var v,s,b,I;return(s=(v=t.value)==null?void 0:v.images)!=null&&s.length?(I=t.value.images[n.value])==null?void 0:I.url:(b=t.value)==null?void 0:b.primary_image_url}),y=U(()=>{var v,s,b;return((v=w.user)==null?void 0:v.id)===((b=(s=t.value)==null?void 0:s.user)==null?void 0:b.id)}),d=v=>ge(v).format("MMM D, YYYY"),Y=()=>{n.value>0?n.value--:n.value=t.value.images.length-1},W=()=>{n.value<t.value.images.length-1?n.value++:n.value=0},q=async()=>{if(!w.isAuthenticated){$.push("/login");return}const v=await M.toggleFavorite(t.value.id);j.value=v.is_favorited},H=()=>{if(!w.isAuthenticated){$.push("/login");return}S.value=!0},J=()=>{navigator.share&&navigator.share({title:t.value.title,text:`Check out this listing: ${t.value.title}`,url:window.location.href})},K=async()=>{var v;try{const s=await M.fetchListing(k.params.slug);t.value=s.listing,_.value=s.similar,j.value=s.listing.is_favorited}catch(s){((v=s.response)==null?void 0:v.status)===404&&$.push("/404")}finally{f.value=!1}};return se(()=>{K()}),(v,s)=>{var I,A,F,R,z;const b=le("router-link");return l(),o("div",Ee,[e("div",We,[f.value?(l(),o("div",qe,[...s[3]||(s[3]=[ae('<div class="lg:col-span-2"><div class="card p-4"><div class="skeleton h-96 mb-4"></div><div class="skeleton h-8 w-1/3 mb-2"></div><div class="skeleton h-6 w-full mb-4"></div><div class="skeleton h-24 w-full"></div></div></div><div class="card p-4"><div class="skeleton h-16 w-full mb-4"></div><div class="skeleton h-12 w-full mb-2"></div><div class="skeleton h-12 w-full"></div></div>',2)])])):t.value?(l(),o("div",He,[e("div",Je,[e("div",Ke,[e("div",Pe,[e("img",{src:a.value,alt:t.value.title,class:"w-full h-full object-contain"},null,8,Qe),((I=t.value.images)==null?void 0:I.length)>1?(l(),o("button",{key:0,onClick:Y,class:"absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center hover:bg-white"},[u(c(be),{class:"w-6 h-6"})])):i("",!0),((A=t.value.images)==null?void 0:A.length)>1?(l(),o("button",{key:1,onClick:W,class:"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center hover:bg-white"},[u(c(oe),{class:"w-6 h-6"})])):i("",!0)]),((F=t.value.images)==null?void 0:F.length)>1?(l(),o("div",Ge,[(l(!0),o(B,null,N(t.value.images,(x,O)=>(l(),o("button",{key:x.id,onClick:Nt=>n.value=O,class:D(["w-20 h-20 flex-shrink-0 rounded-lg overflow-hidden border-2",n.value===O?"border-primary-500":"border-transparent"])},[e("img",{src:x.thumbnail_url,class:"w-full h-full object-cover"},null,8,et)],10,Xe))),128))])):i("",!0)]),e("div",tt,[e("div",st,[e("div",null,[e("p",lt,r(t.value.formatted_price),1),e("h1",at,r(t.value.title),1)]),e("div",ot,[e("button",{onClick:q,class:"p-2 rounded-full hover:bg-gray-100"},[u(c(ie),{class:D(["w-6 h-6",j.value?"text-red-500 fill-current":"text-gray-400"])},null,8,["class"])]),e("button",{onClick:J,class:"p-2 rounded-full hover:bg-gray-100"},[u(c(we),{class:"w-6 h-6 text-gray-400"})])])]),e("div",it,[e("span",rt,[u(c(pe),{class:"w-4 h-4 mr-1"}),m(" "+r(t.value.location),1)]),e("span",nt,[u(c(fe),{class:"w-4 h-4 mr-1"}),m(" "+r(d(t.value.published_at)),1)]),e("span",dt,[u(c(he),{class:"w-4 h-4 mr-1"}),m(" "+r(t.value.views_count)+" views ",1)])]),e("div",ut,[s[4]||(s[4]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Description",-1)),e("p",ct,r(t.value.description),1)]),t.value.attributes?(l(),o("div",vt,[s[9]||(s[9]=e("h3",{class:"font-semibold text-gray-900 mb-3"},"Details",-1)),e("div",mt,[t.value.condition?(l(),o("div",gt,[s[5]||(s[5]=e("span",{class:"text-gray-500"},"Condition:",-1)),e("span",pt,r(t.value.condition.replace("_"," ")),1)])):i("",!0),t.value.brand?(l(),o("div",ft,[s[6]||(s[6]=e("span",{class:"text-gray-500"},"Brand:",-1)),e("span",ht,r(t.value.brand),1)])):i("",!0),t.value.model?(l(),o("div",yt,[s[7]||(s[7]=e("span",{class:"text-gray-500"},"Model:",-1)),e("span",_t,r(t.value.model),1)])):i("",!0),t.value.year?(l(),o("div",bt,[s[8]||(s[8]=e("span",{class:"text-gray-500"},"Year:",-1)),e("span",xt,r(t.value.year),1)])):i("",!0)])])):i("",!0)])]),e("div",wt,[e("div",kt,[e("div",$t,[e("img",{src:t.value.user.avatar_url,alt:t.value.user.name,class:"w-14 h-14 rounded-full object-cover"},null,8,Ct),e("div",null,[u(b,{to:`/user/${t.value.user.id}`,class:"font-semibold text-gray-900 hover:text-primary-600"},{default:Z(()=>[m(r(t.value.user.name),1)]),_:1},8,["to"]),e("div",Mt,[u(c(ye),{class:"w-4 h-4 text-yellow-400 mr-1"}),m(" "+r(t.value.user.rating||"0.0")+" ("+r(t.value.user.total_reviews)+" reviews) ",1)]),e("p",jt,r(t.value.user.city),1)])]),t.value.user.is_verified_seller?(l(),o("div",St,[u(c(ve),{class:"w-5 h-5 mr-1"}),s[10]||(s[10]=m(" Verified Seller ",-1))])):i("",!0),e("div",It,[y.value?i("",!0):(l(),o("button",{key:0,onClick:H,class:"btn-primary w-full"},[u(c(re),{class:"w-5 h-5 mr-2"}),s[11]||(s[11]=m(" Chat with Seller ",-1))])),t.value.user.phone&&!y.value?(l(),o("a",{key:1,href:`tel:${t.value.user.phone}`,class:"btn-outline w-full"},[u(c(xe),{class:"w-5 h-5 mr-2"}),s[12]||(s[12]=m(" Call Seller ",-1))],8,Lt)):i("",!0),y.value?(l(),C(b,{key:2,to:`/listing/${t.value.id}/edit`,class:"btn-primary w-full"},{default:Z(()=>[...s[13]||(s[13]=[m(" Edit Listing ",-1)])]),_:1},8,["to"])):i("",!0)])]),s[15]||(s[15]=e("div",{class:"card p-6 bg-yellow-50 border-yellow-200"},[e("h3",{class:"font-semibold text-yellow-800 mb-2"},"Safety Tips"),e("ul",{class:"text-sm text-yellow-700 space-y-1"},[e("li",null,"Meet in a safe public place"),e("li",null,"Check the item before you pay"),e("li",null,"Pay only after collecting the item"),e("li",null,"Never share financial information")])],-1)),e("button",{onClick:s[0]||(s[0]=x=>h.value=!0),class:"text-sm text-gray-500 hover:text-red-600 flex items-center"},[u(c(_e),{class:"w-4 h-4 mr-1"}),s[14]||(s[14]=m(" Report this ad ",-1))])])])):i("",!0),(R=_.value)!=null&&R.length?(l(),o("div",Vt,[s[16]||(s[16]=e("h2",{class:"text-xl font-bold text-gray-900 mb-6"},"Similar Ads",-1)),e("div",Bt,[(l(!0),o(B,null,N(_.value,x=>(l(),C(de,{key:x.id,listing:x},null,8,["listing"]))),128))])])):i("",!0)]),S.value?(l(),C(Ze,{key:0,listing:t.value,onClose:s[1]||(s[1]=x=>S.value=!1)},null,8,["listing"])):i("",!0),h.value?(l(),C(me,{key:1,type:"listing",id:(z=t.value)==null?void 0:z.id,onClose:s[2]||(s[2]=x=>h.value=!1)},null,8,["id"])):i("",!0)])}}};export{Jt as default};
