import{r as g,K as P,D as q,c as r,o as i,a as e,f as C,y as _,A as j,j as M,M as G,F as E,h as H,t as a,g as J,l as Q,B as I,p as f,X as R}from"./main-Bps2kPvF.js";import{d as K}from"./dayjs.min-iy57P9mS.js";import{r as W}from"./relativeTime-D5nU98bY.js";import"./_commonjsHelpers-Cpj98o6Y.js";const Y={class:"p-6"},Z={class:"card p-4 mb-6"},ee={class:"flex flex-wrap gap-4"},te={class:"flex-1 min-w-[200px]"},se={class:"card overflow-hidden"},ae={key:0,class:"p-8 text-center"},oe={key:1,class:"w-full"},le={class:"divide-y"},ne={class:"px-4 py-3"},re={class:"flex items-center gap-2"},ie={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-sm font-medium"},de={class:"font-medium text-sm"},ce={class:"text-xs text-gray-500"},ue={class:"px-4 py-3"},pe={class:"flex items-center gap-2"},me={class:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-sm font-medium"},xe={class:"font-medium text-sm"},ge={class:"text-xs text-gray-500"},ye={class:"px-4 py-3"},_e={class:"text-sm font-medium truncate max-w-[200px]"},fe={class:"px-4 py-3"},be={class:"badge bg-gray-100 text-gray-800"},ve={class:"px-4 py-3"},he={class:"text-sm text-gray-600 truncate max-w-[150px]"},we={class:"text-xs text-gray-400"},ke={class:"px-4 py-3"},Ce={class:"px-4 py-3"},je=["onClick"],Me={key:0},Ve={key:2,class:"p-4 border-t flex items-center justify-between"},Ae={class:"text-sm text-gray-600"},Be={class:"flex gap-2"},Se=["disabled"],Te=["disabled"],Ne={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Ue={class:"relative bg-white rounded-xl w-full max-w-2xl max-h-[80vh] flex flex-col"},$e={class:"p-4 border-b flex items-center justify-between"},De={class:"text-sm text-gray-500"},Fe={key:0,class:"text-center py-4"},Le={class:"text-sm"},ze={class:"text-xs text-gray-400 mt-1"},Xe={__name:"Conversations",setup(Pe){const O=(n,t)=>{let p;return(...m)=>{clearTimeout(p),p=setTimeout(()=>n(...m),t)}};K.extend(W);const b=g([]),v=g(!0),h=g(!1),d=g(null),w=g([]),y=g(null),c=P({search:"",blocked:"",from_date:"",to_date:""}),l=P({current_page:1,last_page:1,from:0,to:0,total:0}),V=n=>K(n).fromNow(),x=async()=>{var n,t,p,m,s;v.value=!0;try{const u={page:l.current_page,...c},o=(await I.get("/admin/conversations",{params:u})).data;b.value=o.data||[],Object.assign(l,{current_page:((n=o.meta)==null?void 0:n.current_page)||o.current_page||1,last_page:((t=o.meta)==null?void 0:t.last_page)||o.last_page||1,from:((p=o.meta)==null?void 0:p.from)||o.from||0,to:((m=o.meta)==null?void 0:m.to)||o.to||0,total:((s=o.meta)==null?void 0:s.total)||o.total||0})}catch(u){console.error("Failed to fetch conversations",u)}finally{v.value=!1}},A=O(()=>{l.current_page=1,x()},300),B=n=>{l.current_page=n,x()},X=async n=>{d.value=n,h.value=!0,w.value=[];try{const t=await I.get(`/admin/conversations/${n.id}/messages`);w.value=(t.data.data||[]).reverse(),await R(),y.value&&(y.value.scrollTop=y.value.scrollHeight)}catch(t){console.error("Failed to fetch messages",t)}finally{h.value=!1}};return q(()=>{x()}),(n,t)=>{var p,m;return i(),r("div",Y,[t[16]||(t[16]=e("div",{class:"flex items-center justify-between mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Conversations"),e("span",{class:"text-sm text-gray-500"},"Monitor all user conversations")],-1)),e("div",Z,[e("div",ee,[e("div",te,[_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>c.search=s),type:"text",placeholder:"Search by user name, email or listing...",class:"input",onInput:t[1]||(t[1]=(...s)=>M(A)&&M(A)(...s))},null,544),[[j,c.search]])]),_(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>c.blocked=s),onChange:x,class:"input w-40"},[...t[9]||(t[9]=[e("option",{value:""},"All Status",-1),e("option",{value:"false"},"Active",-1),e("option",{value:"true"},"Blocked",-1)])],544),[[G,c.blocked]]),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>c.from_date=s),type:"date",class:"input w-40",onChange:x},null,544),[[j,c.from_date]]),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>c.to_date=s),type:"date",class:"input w-40",onChange:x},null,544),[[j,c.to_date]])])]),e("div",se,[v.value?(i(),r("div",ae,[...t[10]||(t[10]=[e("div",{class:"animate-spin h-8 w-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto"},null,-1)])])):(i(),r("table",oe,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Buyer"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Seller"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Listing"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Messages"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Last Message"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Status"),e("th",{class:"px-4 py-3 text-left text-sm font-semibold text-gray-900"},"Actions")])],-1)),e("tbody",le,[(i(!0),r(E,null,H(b.value,s=>{var u,k,o,S,T,N,U,$,D,F,L,z;return i(),r("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",ne,[e("div",re,[e("div",ie,a(((o=(k=(u=s.buyer)==null?void 0:u.name)==null?void 0:k.charAt(0))==null?void 0:o.toUpperCase())||"?"),1),e("div",null,[e("p",de,a((S=s.buyer)==null?void 0:S.name),1),e("p",ce,a((T=s.buyer)==null?void 0:T.email),1)])])]),e("td",ue,[e("div",pe,[e("div",me,a((($=(U=(N=s.seller)==null?void 0:N.name)==null?void 0:U.charAt(0))==null?void 0:$.toUpperCase())||"?"),1),e("div",null,[e("p",xe,a((D=s.seller)==null?void 0:D.name),1),e("p",ge,a((F=s.seller)==null?void 0:F.email),1)])])]),e("td",ye,[e("p",_e,a(((L=s.listing)==null?void 0:L.title)||"Deleted"),1)]),e("td",fe,[e("span",be,a(s.messages_count)+" messages",1)]),e("td",ve,[e("p",he,a(((z=s.latest_message)==null?void 0:z.body)||"-"),1),e("p",we,a(V(s.updated_at)),1)]),e("td",ke,[e("span",{class:f(["badge",s.is_blocked?"bg-red-100 text-red-800":"bg-green-100 text-green-800"])},a(s.is_blocked?"Blocked":"Active"),3)]),e("td",Ce,[e("button",{onClick:Ee=>X(s),class:"btn-sm bg-primary-100 text-primary-700"}," View Chat ",8,je)])])}),128)),b.value.length?C("",!0):(i(),r("tr",Me,[...t[11]||(t[11]=[e("td",{colspan:"7",class:"px-4 py-8 text-center text-gray-500"}," No conversations found ",-1)])]))])])),l.last_page>1?(i(),r("div",Ve,[e("p",Ae," Showing "+a(l.from)+" to "+a(l.to)+" of "+a(l.total),1),e("div",Be,[e("button",{onClick:t[5]||(t[5]=s=>B(l.current_page-1)),disabled:l.current_page===1,class:"btn-sm"}," Previous ",8,Se),e("button",{onClick:t[6]||(t[6]=s=>B(l.current_page+1)),disabled:l.current_page===l.last_page,class:"btn-sm"}," Next ",8,Te)])])):C("",!0)]),d.value?(i(),r("div",Ne,[e("div",{class:"absolute inset-0 bg-black/50",onClick:t[7]||(t[7]=s=>d.value=null)}),e("div",Ue,[e("div",$e,[e("div",null,[t[13]||(t[13]=e("h3",{class:"font-semibold"},"Conversation",-1)),e("p",De,a((p=d.value.buyer)==null?void 0:p.name)+" â†” "+a((m=d.value.seller)==null?void 0:m.name),1)]),e("button",{onClick:t[8]||(t[8]=s=>d.value=null),class:"p-2 hover:bg-gray-100 rounded-lg"},[J(M(Q),{class:"w-5 h-5"})])]),e("div",{class:"flex-1 overflow-y-auto p-4 space-y-3",ref_key:"messagesContainer",ref:y},[h.value?(i(),r("div",Fe,[...t[14]||(t[14]=[e("div",{class:"animate-spin h-6 w-6 border-2 border-primary-500 border-t-transparent rounded-full mx-auto"},null,-1)])])):(i(!0),r(E,{key:1},H(w.value,s=>{var u;return i(),r("div",{key:s.id,class:f(["flex",s.sender_id===d.value.buyer_id?"justify-start":"justify-end"])},[e("div",{class:f(["max-w-[70%] rounded-lg px-4 py-2",s.sender_id===d.value.buyer_id?"bg-gray-100":"bg-primary-100"])},[e("p",{class:f(["text-xs font-medium mb-1",s.sender_id===d.value.buyer_id?"text-blue-600":"text-green-600"])},a((u=s.sender)==null?void 0:u.name),3),e("p",Le,a(s.body),1),e("p",ze,a(V(s.created_at)),1)],2)],2)}),128))],512),t[15]||(t[15]=e("div",{class:"p-4 border-t bg-gray-50 rounded-b-xl"},[e("p",{class:"text-xs text-gray-500 text-center"}," This is a read-only view for monitoring purposes ")],-1))])])):C("",!0)])}}};export{Xe as default};
