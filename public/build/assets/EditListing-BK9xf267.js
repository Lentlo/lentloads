var T=Object.defineProperty,E=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var N=(r,s,o)=>s in r?T(r,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[s]=o,P=(r,s)=>{for(var o in s||(s={}))R.call(s,o)&&N(r,o,s[o]);if(F)for(var o of F(s))z.call(s,o)&&N(r,o,s[o]);return r},$=(r,s)=>E(r,G(s));var y=(r,s,o)=>new Promise((_,m)=>{var w=e=>{try{n(o.next(e))}catch(b){m(b)}},g=e=>{try{n(o.throw(e))}catch(b){m(b)}},n=e=>e.done?_(e.value):Promise.resolve(e.value).then(w,g);n((o=o.apply(r,s)).next())});import{q as J,u as Q,f as C,r as Y,b as H,o as K,v as O,k as d,l as u,p as l,L as W,C as c,Q as S,F as V,G as L,D as x,A as h,J as X,x as Z,a as k,z as q,y as tt,I as et}from"./vue-vendor-DFuH7PQo.js";import{u as lt,b as I,f as it}from"./main-capacitor-C1-jC-GR.js";import{u as st}from"./listings-Bnv6oCAa.js";import{toast as p}from"./ui-vendor-CosC-cw2.js";import{_ as ot}from"./LocationPicker-WbO5UUFb.js";import{r as at}from"./CameraIcon-_puX9ylO.js";import"./leaflet-DM52LaZd.js";const nt={class:"min-h-screen bg-gray-50 py-6"},rt={class:"container-app max-w-3xl"},dt={class:"card p-6"},ut={key:0,class:"space-y-4"},pt=["label"],ct=["value"],mt={class:"text-sm text-gray-500 mt-1"},gt={class:"grid grid-cols-2 gap-4"},yt={class:"relative"},bt={class:"grid grid-cols-2 gap-4"},vt={class:"grid grid-cols-4 gap-4"},ft=["src"],xt=["onClick"],wt=["onClick"],kt={key:1,class:"absolute bottom-1 left-1 text-xs bg-primary-500 text-white px-2 py-1 rounded"},_t={key:0,class:"aspect-square bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-primary-500"},Ct={class:"border-t pt-6"},St={class:"border-t pt-6 flex justify-end gap-4"},Vt=["disabled"],It={__name:"EditListing",setup(r){const s=J(),o=Q(),_=lt(),m=st(),w=C(!0),g=C(!1),n=C([]),e=Y({category_id:"",title:"",description:"",price:"",price_type:"fixed",condition:"",brand:"",model:"",city:"",state:"",locality:"",postal_code:"",latitude:null,longitude:null}),b=H(()=>_.categories),U=()=>y(this,null,function*(){try{const t=(yield I.get(`/listings/${s.params.id}`)).data.data.listing;e.category_id=t.category_id,e.title=t.title,e.description=t.description,e.price=t.price,e.price_type=t.price_type,e.condition=t.condition||"",e.brand=t.brand||"",e.model=t.model||"",e.city=t.city,e.state=t.state||"",e.locality=t.locality||"",e.postal_code=t.postal_code||"",e.latitude=t.latitude||null,e.longitude=t.longitude||null,n.value=t.images||[]}catch(a){p.error("Failed to load listing"),o.push("/my-listings")}finally{w.value=!1}}),M=a=>y(this,null,function*(){const t=Array.from(a.target.files),v=10-n.value.length;if(t.length>v){p.error(`You can only add ${v} more images`);return}try{yield m.addImages(s.params.id,t.slice(0,v)),p.success("Images added"),U()}catch(i){p.error("Failed to upload images")}}),j=a=>y(this,null,function*(){if(n.value.length<=1){p.error("Listing must have at least one image");return}try{yield m.deleteImage(s.params.id,a),n.value=n.value.filter(t=>t.id!==a),p.success("Image deleted")}catch(t){p.error("Failed to delete image")}}),A=a=>y(this,null,function*(){try{yield I.put(`/listings/${s.params.id}/images/${a}/primary`),n.value=n.value.map(t=>$(P({},t),{is_primary:t.id===a})),p.success("Primary image updated")}catch(t){p.error("Failed to update primary image")}}),B=a=>{e.city=a.city,e.state=a.state,e.locality=a.locality,e.postal_code=a.postal_code,e.latitude=a.latitude,e.longitude=a.longitude},D=()=>y(this,null,function*(){g.value=!0;try{yield m.updateListing(s.params.id,e),p.success("Listing updated successfully"),o.push("/my-listings")}catch(a){p.error("Failed to update listing")}finally{g.value=!1}});return K(()=>{U()}),(a,t)=>{const v=O("router-link");return u(),d("div",nt,[l("div",rt,[l("div",dt,[t[25]||(t[25]=l("h1",{class:"text-2xl font-bold text-gray-900 mb-6"},"Edit Listing",-1)),w.value?(u(),d("div",ut,[...t[8]||(t[8]=[l("div",{class:"skeleton h-10 w-full"},null,-1),l("div",{class:"skeleton h-10 w-full"},null,-1),l("div",{class:"skeleton h-32 w-full"},null,-1)])])):(u(),d("form",{key:1,onSubmit:W(D,["prevent"]),class:"space-y-6"},[l("div",null,[t[10]||(t[10]=l("label",{class:"label"},"Category *",-1)),c(l("select",{"onUpdate:modelValue":t[0]||(t[0]=i=>e.category_id=i),required:"",class:"input"},[t[9]||(t[9]=l("option",{value:""},"Select a category",-1)),(u(!0),d(V,null,L(b.value,i=>(u(),d("optgroup",{key:i.id,label:i.name},[(u(!0),d(V,null,L(i.children,f=>(u(),d("option",{key:f.id,value:f.id},h(f.name),9,ct))),128))],8,pt))),128))],512),[[S,e.category_id]])]),l("div",null,[t[11]||(t[11]=l("label",{class:"label"},"Title *",-1)),c(l("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>e.title=i),type:"text",maxlength:"100",required:"",class:"input"},null,512),[[x,e.title]]),l("p",mt,h(e.title.length)+"/100",1)]),l("div",null,[t[12]||(t[12]=l("label",{class:"label"},"Description *",-1)),c(l("textarea",{"onUpdate:modelValue":t[2]||(t[2]=i=>e.description=i),rows:"5",maxlength:"5000",required:"",class:"input"},null,512),[[x,e.description]])]),l("div",gt,[l("div",null,[t[14]||(t[14]=l("label",{class:"label"},"Price *",-1)),l("div",yt,[t[13]||(t[13]=l("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"},"â‚¹",-1)),c(l("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>e.price=i),type:"number",min:"0",required:"",class:"input pl-8"},null,512),[[x,e.price]])])]),l("div",null,[t[16]||(t[16]=l("label",{class:"label"},"Price Type",-1)),c(l("select",{"onUpdate:modelValue":t[4]||(t[4]=i=>e.price_type=i),class:"input"},[...t[15]||(t[15]=[l("option",{value:"fixed"},"Fixed",-1),l("option",{value:"negotiable"},"Negotiable",-1),l("option",{value:"free"},"Free",-1),l("option",{value:"contact"},"Contact for Price",-1)])],512),[[S,e.price_type]])])]),l("div",null,[t[18]||(t[18]=l("label",{class:"label"},"Condition",-1)),c(l("select",{"onUpdate:modelValue":t[5]||(t[5]=i=>e.condition=i),class:"input"},[...t[17]||(t[17]=[X('<option value="">Select condition</option><option value="new">New</option><option value="like_new">Like New</option><option value="good">Good</option><option value="fair">Fair</option><option value="poor">Poor</option>',6)])],512),[[S,e.condition]])]),l("div",bt,[l("div",null,[t[19]||(t[19]=l("label",{class:"label"},"Brand",-1)),c(l("input",{"onUpdate:modelValue":t[6]||(t[6]=i=>e.brand=i),type:"text",class:"input"},null,512),[[x,e.brand]])]),l("div",null,[t[20]||(t[20]=l("label",{class:"label"},"Model",-1)),c(l("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>e.model=i),type:"text",class:"input"},null,512),[[x,e.model]])])]),l("div",null,[t[22]||(t[22]=l("label",{class:"label"},"Current Photos",-1)),l("div",vt,[(u(!0),d(V,null,L(n.value,i=>(u(),d("div",{key:i.id,class:"relative aspect-square bg-gray-100 rounded-lg overflow-hidden"},[l("img",{src:i.thumbnail_url,class:"w-full h-full object-cover"},null,8,ft),l("button",{type:"button",onClick:f=>j(i.id),class:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center"},[k(q(it),{class:"w-4 h-4"})],8,xt),i.is_primary?(u(),d("span",kt," Primary ")):(u(),d("button",{key:0,type:"button",onClick:f=>A(i.id),class:"absolute bottom-1 left-1 text-xs bg-white px-2 py-1 rounded"}," Set as primary ",8,wt))]))),128)),n.value.length<10?(u(),d("label",_t,[k(q(at),{class:"w-8 h-8 text-gray-400 mb-1"}),t[21]||(t[21]=l("span",{class:"text-sm text-gray-500"},"Add More",-1)),l("input",{type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:M},null,32)])):Z("",!0)])]),l("div",Ct,[t[23]||(t[23]=l("h3",{class:"font-semibold text-gray-900 mb-4"},"Location",-1)),k(ot,{"initial-latitude":e.latitude,"initial-longitude":e.longitude,"initial-city":e.city,"initial-state":e.state,"initial-locality":e.locality,"initial-postal-code":e.postal_code,"onUpdate:location":B},null,8,["initial-latitude","initial-longitude","initial-city","initial-state","initial-locality","initial-postal-code"])]),l("div",St,[k(v,{to:"/my-listings",class:"btn-secondary"},{default:tt(()=>[...t[24]||(t[24]=[et(" Cancel ",-1)])]),_:1}),l("button",{type:"submit",disabled:g.value,class:"btn-primary"},h(g.value?"Saving...":"Save Changes"),9,Vt)])],32))])])])}}};export{It as default};
